{"ast":null,"code":"// src/services/authService.js\n// Production-ready authentication service\n// No mock data - only real API calls\n\nimport api from './api';\nclass AuthService {\n  constructor() {\n    this.baseUrl = '/api/auth';\n    this.tokenRefreshTimeout = null;\n  }\n\n  /**\r\n   * Login user with real API\r\n   */\n  async login(email, password, rememberMe = false) {\n    try {\n      console.log('ðŸ” [AuthService] Login attempt:', {\n        email\n      });\n      const response = await api.post(`${this.baseUrl}/login`, {\n        email: email.trim().toLowerCase(),\n        password,\n        rememberMe\n      });\n      const {\n        success,\n        data,\n        message\n      } = response.data;\n      if (!success) {\n        console.error('âŒ [AuthService] Login failed:', message);\n        throw new Error(message || 'Login failed');\n      }\n\n      // Store authentication data\n      this._storeAuthData(data);\n\n      // Schedule token refresh if expiresAt is provided\n      if (data.expiresAt) {\n        this._scheduleTokenRefresh(data.expiresAt);\n      }\n      console.log('âœ… [AuthService] Login successful:', data.user.email);\n      return {\n        success: true,\n        data,\n        message\n      };\n    } catch (error) {\n      var _error$response, _error$response$data;\n      console.error('âŒ [AuthService] Login error:', error);\n\n      // Clear any existing auth data on login failure\n      this._clearAuthData();\n      throw new Error(((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || error.message || 'Login failed');\n    }\n  }\n\n  /**\r\n   * Register new user with real API\r\n   */\n  async register(userData) {\n    try {\n      var _userData$firstName, _userData$lastName, _userData$phoneNumber, _userData$studentId, _userData$staffId;\n      console.log('ðŸ“ [AuthService] Registration attempt:', {\n        email: userData.email,\n        username: userData.username\n      });\n\n      // Prepare registration data\n      const registrationData = {\n        username: userData.username.trim(),\n        email: userData.email.trim().toLowerCase(),\n        password: userData.password,\n        firstName: ((_userData$firstName = userData.firstName) === null || _userData$firstName === void 0 ? void 0 : _userData$firstName.trim()) || userData.username,\n        lastName: ((_userData$lastName = userData.lastName) === null || _userData$lastName === void 0 ? void 0 : _userData$lastName.trim()) || 'User',\n        role: userData.role || 'student',\n        department: userData.department || 'computer_science',\n        phoneNumber: (_userData$phoneNumber = userData.phoneNumber) === null || _userData$phoneNumber === void 0 ? void 0 : _userData$phoneNumber.trim(),\n        studentId: (_userData$studentId = userData.studentId) === null || _userData$studentId === void 0 ? void 0 : _userData$studentId.trim(),\n        staffId: (_userData$staffId = userData.staffId) === null || _userData$staffId === void 0 ? void 0 : _userData$staffId.trim()\n      };\n      const response = await api.post(`${this.baseUrl}/register`, registrationData);\n      const {\n        success,\n        data,\n        message,\n        requiresVerification\n      } = response.data;\n      if (!success) {\n        console.error('âŒ [AuthService] Registration failed:', message);\n        throw new Error(message || 'Registration failed');\n      }\n\n      // If registration includes auto-login, store auth data\n      if (data.token && data.user) {\n        this._storeAuthData(data);\n        if (data.expiresAt) {\n          this._scheduleTokenRefresh(data.expiresAt);\n        }\n      }\n      console.log('âœ… [AuthService] Registration successful:', data.user.email);\n      return {\n        success: true,\n        data,\n        message,\n        requiresVerification\n      };\n    } catch (error) {\n      var _error$response2, _error$response2$data, _error$response3, _error$response3$data, _error$response4, _error$response4$data;\n      console.error('âŒ [AuthService] Registration error:', error);\n\n      // Parse error response for user-friendly messages\n      let errorMessage = ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) || error.message || 'Registration failed';\n\n      // Handle specific error types\n      if ((_error$response3 = error.response) !== null && _error$response3 !== void 0 && (_error$response3$data = _error$response3.data) !== null && _error$response3$data !== void 0 && _error$response3$data.errors) {\n        errorMessage = error.response.data.errors.join('. ');\n      }\n      if ((_error$response4 = error.response) !== null && _error$response4 !== void 0 && (_error$response4$data = _error$response4.data) !== null && _error$response4$data !== void 0 && _error$response4$data.field) {\n        errorMessage = `${error.response.data.field.charAt(0).toUpperCase() + error.response.data.field.slice(1)} ${errorMessage.toLowerCase()}`;\n      }\n      throw new Error(errorMessage);\n    }\n  }\n\n  /**\r\n   * Logout user with real API\r\n   */\n  async logout() {\n    try {\n      console.log('ðŸšª [AuthService] Logout request');\n\n      // Call logout API\n      await api.post(`${this.baseUrl}/logout`);\n    } catch (error) {\n      console.warn('âš ï¸ [AuthService] Logout API error:', error);\n      // Continue with local cleanup even if API fails\n    } finally {\n      // Always clear local storage\n      this._clearAuthData();\n      console.log('âœ… [AuthService] Logout completed');\n    }\n  }\n\n  /**\r\n   * Get current authenticated user\r\n   */\n  async getCurrentUser() {\n    try {\n      const token = this.getToken();\n      if (!token) {\n        return {\n          success: false,\n          message: 'No authentication token found'\n        };\n      }\n\n      // Verify token is still valid\n      if (this.isTokenExpired()) {\n        console.warn('âš ï¸ [AuthService] Token expired, attempting refresh...');\n        const refreshed = await this.refreshAccessToken();\n        if (!refreshed.success) {\n          this._clearAuthData();\n          return {\n            success: false,\n            message: 'Session expired. Please login again.'\n          };\n        }\n      }\n\n      // Get fresh user data from API\n      const response = await api.get(`${this.baseUrl}/me`);\n      if (!response.data.success) {\n        throw new Error(response.data.message || 'Failed to fetch user data');\n      }\n      return {\n        success: true,\n        data: response.data.data\n      };\n    } catch (error) {\n      var _error$response5, _error$response5$data;\n      console.error('âŒ [AuthService] Get current user error:', error);\n\n      // Fallback to local storage if API fails\n      const userStr = localStorage.getItem('user');\n      if (userStr) {\n        try {\n          const user = JSON.parse(userStr);\n          return {\n            success: true,\n            data: user\n          };\n        } catch (parseError) {\n          console.error('âŒ [AuthService] Error parsing stored user:', parseError);\n        }\n      }\n      return {\n        success: false,\n        message: ((_error$response5 = error.response) === null || _error$response5 === void 0 ? void 0 : (_error$response5$data = _error$response5.data) === null || _error$response5$data === void 0 ? void 0 : _error$response5$data.message) || 'Not authenticated'\n      };\n    }\n  }\n\n  /**\r\n   * Get current session\r\n   */\n  getCurrentSession() {\n    try {\n      const sessionStr = localStorage.getItem('session');\n      if (!sessionStr) return null;\n      const session = JSON.parse(sessionStr);\n\n      // Check if session is still valid\n      if (session.expiresAt && Date.now() > session.expiresAt) {\n        console.warn('âš ï¸ [AuthService] Session expired');\n        this._clearAuthData();\n        return null;\n      }\n      return session;\n    } catch (error) {\n      console.error('âŒ [AuthService] Get session error:', error);\n      return null;\n    }\n  }\n\n  /**\r\n   * Check username availability\r\n   */\n  async checkUsername(username) {\n    try {\n      const response = await api.get(`${this.baseUrl}/check-username/${encodeURIComponent(username.trim())}`);\n      return response.data;\n    } catch (error) {\n      var _error$response6, _error$response6$data;\n      console.error('âŒ [AuthService] Check username error:', error);\n      return {\n        success: false,\n        available: false,\n        message: ((_error$response6 = error.response) === null || _error$response6 === void 0 ? void 0 : (_error$response6$data = _error$response6.data) === null || _error$response6$data === void 0 ? void 0 : _error$response6$data.message) || 'Failed to check username availability'\n      };\n    }\n  }\n\n  /**\r\n   * Check email availability\r\n   */\n  async checkEmail(email) {\n    try {\n      const response = await api.get(`${this.baseUrl}/check-email/${encodeURIComponent(email.trim().toLowerCase())}`);\n      return response.data;\n    } catch (error) {\n      var _error$response7, _error$response7$data;\n      console.error('âŒ [AuthService] Check email error:', error);\n      return {\n        success: false,\n        available: false,\n        message: ((_error$response7 = error.response) === null || _error$response7 === void 0 ? void 0 : (_error$response7$data = _error$response7.data) === null || _error$response7$data === void 0 ? void 0 : _error$response7$data.message) || 'Failed to check email availability'\n      };\n    }\n  }\n\n  /**\r\n   * Refresh access token\r\n   */\n  async refreshAccessToken() {\n    try {\n      const session = this.getCurrentSession();\n      if (!(session !== null && session !== void 0 && session.refreshToken)) {\n        throw new Error('No refresh token available');\n      }\n      console.log('ðŸ”„ [AuthService] Refreshing access token...');\n      const response = await api.post(`${this.baseUrl}/refresh`, {\n        refreshToken: session.refreshToken\n      });\n      const {\n        success,\n        data\n      } = response.data;\n      if (!success) {\n        throw new Error('Token refresh failed');\n      }\n\n      // Update stored session\n      this._storeAuthData(data);\n\n      // Schedule next refresh\n      if (data.expiresAt) {\n        this._scheduleTokenRefresh(data.expiresAt);\n      }\n      console.log('âœ… [AuthService] Token refreshed successfully');\n      return {\n        success: true,\n        token: data.token\n      };\n    } catch (error) {\n      console.error('âŒ [AuthService] Token refresh error:', error);\n      this._clearAuthData();\n      return {\n        success: false,\n        message: 'Session expired. Please login again.'\n      };\n    }\n  }\n\n  /**\r\n   * Update user profile\r\n   */\n  async updateProfile(updates) {\n    try {\n      const response = await api.put('/api/users/profile', updates);\n      return response.data;\n    } catch (error) {\n      var _error$response8, _error$response8$data;\n      console.error('âŒ [AuthService] Update profile error:', error);\n      throw new Error(((_error$response8 = error.response) === null || _error$response8 === void 0 ? void 0 : (_error$response8$data = _error$response8.data) === null || _error$response8$data === void 0 ? void 0 : _error$response8$data.message) || 'Failed to update profile');\n    }\n  }\n\n  /**\r\n   * Change password\r\n   */\n  async changePassword(currentPassword, newPassword) {\n    try {\n      const response = await api.post('/api/auth/change-password', {\n        currentPassword,\n        newPassword\n      });\n      return response.data;\n    } catch (error) {\n      var _error$response9, _error$response9$data;\n      console.error('âŒ [AuthService] Change password error:', error);\n      throw new Error(((_error$response9 = error.response) === null || _error$response9 === void 0 ? void 0 : (_error$response9$data = _error$response9.data) === null || _error$response9$data === void 0 ? void 0 : _error$response9$data.message) || 'Failed to change password');\n    }\n  }\n\n  /**\r\n   * Request password reset\r\n   */\n  async forgotPassword(email) {\n    try {\n      const response = await api.post('/api/auth/forgot-password', {\n        email\n      });\n      return response.data;\n    } catch (error) {\n      var _error$response0, _error$response0$data;\n      console.error('âŒ [AuthService] Forgot password error:', error);\n      throw new Error(((_error$response0 = error.response) === null || _error$response0 === void 0 ? void 0 : (_error$response0$data = _error$response0.data) === null || _error$response0$data === void 0 ? void 0 : _error$response0$data.message) || 'Failed to send reset email');\n    }\n  }\n\n  /**\r\n   * Reset password with token\r\n   */\n  async resetPassword(token, passwordData) {\n    try {\n      const response = await api.post(`/api/auth/reset-password/${token}`, passwordData);\n      return response.data;\n    } catch (error) {\n      var _error$response1, _error$response1$data;\n      console.error('âŒ [AuthService] Reset password error:', error);\n      throw new Error(((_error$response1 = error.response) === null || _error$response1 === void 0 ? void 0 : (_error$response1$data = _error$response1.data) === null || _error$response1$data === void 0 ? void 0 : _error$response1$data.message) || 'Failed to reset password');\n    }\n  }\n\n  /**\r\n   * Verify email with token\r\n   */\n  async verifyEmail(token) {\n    try {\n      const response = await api.post(`/api/auth/verify-email/${token}`);\n      return response.data;\n    } catch (error) {\n      var _error$response10, _error$response10$dat;\n      console.error('âŒ [AuthService] Verify email error:', error);\n      throw new Error(((_error$response10 = error.response) === null || _error$response10 === void 0 ? void 0 : (_error$response10$dat = _error$response10.data) === null || _error$response10$dat === void 0 ? void 0 : _error$response10$dat.message) || 'Failed to verify email');\n    }\n  }\n\n  /**\r\n   * Get authentication token\r\n   */\n  getToken() {\n    return localStorage.getItem('token');\n  }\n\n  /**\r\n   * Check if user is authenticated\r\n   */\n  isAuthenticated() {\n    const token = this.getToken();\n    const user = localStorage.getItem('user');\n    return !!(token && user);\n  }\n\n  /**\r\n   * Check if token is expired\r\n   */\n  isTokenExpired() {\n    const session = this.getCurrentSession();\n    if (!(session !== null && session !== void 0 && session.expiresAt)) return true;\n\n    // Consider token expired 5 minutes before actual expiry\n    const bufferTime = 5 * 60 * 1000; // 5 minutes\n    return Date.now() > session.expiresAt - bufferTime;\n  }\n\n  // ============================================\n  // PRIVATE METHODS\n  // ============================================\n\n  /**\r\n   * Store authentication data\r\n   */\n  _storeAuthData(data) {\n    if (data.token) {\n      localStorage.setItem('token', data.token);\n    }\n    if (data.user) {\n      localStorage.setItem('user', JSON.stringify(data.user));\n    }\n    if (data.expiresAt) {\n      const session = {\n        id: `session_${Date.now()}`,\n        accessToken: data.token,\n        refreshToken: data.refreshToken || `refresh_${Date.now()}`,\n        expiresAt: data.expiresAt,\n        createdAt: new Date().toISOString(),\n        user: data.user\n      };\n      localStorage.setItem('session', JSON.stringify(session));\n    }\n  }\n\n  /**\r\n   * Clear authentication data\r\n   */\n  _clearAuthData() {\n    // Clear localStorage\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    localStorage.removeItem('session');\n\n    // Clear sessionStorage\n    sessionStorage.clear();\n\n    // Clear any refresh timeout\n    if (this.tokenRefreshTimeout) {\n      clearTimeout(this.tokenRefreshTimeout);\n      this.tokenRefreshTimeout = null;\n    }\n\n    // Clear API default headers\n    if (api.defaults.headers.common['Authorization']) {\n      delete api.defaults.headers.common['Authorization'];\n    }\n  }\n\n  /**\r\n   * Schedule token refresh\r\n   */\n  _scheduleTokenRefresh(expiresAt) {\n    // Clear existing timeout\n    if (this.tokenRefreshTimeout) {\n      clearTimeout(this.tokenRefreshTimeout);\n    }\n\n    // Refresh 5 minutes before expiry\n    const refreshTime = expiresAt - Date.now() - 5 * 60 * 1000;\n    if (refreshTime > 0) {\n      this.tokenRefreshTimeout = setTimeout(async () => {\n        try {\n          await this.refreshAccessToken();\n        } catch (error) {\n          console.error('âŒ [AuthService] Scheduled token refresh failed:', error);\n        }\n      }, refreshTime);\n    }\n  }\n\n  /**\r\n   * Initialize auth state\r\n   */\n  initialize() {\n    const token = this.getToken();\n    if (token) {\n      // Set default Authorization header for all API calls\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n\n      // Check if token needs refresh\n      if (this.isTokenExpired()) {\n        console.log('ðŸ”„ [AuthService] Initializing with expired token, will refresh...');\n        setTimeout(() => this.refreshAccessToken(), 1000);\n      } else {\n        const session = this.getCurrentSession();\n        if (session !== null && session !== void 0 && session.expiresAt) {\n          this._scheduleTokenRefresh(session.expiresAt);\n        }\n      }\n    }\n  }\n}\n\n// Export singleton instance\nexport const authService = new AuthService();\nexport default authService;","map":{"version":3,"names":["api","AuthService","constructor","baseUrl","tokenRefreshTimeout","login","email","password","rememberMe","console","log","response","post","trim","toLowerCase","success","data","message","error","Error","_storeAuthData","expiresAt","_scheduleTokenRefresh","user","_error$response","_error$response$data","_clearAuthData","register","userData","_userData$firstName","_userData$lastName","_userData$phoneNumber","_userData$studentId","_userData$staffId","username","registrationData","firstName","lastName","role","department","phoneNumber","studentId","staffId","requiresVerification","token","_error$response2","_error$response2$data","_error$response3","_error$response3$data","_error$response4","_error$response4$data","errorMessage","errors","join","field","charAt","toUpperCase","slice","logout","warn","getCurrentUser","getToken","isTokenExpired","refreshed","refreshAccessToken","get","_error$response5","_error$response5$data","userStr","localStorage","getItem","JSON","parse","parseError","getCurrentSession","sessionStr","session","Date","now","checkUsername","encodeURIComponent","_error$response6","_error$response6$data","available","checkEmail","_error$response7","_error$response7$data","refreshToken","updateProfile","updates","put","_error$response8","_error$response8$data","changePassword","currentPassword","newPassword","_error$response9","_error$response9$data","forgotPassword","_error$response0","_error$response0$data","resetPassword","passwordData","_error$response1","_error$response1$data","verifyEmail","_error$response10","_error$response10$dat","isAuthenticated","bufferTime","setItem","stringify","id","accessToken","createdAt","toISOString","removeItem","sessionStorage","clear","clearTimeout","defaults","headers","common","refreshTime","setTimeout","initialize","authService"],"sources":["C:/Users/KADZ-TECH/Documents/dev/it-support-system/frontend/src/services/authService.js"],"sourcesContent":["// src/services/authService.js\r\n// Production-ready authentication service\r\n// No mock data - only real API calls\r\n\r\nimport api from './api';\r\n\r\nclass AuthService {\r\n  constructor() {\r\n    this.baseUrl = '/api/auth';\r\n    this.tokenRefreshTimeout = null;\r\n  }\r\n\r\n  /**\r\n   * Login user with real API\r\n   */\r\n  async login(email, password, rememberMe = false) {\r\n    try {\r\n      console.log('ðŸ” [AuthService] Login attempt:', { email });\r\n      \r\n      const response = await api.post(`${this.baseUrl}/login`, {\r\n        email: email.trim().toLowerCase(),\r\n        password,\r\n        rememberMe\r\n      });\r\n\r\n      const { success, data, message } = response.data;\r\n      \r\n      if (!success) {\r\n        console.error('âŒ [AuthService] Login failed:', message);\r\n        throw new Error(message || 'Login failed');\r\n      }\r\n\r\n      // Store authentication data\r\n      this._storeAuthData(data);\r\n      \r\n      // Schedule token refresh if expiresAt is provided\r\n      if (data.expiresAt) {\r\n        this._scheduleTokenRefresh(data.expiresAt);\r\n      }\r\n\r\n      console.log('âœ… [AuthService] Login successful:', data.user.email);\r\n      return { success: true, data, message };\r\n      \r\n    } catch (error) {\r\n      console.error('âŒ [AuthService] Login error:', error);\r\n      \r\n      // Clear any existing auth data on login failure\r\n      this._clearAuthData();\r\n      \r\n      throw new Error(error.response?.data?.message || error.message || 'Login failed');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Register new user with real API\r\n   */\r\n  async register(userData) {\r\n    try {\r\n      console.log('ðŸ“ [AuthService] Registration attempt:', { \r\n        email: userData.email, \r\n        username: userData.username \r\n      });\r\n      \r\n      // Prepare registration data\r\n      const registrationData = {\r\n        username: userData.username.trim(),\r\n        email: userData.email.trim().toLowerCase(),\r\n        password: userData.password,\r\n        firstName: userData.firstName?.trim() || userData.username,\r\n        lastName: userData.lastName?.trim() || 'User',\r\n        role: userData.role || 'student',\r\n        department: userData.department || 'computer_science',\r\n        phoneNumber: userData.phoneNumber?.trim(),\r\n        studentId: userData.studentId?.trim(),\r\n        staffId: userData.staffId?.trim()\r\n      };\r\n\r\n      const response = await api.post(`${this.baseUrl}/register`, registrationData);\r\n\r\n      const { success, data, message, requiresVerification } = response.data;\r\n      \r\n      if (!success) {\r\n        console.error('âŒ [AuthService] Registration failed:', message);\r\n        throw new Error(message || 'Registration failed');\r\n      }\r\n\r\n      // If registration includes auto-login, store auth data\r\n      if (data.token && data.user) {\r\n        this._storeAuthData(data);\r\n        \r\n        if (data.expiresAt) {\r\n          this._scheduleTokenRefresh(data.expiresAt);\r\n        }\r\n      }\r\n\r\n      console.log('âœ… [AuthService] Registration successful:', data.user.email);\r\n      return { \r\n        success: true, \r\n        data, \r\n        message, \r\n        requiresVerification \r\n      };\r\n      \r\n    } catch (error) {\r\n      console.error('âŒ [AuthService] Registration error:', error);\r\n      \r\n      // Parse error response for user-friendly messages\r\n      let errorMessage = error.response?.data?.message || error.message || 'Registration failed';\r\n      \r\n      // Handle specific error types\r\n      if (error.response?.data?.errors) {\r\n        errorMessage = error.response.data.errors.join('. ');\r\n      }\r\n      \r\n      if (error.response?.data?.field) {\r\n        errorMessage = `${error.response.data.field.charAt(0).toUpperCase() + error.response.data.field.slice(1)} ${errorMessage.toLowerCase()}`;\r\n      }\r\n      \r\n      throw new Error(errorMessage);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Logout user with real API\r\n   */\r\n  async logout() {\r\n    try {\r\n      console.log('ðŸšª [AuthService] Logout request');\r\n      \r\n      // Call logout API\r\n      await api.post(`${this.baseUrl}/logout`);\r\n      \r\n    } catch (error) {\r\n      console.warn('âš ï¸ [AuthService] Logout API error:', error);\r\n      // Continue with local cleanup even if API fails\r\n    } finally {\r\n      // Always clear local storage\r\n      this._clearAuthData();\r\n      console.log('âœ… [AuthService] Logout completed');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current authenticated user\r\n   */\r\n  async getCurrentUser() {\r\n    try {\r\n      const token = this.getToken();\r\n      \r\n      if (!token) {\r\n        return { success: false, message: 'No authentication token found' };\r\n      }\r\n\r\n      // Verify token is still valid\r\n      if (this.isTokenExpired()) {\r\n        console.warn('âš ï¸ [AuthService] Token expired, attempting refresh...');\r\n        const refreshed = await this.refreshAccessToken();\r\n        \r\n        if (!refreshed.success) {\r\n          this._clearAuthData();\r\n          return { success: false, message: 'Session expired. Please login again.' };\r\n        }\r\n      }\r\n\r\n      // Get fresh user data from API\r\n      const response = await api.get(`${this.baseUrl}/me`);\r\n      \r\n      if (!response.data.success) {\r\n        throw new Error(response.data.message || 'Failed to fetch user data');\r\n      }\r\n\r\n      return { \r\n        success: true, \r\n        data: response.data.data \r\n      };\r\n      \r\n    } catch (error) {\r\n      console.error('âŒ [AuthService] Get current user error:', error);\r\n      \r\n      // Fallback to local storage if API fails\r\n      const userStr = localStorage.getItem('user');\r\n      if (userStr) {\r\n        try {\r\n          const user = JSON.parse(userStr);\r\n          return { success: true, data: user };\r\n        } catch (parseError) {\r\n          console.error('âŒ [AuthService] Error parsing stored user:', parseError);\r\n        }\r\n      }\r\n      \r\n      return { \r\n        success: false, \r\n        message: error.response?.data?.message || 'Not authenticated' \r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current session\r\n   */\r\n  getCurrentSession() {\r\n    try {\r\n      const sessionStr = localStorage.getItem('session');\r\n      if (!sessionStr) return null;\r\n\r\n      const session = JSON.parse(sessionStr);\r\n      \r\n      // Check if session is still valid\r\n      if (session.expiresAt && Date.now() > session.expiresAt) {\r\n        console.warn('âš ï¸ [AuthService] Session expired');\r\n        this._clearAuthData();\r\n        return null;\r\n      }\r\n\r\n      return session;\r\n      \r\n    } catch (error) {\r\n      console.error('âŒ [AuthService] Get session error:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check username availability\r\n   */\r\n  async checkUsername(username) {\r\n    try {\r\n      const response = await api.get(`${this.baseUrl}/check-username/${encodeURIComponent(username.trim())}`);\r\n      return response.data;\r\n      \r\n    } catch (error) {\r\n      console.error('âŒ [AuthService] Check username error:', error);\r\n      return {\r\n        success: false,\r\n        available: false,\r\n        message: error.response?.data?.message || 'Failed to check username availability'\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check email availability\r\n   */\r\n  async checkEmail(email) {\r\n    try {\r\n      const response = await api.get(`${this.baseUrl}/check-email/${encodeURIComponent(email.trim().toLowerCase())}`);\r\n      return response.data;\r\n      \r\n    } catch (error) {\r\n      console.error('âŒ [AuthService] Check email error:', error);\r\n      return {\r\n        success: false,\r\n        available: false,\r\n        message: error.response?.data?.message || 'Failed to check email availability'\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refresh access token\r\n   */\r\n  async refreshAccessToken() {\r\n    try {\r\n      const session = this.getCurrentSession();\r\n      \r\n      if (!session?.refreshToken) {\r\n        throw new Error('No refresh token available');\r\n      }\r\n\r\n      console.log('ðŸ”„ [AuthService] Refreshing access token...');\r\n      \r\n      const response = await api.post(`${this.baseUrl}/refresh`, {\r\n        refreshToken: session.refreshToken\r\n      });\r\n\r\n      const { success, data } = response.data;\r\n      \r\n      if (!success) {\r\n        throw new Error('Token refresh failed');\r\n      }\r\n\r\n      // Update stored session\r\n      this._storeAuthData(data);\r\n      \r\n      // Schedule next refresh\r\n      if (data.expiresAt) {\r\n        this._scheduleTokenRefresh(data.expiresAt);\r\n      }\r\n\r\n      console.log('âœ… [AuthService] Token refreshed successfully');\r\n      return { success: true, token: data.token };\r\n      \r\n    } catch (error) {\r\n      console.error('âŒ [AuthService] Token refresh error:', error);\r\n      this._clearAuthData();\r\n      return { \r\n        success: false, \r\n        message: 'Session expired. Please login again.' \r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update user profile\r\n   */\r\n  async updateProfile(updates) {\r\n    try {\r\n      const response = await api.put('/api/users/profile', updates);\r\n      return response.data;\r\n      \r\n    } catch (error) {\r\n      console.error('âŒ [AuthService] Update profile error:', error);\r\n      throw new Error(error.response?.data?.message || 'Failed to update profile');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Change password\r\n   */\r\n  async changePassword(currentPassword, newPassword) {\r\n    try {\r\n      const response = await api.post('/api/auth/change-password', {\r\n        currentPassword,\r\n        newPassword\r\n      });\r\n      return response.data;\r\n      \r\n    } catch (error) {\r\n      console.error('âŒ [AuthService] Change password error:', error);\r\n      throw new Error(error.response?.data?.message || 'Failed to change password');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Request password reset\r\n   */\r\n  async forgotPassword(email) {\r\n    try {\r\n      const response = await api.post('/api/auth/forgot-password', { email });\r\n      return response.data;\r\n      \r\n    } catch (error) {\r\n      console.error('âŒ [AuthService] Forgot password error:', error);\r\n      throw new Error(error.response?.data?.message || 'Failed to send reset email');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reset password with token\r\n   */\r\n  async resetPassword(token, passwordData) {\r\n    try {\r\n      const response = await api.post(`/api/auth/reset-password/${token}`, passwordData);\r\n      return response.data;\r\n      \r\n    } catch (error) {\r\n      console.error('âŒ [AuthService] Reset password error:', error);\r\n      throw new Error(error.response?.data?.message || 'Failed to reset password');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Verify email with token\r\n   */\r\n  async verifyEmail(token) {\r\n    try {\r\n      const response = await api.post(`/api/auth/verify-email/${token}`);\r\n      return response.data;\r\n      \r\n    } catch (error) {\r\n      console.error('âŒ [AuthService] Verify email error:', error);\r\n      throw new Error(error.response?.data?.message || 'Failed to verify email');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get authentication token\r\n   */\r\n  getToken() {\r\n    return localStorage.getItem('token');\r\n  }\r\n\r\n  /**\r\n   * Check if user is authenticated\r\n   */\r\n  isAuthenticated() {\r\n    const token = this.getToken();\r\n    const user = localStorage.getItem('user');\r\n    return !!(token && user);\r\n  }\r\n\r\n  /**\r\n   * Check if token is expired\r\n   */\r\n  isTokenExpired() {\r\n    const session = this.getCurrentSession();\r\n    if (!session?.expiresAt) return true;\r\n    \r\n    // Consider token expired 5 minutes before actual expiry\r\n    const bufferTime = 5 * 60 * 1000; // 5 minutes\r\n    return Date.now() > (session.expiresAt - bufferTime);\r\n  }\r\n\r\n  // ============================================\r\n  // PRIVATE METHODS\r\n  // ============================================\r\n\r\n  /**\r\n   * Store authentication data\r\n   */\r\n  _storeAuthData(data) {\r\n    if (data.token) {\r\n      localStorage.setItem('token', data.token);\r\n    }\r\n    \r\n    if (data.user) {\r\n      localStorage.setItem('user', JSON.stringify(data.user));\r\n    }\r\n    \r\n    if (data.expiresAt) {\r\n      const session = {\r\n        id: `session_${Date.now()}`,\r\n        accessToken: data.token,\r\n        refreshToken: data.refreshToken || `refresh_${Date.now()}`,\r\n        expiresAt: data.expiresAt,\r\n        createdAt: new Date().toISOString(),\r\n        user: data.user\r\n      };\r\n      localStorage.setItem('session', JSON.stringify(session));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear authentication data\r\n   */\r\n  _clearAuthData() {\r\n    // Clear localStorage\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('user');\r\n    localStorage.removeItem('session');\r\n    \r\n    // Clear sessionStorage\r\n    sessionStorage.clear();\r\n    \r\n    // Clear any refresh timeout\r\n    if (this.tokenRefreshTimeout) {\r\n      clearTimeout(this.tokenRefreshTimeout);\r\n      this.tokenRefreshTimeout = null;\r\n    }\r\n    \r\n    // Clear API default headers\r\n    if (api.defaults.headers.common['Authorization']) {\r\n      delete api.defaults.headers.common['Authorization'];\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Schedule token refresh\r\n   */\r\n  _scheduleTokenRefresh(expiresAt) {\r\n    // Clear existing timeout\r\n    if (this.tokenRefreshTimeout) {\r\n      clearTimeout(this.tokenRefreshTimeout);\r\n    }\r\n\r\n    // Refresh 5 minutes before expiry\r\n    const refreshTime = expiresAt - Date.now() - (5 * 60 * 1000);\r\n    \r\n    if (refreshTime > 0) {\r\n      this.tokenRefreshTimeout = setTimeout(async () => {\r\n        try {\r\n          await this.refreshAccessToken();\r\n        } catch (error) {\r\n          console.error('âŒ [AuthService] Scheduled token refresh failed:', error);\r\n        }\r\n      }, refreshTime);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initialize auth state\r\n   */\r\n  initialize() {\r\n    const token = this.getToken();\r\n    \r\n    if (token) {\r\n      // Set default Authorization header for all API calls\r\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n      \r\n      // Check if token needs refresh\r\n      if (this.isTokenExpired()) {\r\n        console.log('ðŸ”„ [AuthService] Initializing with expired token, will refresh...');\r\n        setTimeout(() => this.refreshAccessToken(), 1000);\r\n      } else {\r\n        const session = this.getCurrentSession();\r\n        if (session?.expiresAt) {\r\n          this._scheduleTokenRefresh(session.expiresAt);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nexport const authService = new AuthService();\r\nexport default authService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}