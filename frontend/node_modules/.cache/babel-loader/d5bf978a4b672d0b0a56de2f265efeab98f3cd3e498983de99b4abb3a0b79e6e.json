{"ast":null,"code":"// src/services/authService.js\n// Production-ready authentication service - COMPLETE INTEGRATION\n\nimport { apiService } from './api';\nimport { APIError, AuthError, NetworkError } from './api';\nclass AuthService {\n  constructor() {\n    this.baseUrl = '/api/auth';\n    this.tokenRefreshTimeout = null;\n    this.initializeAuth();\n  }\n\n  /**\r\n   * Initialize authentication state\r\n   */\n  initializeAuth() {\n    const token = localStorage.getItem('token');\n    const session = this.getCurrentSession();\n    if (token && session) {\n      // Set auth header\n      apiService.setAuthToken(token);\n\n      // Schedule token refresh\n      if (session.expiresAt && !this.isTokenExpired()) {\n        this._scheduleTokenRefresh(session.expiresAt);\n      }\n    }\n  }\n\n  /**\r\n   * Login user with real API\r\n   */\n  async login(email, password, rememberMe = false) {\n    try {\n      console.log('üîê [AuthService] Login attempt:', {\n        email: (email === null || email === void 0 ? void 0 : email.substring(0, 5)) + '...'\n      });\n      const response = await apiService.post(`${this.baseUrl}/login`, {\n        email: email.trim().toLowerCase(),\n        password,\n        rememberMe\n      });\n      const {\n        success,\n        data,\n        message\n      } = response.data;\n      if (!success) {\n        console.error('‚ùå [AuthService] Login failed:', message);\n        throw new APIError(message || 'Login failed', 401);\n      }\n\n      // Store authentication data\n      this._storeAuthData(data);\n\n      // Schedule token refresh if expiresAt is provided\n      if (data.expiresAt) {\n        this._scheduleTokenRefresh(data.expiresAt);\n      }\n      console.log('‚úÖ [AuthService] Login successful');\n      return {\n        success: true,\n        data,\n        message\n      };\n    } catch (error) {\n      console.error('‚ùå [AuthService] Login error:', error);\n\n      // Clear any existing auth data on login failure\n      this._clearAuthData();\n      if (error instanceof APIError || error instanceof AuthError) {\n        throw error;\n      }\n      throw new APIError(error.message || 'Login failed', 500);\n    }\n  }\n\n  /**\r\n   * Register new user with real API\r\n   */\n  async register(userData) {\n    try {\n      var _userData$firstName, _userData$lastName, _userData$phoneNumber, _userData$studentId, _userData$staffId;\n      console.log('üìù [AuthService] Registration attempt:', {\n        email: userData.email,\n        username: userData.username\n      });\n\n      // Prepare registration data\n      const registrationData = {\n        username: userData.username.trim(),\n        email: userData.email.trim().toLowerCase(),\n        password: userData.password,\n        firstName: ((_userData$firstName = userData.firstName) === null || _userData$firstName === void 0 ? void 0 : _userData$firstName.trim()) || userData.username,\n        lastName: ((_userData$lastName = userData.lastName) === null || _userData$lastName === void 0 ? void 0 : _userData$lastName.trim()) || 'User',\n        role: userData.role || 'student',\n        department: userData.department || 'computer_science',\n        phoneNumber: (_userData$phoneNumber = userData.phoneNumber) === null || _userData$phoneNumber === void 0 ? void 0 : _userData$phoneNumber.trim(),\n        studentId: (_userData$studentId = userData.studentId) === null || _userData$studentId === void 0 ? void 0 : _userData$studentId.trim(),\n        staffId: (_userData$staffId = userData.staffId) === null || _userData$staffId === void 0 ? void 0 : _userData$staffId.trim()\n      };\n      const response = await apiService.post(`${this.baseUrl}/register`, registrationData);\n      const {\n        success,\n        data,\n        message,\n        requiresVerification\n      } = response.data;\n      if (!success) {\n        console.error('‚ùå [AuthService] Registration failed:', message);\n        throw new APIError(message || 'Registration failed', 400);\n      }\n\n      // If registration includes auto-login, store auth data\n      if (data.token && data.user) {\n        this._storeAuthData(data);\n        if (data.expiresAt) {\n          this._scheduleTokenRefresh(data.expiresAt);\n        }\n      }\n      console.log('‚úÖ [AuthService] Registration successful');\n      return {\n        success: true,\n        data,\n        message,\n        requiresVerification\n      };\n    } catch (error) {\n      console.error('‚ùå [AuthService] Registration error:', error);\n      if (error instanceof APIError || error instanceof AuthError) {\n        throw error;\n      }\n      throw new APIError(error.message || 'Registration failed', 500);\n    }\n  }\n\n  /**\r\n   * Logout user with real API\r\n   */\n  async logout() {\n    try {\n      console.log('üö™ [AuthService] Logout request');\n\n      // Call logout API if authenticated\n      if (apiService.isAuthenticated()) {\n        await apiService.post(`${this.baseUrl}/logout`);\n      }\n    } catch (error) {\n      console.warn('‚ö†Ô∏è [AuthService] Logout API error:', error);\n      // Continue with local cleanup even if API fails\n    } finally {\n      // Always clear local storage\n      this._clearAuthData();\n      console.log('‚úÖ [AuthService] Logout completed');\n    }\n  }\n\n  /**\r\n   * Get current authenticated user from API\r\n   */\n  async getCurrentUser() {\n    try {\n      const token = this.getToken();\n      if (!token) {\n        return {\n          success: false,\n          message: 'No authentication token found'\n        };\n      }\n\n      // Verify token is still valid\n      if (this.isTokenExpired()) {\n        console.warn('‚ö†Ô∏è [AuthService] Token expired, attempting refresh...');\n        const refreshed = await this.refreshAccessToken();\n        if (!refreshed.success) {\n          this._clearAuthData();\n          return {\n            success: false,\n            message: 'Session expired. Please login again.'\n          };\n        }\n      }\n\n      // Get fresh user data from API\n      const response = await apiService.get(`${this.baseUrl}/me`);\n      return {\n        success: true,\n        data: response.data.data\n      };\n    } catch (error) {\n      console.error('‚ùå [AuthService] Get current user error:', error);\n\n      // Check if error is due to authentication\n      if (error instanceof AuthError) {\n        this._clearAuthData();\n        return {\n          success: false,\n          message: 'Session expired. Please login again.'\n        };\n      }\n\n      // Return error response\n      return {\n        success: false,\n        message: error.message || 'Failed to fetch user data'\n      };\n    }\n  }\n\n  /**\r\n   * Get current session from storage\r\n   */\n  getCurrentSession() {\n    try {\n      const sessionStr = localStorage.getItem('session');\n      if (!sessionStr) return null;\n      const session = JSON.parse(sessionStr);\n\n      // Check if session is still valid\n      if (session.expiresAt && Date.now() > session.expiresAt) {\n        console.warn('‚ö†Ô∏è [AuthService] Session expired');\n        this._clearAuthData();\n        return null;\n      }\n      return session;\n    } catch (error) {\n      console.error('‚ùå [AuthService] Get session error:', error);\n      return null;\n    }\n  }\n\n  /**\r\n   * Check username availability via API\r\n   */\n  async checkUsername(username) {\n    try {\n      const response = await apiService.get(`${this.baseUrl}/check-username/${encodeURIComponent(username.trim())}`);\n      return response.data;\n    } catch (error) {\n      console.error('‚ùå [AuthService] Check username error:', error);\n      return {\n        success: false,\n        available: false,\n        message: error.message || 'Failed to check username availability'\n      };\n    }\n  }\n\n  /**\r\n   * Check email availability via API\r\n   */\n  async checkEmail(email) {\n    try {\n      const response = await apiService.get(`${this.baseUrl}/check-email/${encodeURIComponent(email.trim().toLowerCase())}`);\n      return response.data;\n    } catch (error) {\n      console.error('‚ùå [AuthService] Check email error:', error);\n      return {\n        success: false,\n        available: false,\n        message: error.message || 'Failed to check email availability'\n      };\n    }\n  }\n\n  /**\r\n   * Refresh access token\r\n   */\n  async refreshAccessToken() {\n    try {\n      const session = this.getCurrentSession();\n      if (!(session !== null && session !== void 0 && session.refreshToken)) {\n        throw new AuthError('No refresh token available');\n      }\n      console.log('üîÑ [AuthService] Refreshing access token...');\n      const response = await apiService.post(`${this.baseUrl}/refresh`, {\n        refreshToken: session.refreshToken\n      });\n      const {\n        success,\n        data\n      } = response.data;\n      if (!success) {\n        throw new AuthError('Token refresh failed');\n      }\n\n      // Update stored session\n      this._storeAuthData(data);\n\n      // Schedule next refresh\n      if (data.expiresAt) {\n        this._scheduleTokenRefresh(data.expiresAt);\n      }\n      console.log('‚úÖ [AuthService] Token refreshed successfully');\n      return {\n        success: true,\n        token: data.token\n      };\n    } catch (error) {\n      console.error('‚ùå [AuthService] Token refresh error:', error);\n      this._clearAuthData();\n      return {\n        success: false,\n        message: 'Session expired. Please login again.'\n      };\n    }\n  }\n\n  /**\r\n   * Update user profile via API\r\n   */\n  async updateProfile(updates) {\n    try {\n      const response = await apiService.put('/api/users/profile', updates);\n      return response.data;\n    } catch (error) {\n      console.error('‚ùå [AuthService] Update profile error:', error);\n      if (error instanceof AuthError) {\n        throw error;\n      }\n      throw new APIError(error.message || 'Failed to update profile', 400);\n    }\n  }\n\n  /**\r\n   * Change password via API\r\n   */\n  async changePassword(currentPassword, newPassword) {\n    try {\n      console.log('üîê [AuthService] Change password request');\n      const response = await apiService.post(`${this.baseUrl}/change-password`, {\n        currentPassword,\n        newPassword\n      });\n      const {\n        success,\n        message\n      } = response.data;\n      if (!success) {\n        throw new APIError(message || 'Failed to change password', 400);\n      }\n      console.log('‚úÖ [AuthService] Password changed successfully');\n      return {\n        success: true,\n        message: message || 'Password changed successfully'\n      };\n    } catch (error) {\n      console.error('‚ùå [AuthService] Change password error:', error);\n      if (error instanceof APIError || error instanceof AuthError) {\n        throw error;\n      }\n      throw new APIError(error.message || 'Failed to change password', 400);\n    }\n  }\n\n  /**\r\n   * Forgot Password - Request password reset email\r\n   */\n  async forgotPassword(email) {\n    try {\n      console.log('üîë [AuthService] Forgot password request:', {\n        email: (email === null || email === void 0 ? void 0 : email.substring(0, 5)) + '...'\n      });\n      const response = await apiService.post(`${this.baseUrl}/forgot-password`, {\n        email: email.trim().toLowerCase()\n      });\n      const {\n        success,\n        message,\n        emailSent\n      } = response.data;\n      if (!success) {\n        throw new APIError(message || 'Failed to send reset email', 400);\n      }\n      console.log('‚úÖ [AuthService] Reset email sent');\n      return {\n        success: true,\n        message: message || 'Password reset email sent successfully',\n        emailSent: emailSent || false\n      };\n    } catch (error) {\n      var _error$response;\n      console.error('‚ùå [AuthService] Forgot password error:', error);\n\n      // Special handling for 404 - email not found\n      if (((_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 404) {\n        // For security, return success even if email not found\n        return {\n          success: true,\n          message: 'If an account exists with this email, a password reset link has been sent',\n          emailSent: false\n        };\n      }\n      if (error instanceof APIError) {\n        throw error;\n      }\n      throw new APIError(error.message || 'Failed to send reset email', 500);\n    }\n  }\n\n  /**\r\n   * Validate password reset token\r\n   */\n  async validateResetToken(token) {\n    try {\n      console.log('üîê [AuthService] Validating reset token');\n      const response = await apiService.get(`${this.baseUrl}/validate-reset-token/${token}`);\n      const {\n        success,\n        valid,\n        message,\n        email\n      } = response.data;\n      return {\n        success: success || false,\n        valid: valid || false,\n        message,\n        email\n      };\n    } catch (error) {\n      console.error('‚ùå [AuthService] Validate reset token error:', error);\n\n      // Return false for invalid tokens\n      return {\n        success: false,\n        valid: false,\n        message: error.message || 'Invalid or expired reset token',\n        email: null\n      };\n    }\n  }\n\n  /**\r\n   * Reset password with token\r\n   */\n  async resetPassword(token, password) {\n    try {\n      console.log('üîÑ [AuthService] Reset password request');\n      const response = await apiService.post(`${this.baseUrl}/reset-password/${token}`, {\n        password\n      });\n      const {\n        success,\n        message\n      } = response.data;\n      if (!success) {\n        throw new APIError(message || 'Failed to reset password', 400);\n      }\n      console.log('‚úÖ [AuthService] Password reset successful');\n      return {\n        success: true,\n        message: message || 'Password reset successfully'\n      };\n    } catch (error) {\n      console.error('‚ùå [AuthService] Reset password error:', error);\n      if (error instanceof APIError) {\n        throw error;\n      }\n      throw new APIError(error.message || 'Failed to reset password', 500);\n    }\n  }\n\n  /**\r\n   * Verify email with token\r\n   */\n  async verifyEmail(token) {\n    try {\n      console.log('üìß [AuthService] Verify email request');\n      const response = await apiService.get(`${this.baseUrl}/verify-email/${token}`);\n      console.log('üì• [AuthService] Verification API response:', response.data);\n      const {\n        success,\n        data,\n        message,\n        redirectUrl\n      } = response.data;\n      if (!success) {\n        // Throw error with proper message\n        throw new APIError(message || 'Email verification failed', 400);\n      }\n      console.log('‚úÖ [AuthService] Email verified successfully');\n      return {\n        success: true,\n        data: data || {},\n        message: message || 'Email verified successfully',\n        redirectUrl: redirectUrl || null\n      };\n    } catch (error) {\n      var _error$response2, _error$response2$data, _error$response3;\n      console.error('‚ùå [AuthService] Verify email error:', error);\n\n      // Always throw - don't return { success: false }\n      if (error instanceof APIError) {\n        throw error;\n      }\n      throw new APIError(((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) || error.message || 'Email verification failed', ((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : _error$response3.status) || 500);\n    }\n  }\n\n  /**\r\n   * Resend verification email\r\n   */\n  async resendVerification(email) {\n    try {\n      console.log('üìß [AuthService] Resend verification request');\n      const response = await apiService.post(`${this.baseUrl}/resend-verification`, {\n        email: email.trim().toLowerCase()\n      });\n      const {\n        success,\n        message,\n        emailSent\n      } = response.data;\n      if (!success) {\n        throw new APIError(message || 'Failed to resend verification email', 400);\n      }\n      console.log('‚úÖ [AuthService] Verification email resent');\n      return {\n        success: true,\n        message: message || 'Verification email sent successfully',\n        emailSent: emailSent || false\n      };\n    } catch (error) {\n      var _error$response4;\n      console.error('‚ùå [AuthService] Resend verification error:', error);\n\n      // Special handling for already verified emails\n      if (((_error$response4 = error.response) === null || _error$response4 === void 0 ? void 0 : _error$response4.status) === 400) {\n        var _error$response$data;\n        const errorMessage = ((_error$response$data = error.response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || '';\n        if (errorMessage.includes('already verified')) {\n          return {\n            success: false,\n            message: 'Email is already verified',\n            emailSent: false\n          };\n        }\n      }\n      if (error instanceof APIError) {\n        throw error;\n      }\n      throw new APIError(error.message || 'Failed to resend verification email', 500);\n    }\n  }\n\n  /**\r\n   * Get authentication token\r\n   */\n  getToken() {\n    return localStorage.getItem('token');\n  }\n\n  /**\r\n   * Check if user is authenticated\r\n   */\n  isAuthenticated() {\n    const token = this.getToken();\n    const user = localStorage.getItem('user');\n    const session = this.getCurrentSession();\n    return !!(token && user && session);\n  }\n\n  /**\r\n   * Check if token is expired\r\n   */\n  isTokenExpired() {\n    const session = this.getCurrentSession();\n    if (!(session !== null && session !== void 0 && session.expiresAt)) return true;\n\n    // Consider token expired 5 minutes before actual expiry\n    const bufferTime = 5 * 60 * 1000; // 5 minutes\n    return Date.now() > session.expiresAt - bufferTime;\n  }\n\n  // ============================================\n  // PRIVATE METHODS\n  // ============================================\n\n  /**\r\n   * Store authentication data\r\n   */\n  _storeAuthData(data) {\n    if (data.token) {\n      localStorage.setItem('token', data.token);\n      apiService.setAuthToken(data.token);\n    }\n    if (data.user) {\n      localStorage.setItem('user', JSON.stringify(data.user));\n    }\n    if (data.expiresAt) {\n      const session = {\n        id: `session_${Date.now()}`,\n        accessToken: data.token,\n        refreshToken: data.refreshToken || `refresh_${Date.now()}`,\n        expiresAt: data.expiresAt,\n        createdAt: new Date().toISOString(),\n        user: data.user\n      };\n      localStorage.setItem('session', JSON.stringify(session));\n    }\n  }\n\n  /**\r\n   * Clear authentication data\r\n   */\n  _clearAuthData() {\n    // Clear localStorage\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    localStorage.removeItem('session');\n\n    // Clear sessionStorage\n    sessionStorage.clear();\n\n    // Clear API service auth\n    apiService.clearAuthToken();\n\n    // Clear any refresh timeout\n    if (this.tokenRefreshTimeout) {\n      clearTimeout(this.tokenRefreshTimeout);\n      this.tokenRefreshTimeout = null;\n    }\n    console.log('üßπ [AuthService] Auth data cleared');\n  }\n\n  /**\r\n   * Schedule token refresh\r\n   */\n  _scheduleTokenRefresh(expiresAt) {\n    // Clear existing timeout\n    if (this.tokenRefreshTimeout) {\n      clearTimeout(this.tokenRefreshTimeout);\n    }\n\n    // Refresh 5 minutes before expiry\n    const refreshTime = expiresAt - Date.now() - 5 * 60 * 1000;\n    if (refreshTime > 0) {\n      this.tokenRefreshTimeout = setTimeout(async () => {\n        try {\n          console.log('üîÑ [AuthService] Auto-refreshing token...');\n          await this.refreshAccessToken();\n        } catch (error) {\n          console.error('‚ùå [AuthService] Scheduled token refresh failed:', error);\n          // Clear auth data on refresh failure\n          this._clearAuthData();\n\n          // Redirect to login if not already there\n          if (!window.location.pathname.includes('/login')) {\n            window.location.href = '/login?session=expired';\n          }\n        }\n      }, refreshTime);\n      console.log(`‚è∞ [AuthService] Token refresh scheduled in ${Math.round(refreshTime / 1000 / 60)} minutes`);\n    } else {\n      console.warn('‚ö†Ô∏è [AuthService] Token already expired or expiring soon');\n    }\n  }\n}\n\n// Export singleton instance\nconst authService = new AuthService();\nexport { authService };\nexport default authService;","map":{"version":3,"names":["apiService","APIError","AuthError","NetworkError","AuthService","constructor","baseUrl","tokenRefreshTimeout","initializeAuth","token","localStorage","getItem","session","getCurrentSession","setAuthToken","expiresAt","isTokenExpired","_scheduleTokenRefresh","login","email","password","rememberMe","console","log","substring","response","post","trim","toLowerCase","success","data","message","error","_storeAuthData","_clearAuthData","register","userData","_userData$firstName","_userData$lastName","_userData$phoneNumber","_userData$studentId","_userData$staffId","username","registrationData","firstName","lastName","role","department","phoneNumber","studentId","staffId","requiresVerification","user","logout","isAuthenticated","warn","getCurrentUser","getToken","refreshed","refreshAccessToken","get","sessionStr","JSON","parse","Date","now","checkUsername","encodeURIComponent","available","checkEmail","refreshToken","updateProfile","updates","put","changePassword","currentPassword","newPassword","forgotPassword","emailSent","_error$response","status","validateResetToken","valid","resetPassword","verifyEmail","redirectUrl","_error$response2","_error$response2$data","_error$response3","resendVerification","_error$response4","_error$response$data","errorMessage","includes","bufferTime","setItem","stringify","id","accessToken","createdAt","toISOString","removeItem","sessionStorage","clear","clearAuthToken","clearTimeout","refreshTime","setTimeout","window","location","pathname","href","Math","round","authService"],"sources":["C:/Users/KADZ-TECH/Documents/dev/it-support-system/frontend/src/services/authService.js"],"sourcesContent":["// src/services/authService.js\r\n// Production-ready authentication service - COMPLETE INTEGRATION\r\n\r\nimport { apiService } from './api';\r\nimport { APIError, AuthError, NetworkError } from './api';\r\n\r\nclass AuthService {\r\n  constructor() {\r\n    this.baseUrl = '/api/auth';\r\n    this.tokenRefreshTimeout = null;\r\n    this.initializeAuth();\r\n  }\r\n\r\n  /**\r\n   * Initialize authentication state\r\n   */\r\n  initializeAuth() {\r\n    const token = localStorage.getItem('token');\r\n    const session = this.getCurrentSession();\r\n    \r\n    if (token && session) {\r\n      // Set auth header\r\n      apiService.setAuthToken(token);\r\n      \r\n      // Schedule token refresh\r\n      if (session.expiresAt && !this.isTokenExpired()) {\r\n        this._scheduleTokenRefresh(session.expiresAt);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Login user with real API\r\n   */\r\n  async login(email, password, rememberMe = false) {\r\n    try {\r\n      console.log('üîê [AuthService] Login attempt:', { email: email?.substring(0, 5) + '...' });\r\n      \r\n      const response = await apiService.post(`${this.baseUrl}/login`, {\r\n        email: email.trim().toLowerCase(),\r\n        password,\r\n        rememberMe\r\n      });\r\n\r\n      const { success, data, message } = response.data;\r\n      \r\n      if (!success) {\r\n        console.error('‚ùå [AuthService] Login failed:', message);\r\n        throw new APIError(message || 'Login failed', 401);\r\n      }\r\n\r\n      // Store authentication data\r\n      this._storeAuthData(data);\r\n      \r\n      // Schedule token refresh if expiresAt is provided\r\n      if (data.expiresAt) {\r\n        this._scheduleTokenRefresh(data.expiresAt);\r\n      }\r\n\r\n      console.log('‚úÖ [AuthService] Login successful');\r\n      return { success: true, data, message };\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå [AuthService] Login error:', error);\r\n      \r\n      // Clear any existing auth data on login failure\r\n      this._clearAuthData();\r\n      \r\n      if (error instanceof APIError || error instanceof AuthError) {\r\n        throw error;\r\n      }\r\n      \r\n      throw new APIError(error.message || 'Login failed', 500);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Register new user with real API\r\n   */\r\n  async register(userData) {\r\n    try {\r\n      console.log('üìù [AuthService] Registration attempt:', { \r\n        email: userData.email, \r\n        username: userData.username \r\n      });\r\n      \r\n      // Prepare registration data\r\n      const registrationData = {\r\n        username: userData.username.trim(),\r\n        email: userData.email.trim().toLowerCase(),\r\n        password: userData.password,\r\n        firstName: userData.firstName?.trim() || userData.username,\r\n        lastName: userData.lastName?.trim() || 'User',\r\n        role: userData.role || 'student',\r\n        department: userData.department || 'computer_science',\r\n        phoneNumber: userData.phoneNumber?.trim(),\r\n        studentId: userData.studentId?.trim(),\r\n        staffId: userData.staffId?.trim()\r\n      };\r\n\r\n      const response = await apiService.post(`${this.baseUrl}/register`, registrationData);\r\n\r\n      const { success, data, message, requiresVerification } = response.data;\r\n      \r\n      if (!success) {\r\n        console.error('‚ùå [AuthService] Registration failed:', message);\r\n        throw new APIError(message || 'Registration failed', 400);\r\n      }\r\n\r\n      // If registration includes auto-login, store auth data\r\n      if (data.token && data.user) {\r\n        this._storeAuthData(data);\r\n        \r\n        if (data.expiresAt) {\r\n          this._scheduleTokenRefresh(data.expiresAt);\r\n        }\r\n      }\r\n\r\n      console.log('‚úÖ [AuthService] Registration successful');\r\n      return { \r\n        success: true, \r\n        data, \r\n        message, \r\n        requiresVerification \r\n      };\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå [AuthService] Registration error:', error);\r\n      \r\n      if (error instanceof APIError || error instanceof AuthError) {\r\n        throw error;\r\n      }\r\n      \r\n      throw new APIError(error.message || 'Registration failed', 500);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Logout user with real API\r\n   */\r\n  async logout() {\r\n    try {\r\n      console.log('üö™ [AuthService] Logout request');\r\n      \r\n      // Call logout API if authenticated\r\n      if (apiService.isAuthenticated()) {\r\n        await apiService.post(`${this.baseUrl}/logout`);\r\n      }\r\n      \r\n    } catch (error) {\r\n      console.warn('‚ö†Ô∏è [AuthService] Logout API error:', error);\r\n      // Continue with local cleanup even if API fails\r\n    } finally {\r\n      // Always clear local storage\r\n      this._clearAuthData();\r\n      console.log('‚úÖ [AuthService] Logout completed');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current authenticated user from API\r\n   */\r\n  async getCurrentUser() {\r\n    try {\r\n      const token = this.getToken();\r\n      \r\n      if (!token) {\r\n        return { success: false, message: 'No authentication token found' };\r\n      }\r\n\r\n      // Verify token is still valid\r\n      if (this.isTokenExpired()) {\r\n        console.warn('‚ö†Ô∏è [AuthService] Token expired, attempting refresh...');\r\n        const refreshed = await this.refreshAccessToken();\r\n        \r\n        if (!refreshed.success) {\r\n          this._clearAuthData();\r\n          return { success: false, message: 'Session expired. Please login again.' };\r\n        }\r\n      }\r\n\r\n      // Get fresh user data from API\r\n      const response = await apiService.get(`${this.baseUrl}/me`);\r\n      \r\n      return { \r\n        success: true, \r\n        data: response.data.data \r\n      };\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå [AuthService] Get current user error:', error);\r\n      \r\n      // Check if error is due to authentication\r\n      if (error instanceof AuthError) {\r\n        this._clearAuthData();\r\n        return { \r\n          success: false, \r\n          message: 'Session expired. Please login again.' \r\n        };\r\n      }\r\n      \r\n      // Return error response\r\n      return { \r\n        success: false, \r\n        message: error.message || 'Failed to fetch user data' \r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current session from storage\r\n   */\r\n  getCurrentSession() {\r\n    try {\r\n      const sessionStr = localStorage.getItem('session');\r\n      if (!sessionStr) return null;\r\n\r\n      const session = JSON.parse(sessionStr);\r\n      \r\n      // Check if session is still valid\r\n      if (session.expiresAt && Date.now() > session.expiresAt) {\r\n        console.warn('‚ö†Ô∏è [AuthService] Session expired');\r\n        this._clearAuthData();\r\n        return null;\r\n      }\r\n\r\n      return session;\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå [AuthService] Get session error:', error);\r\n      return null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check username availability via API\r\n   */\r\n  async checkUsername(username) {\r\n    try {\r\n      const response = await apiService.get(`${this.baseUrl}/check-username/${encodeURIComponent(username.trim())}`);\r\n      return response.data;\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå [AuthService] Check username error:', error);\r\n      return {\r\n        success: false,\r\n        available: false,\r\n        message: error.message || 'Failed to check username availability'\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check email availability via API\r\n   */\r\n  async checkEmail(email) {\r\n    try {\r\n      const response = await apiService.get(`${this.baseUrl}/check-email/${encodeURIComponent(email.trim().toLowerCase())}`);\r\n      return response.data;\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå [AuthService] Check email error:', error);\r\n      return {\r\n        success: false,\r\n        available: false,\r\n        message: error.message || 'Failed to check email availability'\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refresh access token\r\n   */\r\n  async refreshAccessToken() {\r\n    try {\r\n      const session = this.getCurrentSession();\r\n      \r\n      if (!session?.refreshToken) {\r\n        throw new AuthError('No refresh token available');\r\n      }\r\n\r\n      console.log('üîÑ [AuthService] Refreshing access token...');\r\n      \r\n      const response = await apiService.post(`${this.baseUrl}/refresh`, {\r\n        refreshToken: session.refreshToken\r\n      });\r\n\r\n      const { success, data } = response.data;\r\n      \r\n      if (!success) {\r\n        throw new AuthError('Token refresh failed');\r\n      }\r\n\r\n      // Update stored session\r\n      this._storeAuthData(data);\r\n      \r\n      // Schedule next refresh\r\n      if (data.expiresAt) {\r\n        this._scheduleTokenRefresh(data.expiresAt);\r\n      }\r\n\r\n      console.log('‚úÖ [AuthService] Token refreshed successfully');\r\n      return { success: true, token: data.token };\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå [AuthService] Token refresh error:', error);\r\n      this._clearAuthData();\r\n      return { \r\n        success: false, \r\n        message: 'Session expired. Please login again.' \r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update user profile via API\r\n   */\r\n  async updateProfile(updates) {\r\n    try {\r\n      const response = await apiService.put('/api/users/profile', updates);\r\n      return response.data;\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå [AuthService] Update profile error:', error);\r\n      \r\n      if (error instanceof AuthError) {\r\n        throw error;\r\n      }\r\n      \r\n      throw new APIError(error.message || 'Failed to update profile', 400);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Change password via API\r\n   */\r\n  async changePassword(currentPassword, newPassword) {\r\n    try {\r\n      console.log('üîê [AuthService] Change password request');\r\n      \r\n      const response = await apiService.post(`${this.baseUrl}/change-password`, {\r\n        currentPassword,\r\n        newPassword\r\n      });\r\n\r\n      const { success, message } = response.data;\r\n      \r\n      if (!success) {\r\n        throw new APIError(message || 'Failed to change password', 400);\r\n      }\r\n\r\n      console.log('‚úÖ [AuthService] Password changed successfully');\r\n      return { \r\n        success: true, \r\n        message: message || 'Password changed successfully' \r\n      };\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå [AuthService] Change password error:', error);\r\n      \r\n      if (error instanceof APIError || error instanceof AuthError) {\r\n        throw error;\r\n      }\r\n      \r\n      throw new APIError(error.message || 'Failed to change password', 400);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Forgot Password - Request password reset email\r\n   */\r\n  async forgotPassword(email) {\r\n    try {\r\n      console.log('üîë [AuthService] Forgot password request:', { email: email?.substring(0, 5) + '...' });\r\n      \r\n      const response = await apiService.post(`${this.baseUrl}/forgot-password`, { \r\n        email: email.trim().toLowerCase() \r\n      });\r\n\r\n      const { success, message, emailSent } = response.data;\r\n      \r\n      if (!success) {\r\n        throw new APIError(message || 'Failed to send reset email', 400);\r\n      }\r\n\r\n      console.log('‚úÖ [AuthService] Reset email sent');\r\n      return { \r\n        success: true, \r\n        message: message || 'Password reset email sent successfully',\r\n        emailSent: emailSent || false\r\n      };\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå [AuthService] Forgot password error:', error);\r\n      \r\n      // Special handling for 404 - email not found\r\n      if (error.response?.status === 404) {\r\n        // For security, return success even if email not found\r\n        return {\r\n          success: true,\r\n          message: 'If an account exists with this email, a password reset link has been sent',\r\n          emailSent: false\r\n        };\r\n      }\r\n      \r\n      if (error instanceof APIError) {\r\n        throw error;\r\n      }\r\n      \r\n      throw new APIError(error.message || 'Failed to send reset email', 500);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validate password reset token\r\n   */\r\n  async validateResetToken(token) {\r\n    try {\r\n      console.log('üîê [AuthService] Validating reset token');\r\n      \r\n      const response = await apiService.get(`${this.baseUrl}/validate-reset-token/${token}`);\r\n      \r\n      const { success, valid, message, email } = response.data;\r\n      \r\n      return { \r\n        success: success || false, \r\n        valid: valid || false, \r\n        message, \r\n        email \r\n      };\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå [AuthService] Validate reset token error:', error);\r\n      \r\n      // Return false for invalid tokens\r\n      return {\r\n        success: false,\r\n        valid: false,\r\n        message: error.message || 'Invalid or expired reset token',\r\n        email: null\r\n      };\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Reset password with token\r\n   */\r\n  async resetPassword(token, password) {\r\n    try {\r\n      console.log('üîÑ [AuthService] Reset password request');\r\n      \r\n      const response = await apiService.post(`${this.baseUrl}/reset-password/${token}`, { \r\n        password \r\n      });\r\n\r\n      const { success, message } = response.data;\r\n      \r\n      if (!success) {\r\n        throw new APIError(message || 'Failed to reset password', 400);\r\n      }\r\n\r\n      console.log('‚úÖ [AuthService] Password reset successful');\r\n      return { \r\n        success: true, \r\n        message: message || 'Password reset successfully' \r\n      };\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå [AuthService] Reset password error:', error);\r\n      \r\n      if (error instanceof APIError) {\r\n        throw error;\r\n      }\r\n      \r\n      throw new APIError(error.message || 'Failed to reset password', 500);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Verify email with token\r\n   */\r\n  async verifyEmail(token) {\r\n    try {\r\n      console.log('üìß [AuthService] Verify email request');\r\n      \r\n      const response = await apiService.get(`${this.baseUrl}/verify-email/${token}`);\r\n      \r\n      console.log('üì• [AuthService] Verification API response:', response.data);\r\n\r\n      const { success, data, message, redirectUrl } = response.data;\r\n      \r\n      if (!success) {\r\n        // Throw error with proper message\r\n        throw new APIError(message || 'Email verification failed', 400);\r\n      }\r\n\r\n      console.log('‚úÖ [AuthService] Email verified successfully');\r\n      return { \r\n        success: true, \r\n        data: data || {},\r\n        message: message || 'Email verified successfully',\r\n        redirectUrl: redirectUrl || null\r\n      };\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå [AuthService] Verify email error:', error);\r\n      \r\n      // Always throw - don't return { success: false }\r\n      if (error instanceof APIError) {\r\n        throw error;\r\n      }\r\n      \r\n      throw new APIError(\r\n        error.response?.data?.message || \r\n        error.message || \r\n        'Email verification failed', \r\n        error.response?.status || 500\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resend verification email\r\n   */\r\n  async resendVerification(email) {\r\n    try {\r\n      console.log('üìß [AuthService] Resend verification request');\r\n      \r\n      const response = await apiService.post(`${this.baseUrl}/resend-verification`, { \r\n        email: email.trim().toLowerCase() \r\n      });\r\n\r\n      const { success, message, emailSent } = response.data;\r\n      \r\n      if (!success) {\r\n        throw new APIError(message || 'Failed to resend verification email', 400);\r\n      }\r\n\r\n      console.log('‚úÖ [AuthService] Verification email resent');\r\n      return { \r\n        success: true, \r\n        message: message || 'Verification email sent successfully',\r\n        emailSent: emailSent || false\r\n      };\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå [AuthService] Resend verification error:', error);\r\n      \r\n      // Special handling for already verified emails\r\n      if (error.response?.status === 400) {\r\n        const errorMessage = error.response.data?.message || '';\r\n        if (errorMessage.includes('already verified')) {\r\n          return {\r\n            success: false,\r\n            message: 'Email is already verified',\r\n            emailSent: false\r\n          };\r\n        }\r\n      }\r\n      \r\n      if (error instanceof APIError) {\r\n        throw error;\r\n      }\r\n      \r\n      throw new APIError(error.message || 'Failed to resend verification email', 500);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get authentication token\r\n   */\r\n  getToken() {\r\n    return localStorage.getItem('token');\r\n  }\r\n\r\n  /**\r\n   * Check if user is authenticated\r\n   */\r\n  isAuthenticated() {\r\n    const token = this.getToken();\r\n    const user = localStorage.getItem('user');\r\n    const session = this.getCurrentSession();\r\n    \r\n    return !!(token && user && session);\r\n  }\r\n\r\n  /**\r\n   * Check if token is expired\r\n   */\r\n  isTokenExpired() {\r\n    const session = this.getCurrentSession();\r\n    if (!session?.expiresAt) return true;\r\n    \r\n    // Consider token expired 5 minutes before actual expiry\r\n    const bufferTime = 5 * 60 * 1000; // 5 minutes\r\n    return Date.now() > (session.expiresAt - bufferTime);\r\n  }\r\n\r\n  // ============================================\r\n  // PRIVATE METHODS\r\n  // ============================================\r\n\r\n  /**\r\n   * Store authentication data\r\n   */\r\n  _storeAuthData(data) {\r\n    if (data.token) {\r\n      localStorage.setItem('token', data.token);\r\n      apiService.setAuthToken(data.token);\r\n    }\r\n    \r\n    if (data.user) {\r\n      localStorage.setItem('user', JSON.stringify(data.user));\r\n    }\r\n    \r\n    if (data.expiresAt) {\r\n      const session = {\r\n        id: `session_${Date.now()}`,\r\n        accessToken: data.token,\r\n        refreshToken: data.refreshToken || `refresh_${Date.now()}`,\r\n        expiresAt: data.expiresAt,\r\n        createdAt: new Date().toISOString(),\r\n        user: data.user\r\n      };\r\n      localStorage.setItem('session', JSON.stringify(session));\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clear authentication data\r\n   */\r\n  _clearAuthData() {\r\n    // Clear localStorage\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('user');\r\n    localStorage.removeItem('session');\r\n    \r\n    // Clear sessionStorage\r\n    sessionStorage.clear();\r\n    \r\n    // Clear API service auth\r\n    apiService.clearAuthToken();\r\n    \r\n    // Clear any refresh timeout\r\n    if (this.tokenRefreshTimeout) {\r\n      clearTimeout(this.tokenRefreshTimeout);\r\n      this.tokenRefreshTimeout = null;\r\n    }\r\n    \r\n    console.log('üßπ [AuthService] Auth data cleared');\r\n  }\r\n\r\n  /**\r\n   * Schedule token refresh\r\n   */\r\n  _scheduleTokenRefresh(expiresAt) {\r\n    // Clear existing timeout\r\n    if (this.tokenRefreshTimeout) {\r\n      clearTimeout(this.tokenRefreshTimeout);\r\n    }\r\n\r\n    // Refresh 5 minutes before expiry\r\n    const refreshTime = expiresAt - Date.now() - (5 * 60 * 1000);\r\n    \r\n    if (refreshTime > 0) {\r\n      this.tokenRefreshTimeout = setTimeout(async () => {\r\n        try {\r\n          console.log('üîÑ [AuthService] Auto-refreshing token...');\r\n          await this.refreshAccessToken();\r\n        } catch (error) {\r\n          console.error('‚ùå [AuthService] Scheduled token refresh failed:', error);\r\n          // Clear auth data on refresh failure\r\n          this._clearAuthData();\r\n          \r\n          // Redirect to login if not already there\r\n          if (!window.location.pathname.includes('/login')) {\r\n            window.location.href = '/login?session=expired';\r\n          }\r\n        }\r\n      }, refreshTime);\r\n      \r\n      console.log(`‚è∞ [AuthService] Token refresh scheduled in ${Math.round(refreshTime / 1000 / 60)} minutes`);\r\n    } else {\r\n      console.warn('‚ö†Ô∏è [AuthService] Token already expired or expiring soon');\r\n    }\r\n  }\r\n}\r\n\r\n// Export singleton instance\r\nconst authService = new AuthService();\r\nexport { authService };\r\nexport default authService;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}