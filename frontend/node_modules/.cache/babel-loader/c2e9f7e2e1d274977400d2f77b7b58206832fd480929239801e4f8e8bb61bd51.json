{"ast":null,"code":"import _objectSpread from\"C:/Users/KADZ-TECH/Documents/dev/it-support-system/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useState,useContext,useEffect,useCallback,useRef}from'react';import authService from'../services/authService';import api from'../services/api';/**\r\n * AuthContext - Enterprise Authentication System\r\n * \r\n * Features:\r\n * - JWT token management with auto-refresh\r\n * - Session validation and monitoring\r\n * - Role-based access control\r\n * - Activity logging\r\n * - Security event tracking\r\n * - Concurrent session prevention\r\n * - Token refresh queue\r\n * - Graceful error handling\r\n * \r\n * @version 4.2.1\r\n * @author IT Support Team\r\n */import{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();/**\r\n * Custom hook to access authentication context\r\n * \r\n * @returns {Object} Authentication context\r\n * @throws {Error} If used outside AuthProvider\r\n */export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};/**\r\n * Validates user data structure\r\n * \r\n * @param {Object} userData - User data to validate\r\n * @returns {boolean} True if valid\r\n */const validateUserData=userData=>{if(!userData||typeof userData!=='object'){return false;}// Required fields\nconst requiredFields=['_id','email','role'];for(const field of requiredFields){if(!userData[field]){console.warn(\"Invalid user data: Missing \".concat(field));return false;}}// Validate role\nconst validRoles=['admin','technician','staff','student'];if(!validRoles.includes(userData.role)){console.warn(\"Invalid user data: Invalid role \\\"\".concat(userData.role,\"\\\"\"));return false;}// Validate email format\nconst emailRegex=/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;if(!emailRegex.test(userData.email)){console.warn(\"Invalid user data: Invalid email \\\"\".concat(userData.email,\"\\\"\"));return false;}return true;};/**\r\n * Sanitizes user data before storage\r\n * \r\n * @param {Object} userData - Raw user data\r\n * @returns {Object} Sanitized user data\r\n */const sanitizeUserData=userData=>{if(!userData)return null;const sanitized=_objectSpread({},userData);// Remove sensitive fields\ndelete sanitized.password;delete sanitized.tempPassword;delete sanitized.resetToken;delete sanitized.verificationToken;delete sanitized.__v;// Ensure role is lowercase\nif(sanitized.role){sanitized.role=sanitized.role.toLowerCase();}return sanitized;};/**\r\n * Sends security events to monitoring service\r\n */const sendToSecurityLog=eventData=>{try{// Store in localStorage for debugging (remove in production)\nconst existingEvents=JSON.parse(localStorage.getItem('security_events')||'[]');existingEvents.push(eventData);// Keep only last 50 events\nif(existingEvents.length>50){existingEvents.shift();}localStorage.setItem('security_events',JSON.stringify(existingEvents));}catch(e){// Silently fail if localStorage is not available\n}};/**\r\n * AuthProvider Component\r\n * \r\n * @param {Object} props - Component properties\r\n * @param {ReactNode} props.children - Child components\r\n */export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[sessionValid,setSessionValid]=useState(false);const[sessionExpiresAt,setSessionExpiresAt]=useState(null);const[authError,setAuthError]=useState(null);const[authSuccess,setAuthSuccess]=useState(null);const refreshTimeoutRef=useRef(null);const sessionCheckIntervalRef=useRef(null);const isRefreshingRef=useRef(false);const refreshQueueRef=useRef([]);/**\r\n   * Logs security events for monitoring\r\n   */const logSecurityEvent=useCallback(function(eventType){let data=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const securityEvent=_objectSpread(_objectSpread({timestamp:new Date().toISOString(),event:eventType,userId:user===null||user===void 0?void 0:user._id,userRole:user===null||user===void 0?void 0:user.role},data),{},{userAgent:navigator.userAgent,ip:'client-ip'});// Log to console in development\nif(process.env.NODE_ENV==='development'){console.log('ðŸ”’ Security Event:',securityEvent);}// Send to security monitoring service\nsendToSecurityLog(securityEvent);},[user]);/**\r\n   * Clears authentication errors and success messages\r\n   */const clearError=useCallback(()=>{setAuthError(null);},[]);const clearSuccess=useCallback(()=>{setAuthSuccess(null);},[]);/**\r\n   * Sets authentication error\r\n   */const setError=useCallback(message=>{setAuthError(message);// Auto-clear error after 10 seconds\nsetTimeout(()=>{setAuthError(null);},10000);},[]);/**\r\n   * Sets authentication success message\r\n   */const setSuccess=useCallback(message=>{setAuthSuccess(message);// Auto-clear success after 5 seconds\nsetTimeout(()=>{setAuthSuccess(null);},5000);},[]);/**\r\n   * Refreshes authentication token\r\n   */const refreshToken=useCallback(async()=>{// Prevent multiple concurrent refresh attempts\nif(isRefreshingRef.current){return new Promise((resolve,reject)=>{refreshQueueRef.current.push({resolve,reject});});}try{var _response$data,_response$data2;isRefreshingRef.current=true;const response=await authService.refreshToken();if(!response.success||!((_response$data=response.data)!==null&&_response$data!==void 0&&_response$data.accessToken)||!((_response$data2=response.data)!==null&&_response$data2!==void 0&&_response$data2.user)){throw new Error('Invalid refresh response');}// Validate user data\nif(!validateUserData(response.data.user)){throw new Error('Invalid user data in refresh response');}const sanitizedUser=sanitizeUserData(response.data.user);const accessToken=response.data.accessToken;// Update state and storage\nsetUser(sanitizedUser);setSessionValid(true);const storage=localStorage.getItem('token')?localStorage:sessionStorage;storage.setItem('token',accessToken);storage.setItem('user',JSON.stringify(sanitizedUser));// Update API headers\napi.defaults.headers.common['Authorization']=\"Bearer \".concat(accessToken);// Set new session expiry (24 hours from now)\nconst expiryTime=Date.now()+24*60*60*1000;setSessionExpiresAt(expiryTime);localStorage.setItem('sessionExpiry',expiryTime.toString());// Schedule next refresh\nscheduleTokenRefresh();// Process queued requests\nwhile(refreshQueueRef.current.length>0){const queued=refreshQueueRef.current.shift();queued.resolve();}return response;}catch(error){console.error('Token refresh failed:',error);// Process queued requests with error\nwhile(refreshQueueRef.current.length>0){const queued=refreshQueueRef.current.shift();queued.reject(error);}throw error;}finally{isRefreshingRef.current=false;}},[]);/**\r\n   * Schedules token refresh before expiry\r\n   */const scheduleTokenRefresh=useCallback(()=>{// Clear existing timeout\nif(refreshTimeoutRef.current){clearTimeout(refreshTimeoutRef.current);}// Schedule refresh 5 minutes before expiry\nconst refreshTime=sessionExpiresAt?sessionExpiresAt-5*60*1000-Date.now():55*60*1000;// Default: 55 minutes\nif(refreshTime>0){refreshTimeoutRef.current=setTimeout(async()=>{try{await refreshToken();}catch(error){console.error('Scheduled token refresh failed:',error);// Don't logout immediately, let session monitoring handle it\n}},refreshTime);}},[sessionExpiresAt,refreshToken]);/**\r\n   * Starts session monitoring\r\n   */const startSessionMonitoring=useCallback(()=>{// Clear existing interval\nif(sessionCheckIntervalRef.current){clearInterval(sessionCheckIntervalRef.current);}// Check session every minute\nsessionCheckIntervalRef.current=setInterval(()=>{if(sessionExpiresAt&&Date.now()>sessionExpiresAt){console.warn('Session expired during monitoring');logout('Session expired');}},60*1000);},[sessionExpiresAt]);/**\r\n   * Handles user logout\r\n   */const logout=useCallback(function(){let reason=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'user_initiated';// Clear state\nsetUser(null);setSessionValid(false);setSessionExpiresAt(null);setAuthError(null);setAuthSuccess(null);// Clear timeouts and intervals\nif(refreshTimeoutRef.current){clearTimeout(refreshTimeoutRef.current);refreshTimeoutRef.current=null;}if(sessionCheckIntervalRef.current){clearInterval(sessionCheckIntervalRef.current);sessionCheckIntervalRef.current=null;}// Clear storage\nlocalStorage.removeItem('token');localStorage.removeItem('user');localStorage.removeItem('sessionExpiry');localStorage.removeItem('rememberMe');sessionStorage.removeItem('token');sessionStorage.removeItem('user');// Clear API authorization header\ndelete api.defaults.headers.common['Authorization'];// Call backend logout if possible\nauthService.logout().catch(error=>{console.error('Backend logout failed:',error);});// Log logout event\nlogSecurityEvent('logout',{reason});// Clear refresh queue\nrefreshQueueRef.current=[];console.log('ðŸ‘‹ User logged out:',reason);},[logSecurityEvent]);/**\r\n   * Handles user login\r\n   */const login=useCallback(async function(email,password){let rememberMe=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;try{var _response$data3,_response$data4;setAuthError(null);setAuthSuccess(null);setLoading(true);console.log('ðŸ” Attempting login for:',email);const response=await authService.login(email,password,rememberMe);console.log('ðŸ” Login response:',response);if(!response.success){throw new Error(response.message||'Login failed');}if(!((_response$data3=response.data)!==null&&_response$data3!==void 0&&_response$data3.user)||!((_response$data4=response.data)!==null&&_response$data4!==void 0&&_response$data4.accessToken)){throw new Error('Invalid login response format');}// Validate user data\nif(!validateUserData(response.data.user)){throw new Error('Invalid user data received from server');}const sanitizedUser=sanitizeUserData(response.data.user);const accessToken=response.data.accessToken;// Update state\nsetUser(sanitizedUser);setSessionValid(true);// Calculate session expiry\nconst expiryTime=Date.now()+24*60*60*1000;// 24 hours\nsetSessionExpiresAt(expiryTime);// Choose storage based on rememberMe\nconst storage=rememberMe?localStorage:sessionStorage;storage.setItem('token',accessToken);storage.setItem('user',JSON.stringify(sanitizedUser));if(rememberMe){localStorage.setItem('sessionExpiry',expiryTime.toString());localStorage.setItem('rememberMe','true');}// Update API headers\napi.defaults.headers.common['Authorization']=\"Bearer \".concat(accessToken);// Schedule token refresh\nscheduleTokenRefresh();// Start session monitoring\nstartSessionMonitoring();// Log successful login\nlogSecurityEvent('login_success',{email,role:sanitizedUser.role});console.log('âœ… Login successful:',sanitizedUser.email);return response;}catch(error){var _error$response,_error$response$data;console.error('âŒ Login error:',error);// Log failed login attempt\nlogSecurityEvent('login_failed',{email,error:error.message});const errorMessage=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||error.message||'Login failed. Please check your credentials.';setError(errorMessage);throw error;}finally{setLoading(false);}},[scheduleTokenRefresh,startSessionMonitoring,setError,logSecurityEvent]);/**\r\n   * Handles user registration\r\n   */const register=useCallback(async userData=>{try{var _response$data5,_response$data6,_response$data7;setAuthError(null);setAuthSuccess(null);setLoading(true);console.log('ðŸ“ Attempting registration for:',userData.email);console.log('ðŸ“ Registration data:',{username:userData.username,email:userData.email,role:userData.role,department:userData.department,studentId:userData.studentId});const response=await authService.register(userData);console.log('ðŸ“ Registration response:',response);if(!response.success){throw new Error(response.message||'Registration failed');}// Check if email verification is required\nconst requiresVerification=((_response$data5=response.data)===null||_response$data5===void 0?void 0:_response$data5.requiresEmailVerification)||false;// For registration, we might not get a token immediately if email verification is required\nif(requiresVerification){// Don't log in automatically, just show success message\nconsole.log('ðŸ“§ Email verification required');setSuccess('Registration successful! Please check your email to verify your account.');// Log successful registration (pending verification)\nlogSecurityEvent('registration_pending_verification',{email:userData.email,role:userData.role});return _objectSpread(_objectSpread({},response),{},{requiresVerification:true,message:'Registration successful! Please check your email to verify your account.'});}// If no verification required, proceed with auto-login\nif(!((_response$data6=response.data)!==null&&_response$data6!==void 0&&_response$data6.user)||!((_response$data7=response.data)!==null&&_response$data7!==void 0&&_response$data7.accessToken)){throw new Error('Invalid registration response format');}// Validate user data\nif(!validateUserData(response.data.user)){throw new Error('Invalid user data received from server');}const sanitizedUser=sanitizeUserData(response.data.user);const accessToken=response.data.accessToken;// Update state\nsetUser(sanitizedUser);setSessionValid(true);// Calculate session expiry\nconst expiryTime=Date.now()+24*60*60*1000;// 24 hours\nsetSessionExpiresAt(expiryTime);// Store in localStorage by default for new registrations\nlocalStorage.setItem('token',accessToken);localStorage.setItem('user',JSON.stringify(sanitizedUser));localStorage.setItem('sessionExpiry',expiryTime.toString());// Update API headers\napi.defaults.headers.common['Authorization']=\"Bearer \".concat(accessToken);// Schedule token refresh\nscheduleTokenRefresh();// Start session monitoring\nstartSessionMonitoring();// Log successful registration\nlogSecurityEvent('registration_success',{email:sanitizedUser.email,role:sanitizedUser.role});console.log('âœ… Registration successful:',sanitizedUser.email);return _objectSpread(_objectSpread({},response),{},{requiresVerification:false,message:'Registration successful! You are now logged in.'});}catch(error){var _error$response2,_error$response3,_error$response4,_error$response4$data,_error$response5,_error$response5$data;console.error('âŒ Registration error:',error);console.error('âŒ Error details:',{message:error.message,response:(_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.data,status:(_error$response3=error.response)===null||_error$response3===void 0?void 0:_error$response3.status});// Log failed registration\nlogSecurityEvent('registration_failed',{email:userData.email,error:error.message,role:userData.role});let errorMessage='Registration failed. Please try again.';// Extract specific error from authService response\nif(error.message&&error.message!=='Registration failed. Please try again.'){errorMessage=error.message;}else if((_error$response4=error.response)!==null&&_error$response4!==void 0&&(_error$response4$data=_error$response4.data)!==null&&_error$response4$data!==void 0&&_error$response4$data.message){errorMessage=error.response.data.message;}else if((_error$response5=error.response)!==null&&_error$response5!==void 0&&(_error$response5$data=_error$response5.data)!==null&&_error$response5$data!==void 0&&_error$response5$data.errors){// Handle validation errors\nconst validationErrors=error.response.data.errors;if(Array.isArray(validationErrors)){errorMessage=validationErrors.map(err=>err.message||err.msg).join('. ');}else if(typeof validationErrors==='object'){errorMessage=Object.values(validationErrors).join('. ');}}setError(errorMessage);throw new Error(errorMessage);}finally{setLoading(false);}},[scheduleTokenRefresh,startSessionMonitoring,setError,setSuccess,logSecurityEvent]);/**\r\n   * Initializes authentication state from storage\r\n   */const initializeAuth=useCallback(async()=>{try{setLoading(true);setAuthError(null);setAuthSuccess(null);const token=localStorage.getItem('token')||sessionStorage.getItem('token');const savedUser=localStorage.getItem('user')||sessionStorage.getItem('user');const sessionExpiry=localStorage.getItem('sessionExpiry');if(!token||!savedUser){setLoading(false);return;}// Parse and validate saved user\nlet parsedUser;try{parsedUser=JSON.parse(savedUser);}catch(error){console.error('Error parsing saved user:',error);logout('Invalid session data');return;}// Validate user data\nif(!validateUserData(parsedUser)){console.warn('Invalid user data in storage, logging out');logout('Invalid user data');return;}// Check session expiry\nif(sessionExpiry){const expiryTime=parseInt(sessionExpiry,10);if(Date.now()>expiryTime){console.warn('Session expired, logging out');logout('Session expired');return;}setSessionExpiresAt(expiryTime);}// Set token in API headers\napi.defaults.headers.common['Authorization']=\"Bearer \".concat(token);// Verify token with backend\ntry{const response=await authService.getCurrentUser();if(!response.success){throw new Error(response.message||'Failed to get current user');}const userData=response.data;if(!validateUserData(userData)){throw new Error('Invalid user data received from server');}const sanitizedUser=sanitizeUserData(userData);setUser(sanitizedUser);setSessionValid(true);// Update storage with fresh data\nconst storage=localStorage.getItem('token')?localStorage:sessionStorage;storage.setItem('user',JSON.stringify(sanitizedUser));// Schedule token refresh\nscheduleTokenRefresh();// Start session monitoring\nstartSessionMonitoring();console.log('âœ… Auth initialized successfully:',sanitizedUser.email);}catch(error){console.error('Token verification failed:',error);// Try to refresh token\ntry{await refreshToken();}catch(refreshError){console.error('Token refresh failed:',refreshError);logout('Session verification failed');}}}catch(error){console.error('Auth initialization error:',error);setError('Authentication initialization failed');}finally{setLoading(false);}},[logout,refreshToken,scheduleTokenRefresh,startSessionMonitoring,setError]);/**\r\n   * Checks if user has required role(s)\r\n   */const hasRole=useCallback(roles=>{if(!user||!user.role)return false;const rolesToCheck=Array.isArray(roles)?roles:[roles];return rolesToCheck.includes(user.role);},[user]);/**\r\n   * Checks if user has required permission(s)\r\n   */const hasPermission=useCallback(permissions=>{if(!user||!user.permissions)return false;const permissionsToCheck=Array.isArray(permissions)?permissions:[permissions];return permissionsToCheck.every(permission=>{var _user$permissions;return(_user$permissions=user.permissions)===null||_user$permissions===void 0?void 0:_user$permissions.includes(permission);});},[user]);/**\r\n   * Checks if session is valid and active\r\n   */const checkSession=useCallback(async()=>{if(!user)return false;try{await authService.getCurrentUser();return true;}catch(error){return false;}},[user]);/**\r\n   * Updates user profile\r\n   */const updateProfile=useCallback(async updates=>{try{var _response$data8;const response=await authService.updateProfile(updates);if(response.success&&(_response$data8=response.data)!==null&&_response$data8!==void 0&&_response$data8.user){const sanitizedUser=sanitizeUserData(response.data.user);setUser(sanitizedUser);const storage=localStorage.getItem('token')?localStorage:sessionStorage;storage.setItem('user',JSON.stringify(sanitizedUser));}return response;}catch(error){console.error('Profile update error:',error);throw error;}},[]);/**\r\n   * Changes user password\r\n   */const changePassword=useCallback(async(currentPassword,newPassword)=>{try{const response=await authService.changePassword(currentPassword,newPassword);if(response.success){logSecurityEvent('password_changed');}return response;}catch(error){console.error('Password change error:',error);throw error;}},[logSecurityEvent]);/**\r\n   * Requests password reset\r\n   */const forgotPassword=useCallback(async email=>{try{return await authService.forgotPassword(email);}catch(error){console.error('Forgot password error:',error);throw error;}},[]);/**\r\n   * Resets password with token\r\n   */const resetPassword=useCallback(async(token,userId,newPassword)=>{try{return await authService.resetPassword(token,userId,newPassword);}catch(error){console.error('Reset password error:',error);throw error;}},[]);/**\r\n   * Verifies email with token\r\n   */const verifyEmail=useCallback(async(token,userId)=>{try{return await authService.verifyEmail(token,userId);}catch(error){console.error('Email verification error:',error);throw error;}},[]);/**\r\n   * Checks if email is available\r\n   */const checkEmail=useCallback(async email=>{try{return await authService.checkEmail(email);}catch(error){console.error('Check email error:',error);throw error;}},[]);/**\r\n   * Checks if username is available\r\n   */const checkUsername=useCallback(async username=>{try{return await authService.checkUsername(username);}catch(error){console.error('Check username error:',error);throw error;}},[]);// Initialize authentication on mount\nuseEffect(()=>{initializeAuth();// Cleanup on unmount\nreturn()=>{if(refreshTimeoutRef.current){clearTimeout(refreshTimeoutRef.current);}if(sessionCheckIntervalRef.current){clearInterval(sessionCheckIntervalRef.current);}};},[initializeAuth]);// Set up axios interceptor for token refresh\nuseEffect(()=>{const interceptor=api.interceptors.response.use(response=>response,async error=>{var _error$response6;const originalRequest=error.config;// If error is 401 and not a retry, try to refresh token\nif(((_error$response6=error.response)===null||_error$response6===void 0?void 0:_error$response6.status)===401&&!originalRequest._retry){originalRequest._retry=true;try{await refreshToken();// Retry the original request with new token\nconst token=localStorage.getItem('token')||sessionStorage.getItem('token');if(token){originalRequest.headers.Authorization=\"Bearer \".concat(token);}return api(originalRequest);}catch(refreshError){// Refresh failed, logout user\nlogout('token_refresh_failed');return Promise.reject(refreshError);}}return Promise.reject(error);});// Cleanup interceptor\nreturn()=>{api.interceptors.response.eject(interceptor);};},[refreshToken,logout]);// Context value\nconst value={// State\nuser,loading,sessionValid,sessionExpiresAt,authError,authSuccess,// Authentication methods\nlogin,register,logout,refreshToken,checkSession,// User management\nupdateProfile,changePassword,forgotPassword,resetPassword,verifyEmail,// Validation\ncheckEmail,checkUsername,// Access control\nhasRole,hasPermission,// Security logging\nlogSecurityEvent,// Utility\nisAuthenticated:!!user&&sessionValid,clearError,clearSuccess,setError,setSuccess};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};// PropTypes\n// âœ… Export both as named exports and default\nexport default AuthContext;","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","useCallback","useRef","authService","api","jsx","_jsx","AuthContext","useAuth","context","Error","validateUserData","userData","requiredFields","field","console","warn","concat","validRoles","includes","role","emailRegex","test","email","sanitizeUserData","sanitized","_objectSpread","password","tempPassword","resetToken","verificationToken","__v","toLowerCase","sendToSecurityLog","eventData","existingEvents","JSON","parse","localStorage","getItem","push","length","shift","setItem","stringify","e","AuthProvider","_ref","children","user","setUser","loading","setLoading","sessionValid","setSessionValid","sessionExpiresAt","setSessionExpiresAt","authError","setAuthError","authSuccess","setAuthSuccess","refreshTimeoutRef","sessionCheckIntervalRef","isRefreshingRef","refreshQueueRef","logSecurityEvent","eventType","data","arguments","undefined","securityEvent","timestamp","Date","toISOString","event","userId","_id","userRole","userAgent","navigator","ip","process","env","NODE_ENV","log","clearError","clearSuccess","setError","message","setTimeout","setSuccess","refreshToken","current","Promise","resolve","reject","_response$data","_response$data2","response","success","accessToken","sanitizedUser","storage","sessionStorage","defaults","headers","common","expiryTime","now","toString","scheduleTokenRefresh","queued","error","clearTimeout","refreshTime","startSessionMonitoring","clearInterval","setInterval","logout","reason","removeItem","catch","login","rememberMe","_response$data3","_response$data4","_error$response","_error$response$data","errorMessage","register","_response$data5","_response$data6","_response$data7","username","department","studentId","requiresVerification","requiresEmailVerification","_error$response2","_error$response3","_error$response4","_error$response4$data","_error$response5","_error$response5$data","status","errors","validationErrors","Array","isArray","map","err","msg","join","Object","values","initializeAuth","token","savedUser","sessionExpiry","parsedUser","parseInt","getCurrentUser","refreshError","hasRole","roles","rolesToCheck","hasPermission","permissions","permissionsToCheck","every","permission","_user$permissions","checkSession","updateProfile","updates","_response$data8","changePassword","currentPassword","newPassword","forgotPassword","resetPassword","verifyEmail","checkEmail","checkUsername","interceptor","interceptors","use","_error$response6","originalRequest","config","_retry","Authorization","eject","value","isAuthenticated","Provider"],"sources":["C:/Users/KADZ-TECH/Documents/dev/it-support-system/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect, useCallback, useRef } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport authService from '../services/authService';\r\nimport api from '../services/api';\r\n\r\n/**\r\n * AuthContext - Enterprise Authentication System\r\n * \r\n * Features:\r\n * - JWT token management with auto-refresh\r\n * - Session validation and monitoring\r\n * - Role-based access control\r\n * - Activity logging\r\n * - Security event tracking\r\n * - Concurrent session prevention\r\n * - Token refresh queue\r\n * - Graceful error handling\r\n * \r\n * @version 4.2.1\r\n * @author IT Support Team\r\n */\r\n\r\nexport const AuthContext = createContext();\r\n\r\n/**\r\n * Custom hook to access authentication context\r\n * \r\n * @returns {Object} Authentication context\r\n * @throws {Error} If used outside AuthProvider\r\n */\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\n/**\r\n * Validates user data structure\r\n * \r\n * @param {Object} userData - User data to validate\r\n * @returns {boolean} True if valid\r\n */\r\nconst validateUserData = (userData) => {\r\n  if (!userData || typeof userData !== 'object') {\r\n    return false;\r\n  }\r\n\r\n  // Required fields\r\n  const requiredFields = ['_id', 'email', 'role'];\r\n  for (const field of requiredFields) {\r\n    if (!userData[field]) {\r\n      console.warn(`Invalid user data: Missing ${field}`);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Validate role\r\n  const validRoles = ['admin', 'technician', 'staff', 'student'];\r\n  if (!validRoles.includes(userData.role)) {\r\n    console.warn(`Invalid user data: Invalid role \"${userData.role}\"`);\r\n    return false;\r\n  }\r\n\r\n  // Validate email format\r\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n  if (!emailRegex.test(userData.email)) {\r\n    console.warn(`Invalid user data: Invalid email \"${userData.email}\"`);\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\n/**\r\n * Sanitizes user data before storage\r\n * \r\n * @param {Object} userData - Raw user data\r\n * @returns {Object} Sanitized user data\r\n */\r\nconst sanitizeUserData = (userData) => {\r\n  if (!userData) return null;\r\n  \r\n  const sanitized = { ...userData };\r\n  \r\n  // Remove sensitive fields\r\n  delete sanitized.password;\r\n  delete sanitized.tempPassword;\r\n  delete sanitized.resetToken;\r\n  delete sanitized.verificationToken;\r\n  delete sanitized.__v;\r\n  \r\n  // Ensure role is lowercase\r\n  if (sanitized.role) {\r\n    sanitized.role = sanitized.role.toLowerCase();\r\n  }\r\n  \r\n  return sanitized;\r\n};\r\n\r\n/**\r\n * Sends security events to monitoring service\r\n */\r\nconst sendToSecurityLog = (eventData) => {\r\n  try {\r\n    // Store in localStorage for debugging (remove in production)\r\n    const existingEvents = JSON.parse(localStorage.getItem('security_events') || '[]');\r\n    existingEvents.push(eventData);\r\n    \r\n    // Keep only last 50 events\r\n    if (existingEvents.length > 50) {\r\n      existingEvents.shift();\r\n    }\r\n    \r\n    localStorage.setItem('security_events', JSON.stringify(existingEvents));\r\n  } catch (e) {\r\n    // Silently fail if localStorage is not available\r\n  }\r\n};\r\n\r\n/**\r\n * AuthProvider Component\r\n * \r\n * @param {Object} props - Component properties\r\n * @param {ReactNode} props.children - Child components\r\n */\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [sessionValid, setSessionValid] = useState(false);\r\n  const [sessionExpiresAt, setSessionExpiresAt] = useState(null);\r\n  const [authError, setAuthError] = useState(null);\r\n  const [authSuccess, setAuthSuccess] = useState(null);\r\n  \r\n  const refreshTimeoutRef = useRef(null);\r\n  const sessionCheckIntervalRef = useRef(null);\r\n  const isRefreshingRef = useRef(false);\r\n  const refreshQueueRef = useRef([]);\r\n\r\n  /**\r\n   * Logs security events for monitoring\r\n   */\r\n  const logSecurityEvent = useCallback((eventType, data = {}) => {\r\n    const securityEvent = {\r\n      timestamp: new Date().toISOString(),\r\n      event: eventType,\r\n      userId: user?._id,\r\n      userRole: user?.role,\r\n      ...data,\r\n      userAgent: navigator.userAgent,\r\n      ip: 'client-ip'\r\n    };\r\n\r\n    // Log to console in development\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.log('ðŸ”’ Security Event:', securityEvent);\r\n    }\r\n\r\n    // Send to security monitoring service\r\n    sendToSecurityLog(securityEvent);\r\n  }, [user]);\r\n\r\n  /**\r\n   * Clears authentication errors and success messages\r\n   */\r\n  const clearError = useCallback(() => {\r\n    setAuthError(null);\r\n  }, []);\r\n\r\n  const clearSuccess = useCallback(() => {\r\n    setAuthSuccess(null);\r\n  }, []);\r\n\r\n  /**\r\n   * Sets authentication error\r\n   */\r\n  const setError = useCallback((message) => {\r\n    setAuthError(message);\r\n    // Auto-clear error after 10 seconds\r\n    setTimeout(() => {\r\n      setAuthError(null);\r\n    }, 10000);\r\n  }, []);\r\n\r\n  /**\r\n   * Sets authentication success message\r\n   */\r\n  const setSuccess = useCallback((message) => {\r\n    setAuthSuccess(message);\r\n    // Auto-clear success after 5 seconds\r\n    setTimeout(() => {\r\n      setAuthSuccess(null);\r\n    }, 5000);\r\n  }, []);\r\n\r\n  /**\r\n   * Refreshes authentication token\r\n   */\r\n  const refreshToken = useCallback(async () => {\r\n    // Prevent multiple concurrent refresh attempts\r\n    if (isRefreshingRef.current) {\r\n      return new Promise((resolve, reject) => {\r\n        refreshQueueRef.current.push({ resolve, reject });\r\n      });\r\n    }\r\n\r\n    try {\r\n      isRefreshingRef.current = true;\r\n      \r\n      const response = await authService.refreshToken();\r\n      \r\n      if (!response.success || !response.data?.accessToken || !response.data?.user) {\r\n        throw new Error('Invalid refresh response');\r\n      }\r\n\r\n      // Validate user data\r\n      if (!validateUserData(response.data.user)) {\r\n        throw new Error('Invalid user data in refresh response');\r\n      }\r\n\r\n      const sanitizedUser = sanitizeUserData(response.data.user);\r\n      const accessToken = response.data.accessToken;\r\n      \r\n      // Update state and storage\r\n      setUser(sanitizedUser);\r\n      setSessionValid(true);\r\n      \r\n      const storage = localStorage.getItem('token') ? localStorage : sessionStorage;\r\n      storage.setItem('token', accessToken);\r\n      storage.setItem('user', JSON.stringify(sanitizedUser));\r\n      \r\n      // Update API headers\r\n      api.defaults.headers.common['Authorization'] = `Bearer ${accessToken}`;\r\n      \r\n      // Set new session expiry (24 hours from now)\r\n      const expiryTime = Date.now() + (24 * 60 * 60 * 1000);\r\n      setSessionExpiresAt(expiryTime);\r\n      localStorage.setItem('sessionExpiry', expiryTime.toString());\r\n      \r\n      // Schedule next refresh\r\n      scheduleTokenRefresh();\r\n      \r\n      // Process queued requests\r\n      while (refreshQueueRef.current.length > 0) {\r\n        const queued = refreshQueueRef.current.shift();\r\n        queued.resolve();\r\n      }\r\n      \r\n      return response;\r\n    } catch (error) {\r\n      console.error('Token refresh failed:', error);\r\n      \r\n      // Process queued requests with error\r\n      while (refreshQueueRef.current.length > 0) {\r\n        const queued = refreshQueueRef.current.shift();\r\n        queued.reject(error);\r\n      }\r\n      \r\n      throw error;\r\n    } finally {\r\n      isRefreshingRef.current = false;\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Schedules token refresh before expiry\r\n   */\r\n  const scheduleTokenRefresh = useCallback(() => {\r\n    // Clear existing timeout\r\n    if (refreshTimeoutRef.current) {\r\n      clearTimeout(refreshTimeoutRef.current);\r\n    }\r\n\r\n    // Schedule refresh 5 minutes before expiry\r\n    const refreshTime = sessionExpiresAt \r\n      ? sessionExpiresAt - (5 * 60 * 1000) - Date.now()\r\n      : 55 * 60 * 1000; // Default: 55 minutes\r\n\r\n    if (refreshTime > 0) {\r\n      refreshTimeoutRef.current = setTimeout(async () => {\r\n        try {\r\n          await refreshToken();\r\n        } catch (error) {\r\n          console.error('Scheduled token refresh failed:', error);\r\n          // Don't logout immediately, let session monitoring handle it\r\n        }\r\n      }, refreshTime);\r\n    }\r\n  }, [sessionExpiresAt, refreshToken]);\r\n\r\n  /**\r\n   * Starts session monitoring\r\n   */\r\n  const startSessionMonitoring = useCallback(() => {\r\n    // Clear existing interval\r\n    if (sessionCheckIntervalRef.current) {\r\n      clearInterval(sessionCheckIntervalRef.current);\r\n    }\r\n\r\n    // Check session every minute\r\n    sessionCheckIntervalRef.current = setInterval(() => {\r\n      if (sessionExpiresAt && Date.now() > sessionExpiresAt) {\r\n        console.warn('Session expired during monitoring');\r\n        logout('Session expired');\r\n      }\r\n    }, 60 * 1000);\r\n  }, [sessionExpiresAt]);\r\n\r\n  /**\r\n   * Handles user logout\r\n   */\r\n  const logout = useCallback((reason = 'user_initiated') => {\r\n    // Clear state\r\n    setUser(null);\r\n    setSessionValid(false);\r\n    setSessionExpiresAt(null);\r\n    setAuthError(null);\r\n    setAuthSuccess(null);\r\n    \r\n    // Clear timeouts and intervals\r\n    if (refreshTimeoutRef.current) {\r\n      clearTimeout(refreshTimeoutRef.current);\r\n      refreshTimeoutRef.current = null;\r\n    }\r\n    \r\n    if (sessionCheckIntervalRef.current) {\r\n      clearInterval(sessionCheckIntervalRef.current);\r\n      sessionCheckIntervalRef.current = null;\r\n    }\r\n    \r\n    // Clear storage\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('user');\r\n    localStorage.removeItem('sessionExpiry');\r\n    localStorage.removeItem('rememberMe');\r\n    sessionStorage.removeItem('token');\r\n    sessionStorage.removeItem('user');\r\n    \r\n    // Clear API authorization header\r\n    delete api.defaults.headers.common['Authorization'];\r\n    \r\n    // Call backend logout if possible\r\n    authService.logout().catch(error => {\r\n      console.error('Backend logout failed:', error);\r\n    });\r\n    \r\n    // Log logout event\r\n    logSecurityEvent('logout', { reason });\r\n    \r\n    // Clear refresh queue\r\n    refreshQueueRef.current = [];\r\n    \r\n    console.log('ðŸ‘‹ User logged out:', reason);\r\n  }, [logSecurityEvent]);\r\n\r\n  /**\r\n   * Handles user login\r\n   */\r\n  const login = useCallback(async (email, password, rememberMe = false) => {\r\n    try {\r\n      setAuthError(null);\r\n      setAuthSuccess(null);\r\n      setLoading(true);\r\n\r\n      console.log('ðŸ” Attempting login for:', email);\r\n      \r\n      const response = await authService.login(email, password, rememberMe);\r\n      \r\n      console.log('ðŸ” Login response:', response);\r\n      \r\n      if (!response.success) {\r\n        throw new Error(response.message || 'Login failed');\r\n      }\r\n\r\n      if (!response.data?.user || !response.data?.accessToken) {\r\n        throw new Error('Invalid login response format');\r\n      }\r\n\r\n      // Validate user data\r\n      if (!validateUserData(response.data.user)) {\r\n        throw new Error('Invalid user data received from server');\r\n      }\r\n\r\n      const sanitizedUser = sanitizeUserData(response.data.user);\r\n      const accessToken = response.data.accessToken;\r\n      \r\n      // Update state\r\n      setUser(sanitizedUser);\r\n      setSessionValid(true);\r\n      \r\n      // Calculate session expiry\r\n      const expiryTime = Date.now() + (24 * 60 * 60 * 1000); // 24 hours\r\n      setSessionExpiresAt(expiryTime);\r\n      \r\n      // Choose storage based on rememberMe\r\n      const storage = rememberMe ? localStorage : sessionStorage;\r\n      storage.setItem('token', accessToken);\r\n      storage.setItem('user', JSON.stringify(sanitizedUser));\r\n      \r\n      if (rememberMe) {\r\n        localStorage.setItem('sessionExpiry', expiryTime.toString());\r\n        localStorage.setItem('rememberMe', 'true');\r\n      }\r\n\r\n      // Update API headers\r\n      api.defaults.headers.common['Authorization'] = `Bearer ${accessToken}`;\r\n\r\n      // Schedule token refresh\r\n      scheduleTokenRefresh();\r\n      \r\n      // Start session monitoring\r\n      startSessionMonitoring();\r\n      \r\n      // Log successful login\r\n      logSecurityEvent('login_success', { email, role: sanitizedUser.role });\r\n      \r\n      console.log('âœ… Login successful:', sanitizedUser.email);\r\n      \r\n      return response;\r\n    } catch (error) {\r\n      console.error('âŒ Login error:', error);\r\n      \r\n      // Log failed login attempt\r\n      logSecurityEvent('login_failed', { email, error: error.message });\r\n      \r\n      const errorMessage = error.response?.data?.message || \r\n                          error.message || \r\n                          'Login failed. Please check your credentials.';\r\n      \r\n      setError(errorMessage);\r\n      throw error;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [scheduleTokenRefresh, startSessionMonitoring, setError, logSecurityEvent]);\r\n\r\n  /**\r\n   * Handles user registration\r\n   */\r\n  const register = useCallback(async (userData) => {\r\n    try {\r\n      setAuthError(null);\r\n      setAuthSuccess(null);\r\n      setLoading(true);\r\n\r\n      console.log('ðŸ“ Attempting registration for:', userData.email);\r\n      console.log('ðŸ“ Registration data:', { \r\n        username: userData.username,\r\n        email: userData.email,\r\n        role: userData.role,\r\n        department: userData.department,\r\n        studentId: userData.studentId \r\n      });\r\n      \r\n      const response = await authService.register(userData);\r\n      \r\n      console.log('ðŸ“ Registration response:', response);\r\n      \r\n      if (!response.success) {\r\n        throw new Error(response.message || 'Registration failed');\r\n      }\r\n\r\n      // Check if email verification is required\r\n      const requiresVerification = response.data?.requiresEmailVerification || false;\r\n      \r\n      // For registration, we might not get a token immediately if email verification is required\r\n      if (requiresVerification) {\r\n        // Don't log in automatically, just show success message\r\n        console.log('ðŸ“§ Email verification required');\r\n        setSuccess('Registration successful! Please check your email to verify your account.');\r\n        \r\n        // Log successful registration (pending verification)\r\n        logSecurityEvent('registration_pending_verification', { \r\n          email: userData.email, \r\n          role: userData.role \r\n        });\r\n        \r\n        return {\r\n          ...response,\r\n          requiresVerification: true,\r\n          message: 'Registration successful! Please check your email to verify your account.'\r\n        };\r\n      }\r\n\r\n      // If no verification required, proceed with auto-login\r\n      if (!response.data?.user || !response.data?.accessToken) {\r\n        throw new Error('Invalid registration response format');\r\n      }\r\n\r\n      // Validate user data\r\n      if (!validateUserData(response.data.user)) {\r\n        throw new Error('Invalid user data received from server');\r\n      }\r\n\r\n      const sanitizedUser = sanitizeUserData(response.data.user);\r\n      const accessToken = response.data.accessToken;\r\n      \r\n      // Update state\r\n      setUser(sanitizedUser);\r\n      setSessionValid(true);\r\n      \r\n      // Calculate session expiry\r\n      const expiryTime = Date.now() + (24 * 60 * 60 * 1000); // 24 hours\r\n      setSessionExpiresAt(expiryTime);\r\n      \r\n      // Store in localStorage by default for new registrations\r\n      localStorage.setItem('token', accessToken);\r\n      localStorage.setItem('user', JSON.stringify(sanitizedUser));\r\n      localStorage.setItem('sessionExpiry', expiryTime.toString());\r\n\r\n      // Update API headers\r\n      api.defaults.headers.common['Authorization'] = `Bearer ${accessToken}`;\r\n\r\n      // Schedule token refresh\r\n      scheduleTokenRefresh();\r\n      \r\n      // Start session monitoring\r\n      startSessionMonitoring();\r\n      \r\n      // Log successful registration\r\n      logSecurityEvent('registration_success', { \r\n        email: sanitizedUser.email, \r\n        role: sanitizedUser.role \r\n      });\r\n      \r\n      console.log('âœ… Registration successful:', sanitizedUser.email);\r\n      \r\n      return {\r\n        ...response,\r\n        requiresVerification: false,\r\n        message: 'Registration successful! You are now logged in.'\r\n      };\r\n    } catch (error) {\r\n      console.error('âŒ Registration error:', error);\r\n      console.error('âŒ Error details:', {\r\n        message: error.message,\r\n        response: error.response?.data,\r\n        status: error.response?.status\r\n      });\r\n      \r\n      // Log failed registration\r\n      logSecurityEvent('registration_failed', { \r\n        email: userData.email, \r\n        error: error.message,\r\n        role: userData.role\r\n      });\r\n      \r\n      let errorMessage = 'Registration failed. Please try again.';\r\n      \r\n      // Extract specific error from authService response\r\n      if (error.message && error.message !== 'Registration failed. Please try again.') {\r\n        errorMessage = error.message;\r\n      } else if (error.response?.data?.message) {\r\n        errorMessage = error.response.data.message;\r\n      } else if (error.response?.data?.errors) {\r\n        // Handle validation errors\r\n        const validationErrors = error.response.data.errors;\r\n        if (Array.isArray(validationErrors)) {\r\n          errorMessage = validationErrors.map(err => err.message || err.msg).join('. ');\r\n        } else if (typeof validationErrors === 'object') {\r\n          errorMessage = Object.values(validationErrors).join('. ');\r\n        }\r\n      }\r\n      \r\n      setError(errorMessage);\r\n      throw new Error(errorMessage);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [scheduleTokenRefresh, startSessionMonitoring, setError, setSuccess, logSecurityEvent]);\r\n\r\n  /**\r\n   * Initializes authentication state from storage\r\n   */\r\n  const initializeAuth = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      setAuthError(null);\r\n      setAuthSuccess(null);\r\n\r\n      const token = localStorage.getItem('token') || sessionStorage.getItem('token');\r\n      const savedUser = localStorage.getItem('user') || sessionStorage.getItem('user');\r\n      const sessionExpiry = localStorage.getItem('sessionExpiry');\r\n\r\n      if (!token || !savedUser) {\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      // Parse and validate saved user\r\n      let parsedUser;\r\n      try {\r\n        parsedUser = JSON.parse(savedUser);\r\n      } catch (error) {\r\n        console.error('Error parsing saved user:', error);\r\n        logout('Invalid session data');\r\n        return;\r\n      }\r\n\r\n      // Validate user data\r\n      if (!validateUserData(parsedUser)) {\r\n        console.warn('Invalid user data in storage, logging out');\r\n        logout('Invalid user data');\r\n        return;\r\n      }\r\n\r\n      // Check session expiry\r\n      if (sessionExpiry) {\r\n        const expiryTime = parseInt(sessionExpiry, 10);\r\n        if (Date.now() > expiryTime) {\r\n          console.warn('Session expired, logging out');\r\n          logout('Session expired');\r\n          return;\r\n        }\r\n        setSessionExpiresAt(expiryTime);\r\n      }\r\n\r\n      // Set token in API headers\r\n      api.defaults.headers.common['Authorization'] = `Bearer ${token}`;\r\n\r\n      // Verify token with backend\r\n      try {\r\n        const response = await authService.getCurrentUser();\r\n        \r\n        if (!response.success) {\r\n          throw new Error(response.message || 'Failed to get current user');\r\n        }\r\n\r\n        const userData = response.data;\r\n        \r\n        if (!validateUserData(userData)) {\r\n          throw new Error('Invalid user data received from server');\r\n        }\r\n\r\n        const sanitizedUser = sanitizeUserData(userData);\r\n        setUser(sanitizedUser);\r\n        setSessionValid(true);\r\n        \r\n        // Update storage with fresh data\r\n        const storage = localStorage.getItem('token') ? localStorage : sessionStorage;\r\n        storage.setItem('user', JSON.stringify(sanitizedUser));\r\n        \r\n        // Schedule token refresh\r\n        scheduleTokenRefresh();\r\n        \r\n        // Start session monitoring\r\n        startSessionMonitoring();\r\n        \r\n        console.log('âœ… Auth initialized successfully:', sanitizedUser.email);\r\n        \r\n      } catch (error) {\r\n        console.error('Token verification failed:', error);\r\n        \r\n        // Try to refresh token\r\n        try {\r\n          await refreshToken();\r\n        } catch (refreshError) {\r\n          console.error('Token refresh failed:', refreshError);\r\n          logout('Session verification failed');\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Auth initialization error:', error);\r\n      setError('Authentication initialization failed');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [logout, refreshToken, scheduleTokenRefresh, startSessionMonitoring, setError]);\r\n\r\n  /**\r\n   * Checks if user has required role(s)\r\n   */\r\n  const hasRole = useCallback((roles) => {\r\n    if (!user || !user.role) return false;\r\n    \r\n    const rolesToCheck = Array.isArray(roles) ? roles : [roles];\r\n    return rolesToCheck.includes(user.role);\r\n  }, [user]);\r\n\r\n  /**\r\n   * Checks if user has required permission(s)\r\n   */\r\n  const hasPermission = useCallback((permissions) => {\r\n    if (!user || !user.permissions) return false;\r\n    \r\n    const permissionsToCheck = Array.isArray(permissions) ? permissions : [permissions];\r\n    return permissionsToCheck.every(permission => \r\n      user.permissions?.includes(permission)\r\n    );\r\n  }, [user]);\r\n\r\n  /**\r\n   * Checks if session is valid and active\r\n   */\r\n  const checkSession = useCallback(async () => {\r\n    if (!user) return false;\r\n    \r\n    try {\r\n      await authService.getCurrentUser();\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }, [user]);\r\n\r\n  /**\r\n   * Updates user profile\r\n   */\r\n  const updateProfile = useCallback(async (updates) => {\r\n    try {\r\n      const response = await authService.updateProfile(updates);\r\n      \r\n      if (response.success && response.data?.user) {\r\n        const sanitizedUser = sanitizeUserData(response.data.user);\r\n        setUser(sanitizedUser);\r\n        \r\n        const storage = localStorage.getItem('token') ? localStorage : sessionStorage;\r\n        storage.setItem('user', JSON.stringify(sanitizedUser));\r\n      }\r\n      \r\n      return response;\r\n    } catch (error) {\r\n      console.error('Profile update error:', error);\r\n      throw error;\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Changes user password\r\n   */\r\n  const changePassword = useCallback(async (currentPassword, newPassword) => {\r\n    try {\r\n      const response = await authService.changePassword(currentPassword, newPassword);\r\n      if (response.success) {\r\n        logSecurityEvent('password_changed');\r\n      }\r\n      return response;\r\n    } catch (error) {\r\n      console.error('Password change error:', error);\r\n      throw error;\r\n    }\r\n  }, [logSecurityEvent]);\r\n\r\n  /**\r\n   * Requests password reset\r\n   */\r\n  const forgotPassword = useCallback(async (email) => {\r\n    try {\r\n      return await authService.forgotPassword(email);\r\n    } catch (error) {\r\n      console.error('Forgot password error:', error);\r\n      throw error;\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Resets password with token\r\n   */\r\n  const resetPassword = useCallback(async (token, userId, newPassword) => {\r\n    try {\r\n      return await authService.resetPassword(token, userId, newPassword);\r\n    } catch (error) {\r\n      console.error('Reset password error:', error);\r\n      throw error;\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Verifies email with token\r\n   */\r\n  const verifyEmail = useCallback(async (token, userId) => {\r\n    try {\r\n      return await authService.verifyEmail(token, userId);\r\n    } catch (error) {\r\n      console.error('Email verification error:', error);\r\n      throw error;\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Checks if email is available\r\n   */\r\n  const checkEmail = useCallback(async (email) => {\r\n    try {\r\n      return await authService.checkEmail(email);\r\n    } catch (error) {\r\n      console.error('Check email error:', error);\r\n      throw error;\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Checks if username is available\r\n   */\r\n  const checkUsername = useCallback(async (username) => {\r\n    try {\r\n      return await authService.checkUsername(username);\r\n    } catch (error) {\r\n      console.error('Check username error:', error);\r\n      throw error;\r\n    }\r\n  }, []);\r\n\r\n  // Initialize authentication on mount\r\n  useEffect(() => {\r\n    initializeAuth();\r\n\r\n    // Cleanup on unmount\r\n    return () => {\r\n      if (refreshTimeoutRef.current) {\r\n        clearTimeout(refreshTimeoutRef.current);\r\n      }\r\n      if (sessionCheckIntervalRef.current) {\r\n        clearInterval(sessionCheckIntervalRef.current);\r\n      }\r\n    };\r\n  }, [initializeAuth]);\r\n\r\n  // Set up axios interceptor for token refresh\r\n  useEffect(() => {\r\n    const interceptor = api.interceptors.response.use(\r\n      (response) => response,\r\n      async (error) => {\r\n        const originalRequest = error.config;\r\n        \r\n        // If error is 401 and not a retry, try to refresh token\r\n        if (error.response?.status === 401 && !originalRequest._retry) {\r\n          originalRequest._retry = true;\r\n          \r\n          try {\r\n            await refreshToken();\r\n            \r\n            // Retry the original request with new token\r\n            const token = localStorage.getItem('token') || sessionStorage.getItem('token');\r\n            if (token) {\r\n              originalRequest.headers.Authorization = `Bearer ${token}`;\r\n            }\r\n            return api(originalRequest);\r\n          } catch (refreshError) {\r\n            // Refresh failed, logout user\r\n            logout('token_refresh_failed');\r\n            return Promise.reject(refreshError);\r\n          }\r\n        }\r\n        \r\n        return Promise.reject(error);\r\n      }\r\n    );\r\n\r\n    // Cleanup interceptor\r\n    return () => {\r\n      api.interceptors.response.eject(interceptor);\r\n    };\r\n  }, [refreshToken, logout]);\r\n\r\n  // Context value\r\n  const value = {\r\n    // State\r\n    user,\r\n    loading,\r\n    sessionValid,\r\n    sessionExpiresAt,\r\n    authError,\r\n    authSuccess,\r\n    \r\n    // Authentication methods\r\n    login,\r\n    register,\r\n    logout,\r\n    refreshToken,\r\n    checkSession,\r\n    \r\n    // User management\r\n    updateProfile,\r\n    changePassword,\r\n    forgotPassword,\r\n    resetPassword,\r\n    verifyEmail,\r\n    \r\n    // Validation\r\n    checkEmail,\r\n    checkUsername,\r\n    \r\n    // Access control\r\n    hasRole,\r\n    hasPermission,\r\n    \r\n    // Security logging\r\n    logSecurityEvent,\r\n    \r\n    // Utility\r\n    isAuthenticated: !!user && sessionValid,\r\n    clearError,\r\n    clearSuccess,\r\n    setError,\r\n    setSuccess\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\n// PropTypes\r\nAuthProvider.propTypes = {\r\n  children: PropTypes.node.isRequired\r\n};\r\n\r\n// âœ… Export both as named exports and default\r\nexport default AuthContext;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}