{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\KADZ-TECH\\\\Documents\\\\dev\\\\it-support-system\\\\frontend\\\\src\\\\context\\\\AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// frontend/src/context/AuthContext.js\nimport React, { createContext, useState, useContext, useEffect, useCallback, useRef } from 'react';\nimport PropTypes from 'prop-types';\nimport api, { tokenService } from '../services/api';\n\n/**\r\n * AuthContext - Enterprise Authentication System\r\n * \r\n * Features:\r\n * - JWT token management with auto-refresh\r\n * - Session validation and monitoring\r\n * - Role-based access control\r\n * - Activity logging\r\n * - Security event tracking\r\n * - Concurrent session prevention\r\n * - Token refresh queue\r\n * - Graceful error handling\r\n * \r\n * @version 4.2.1\r\n * @author IT Support Team\r\n */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const AuthContext = /*#__PURE__*/createContext();\n\n/**\r\n * Custom hook to access authentication context\r\n * \r\n * @returns {Object} Authentication context\r\n * @throws {Error} If used outside AuthProvider\r\n */\nexport const useAuth = () => {\n  _s();\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n\n/**\r\n * Validates user data structure\r\n * \r\n * @param {Object} userData - User data to validate\r\n * @returns {boolean} True if valid\r\n */\n_s(useAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nconst validateUserData = userData => {\n  if (!userData || typeof userData !== 'object') {\n    return false;\n  }\n\n  // Required fields\n  const requiredFields = ['_id', 'email', 'role'];\n  for (const field of requiredFields) {\n    if (!userData[field]) {\n      console.warn(`Invalid user data: Missing ${field}`);\n      return false;\n    }\n  }\n\n  // Validate role\n  const validRoles = ['admin', 'technician', 'staff', 'student'];\n  if (!validRoles.includes(userData.role)) {\n    console.warn(`Invalid user data: Invalid role \"${userData.role}\"`);\n    return false;\n  }\n\n  // Validate email format\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  if (!emailRegex.test(userData.email)) {\n    console.warn(`Invalid user data: Invalid email \"${userData.email}\"`);\n    return false;\n  }\n  return true;\n};\n\n/**\r\n * Sanitizes user data before storage\r\n * \r\n * @param {Object} userData - Raw user data\r\n * @returns {Object} Sanitized user data\r\n */\nconst sanitizeUserData = userData => {\n  if (!userData) return null;\n  const sanitized = {\n    ...userData\n  };\n\n  // Remove sensitive fields\n  delete sanitized.password;\n  delete sanitized.tempPassword;\n  delete sanitized.resetToken;\n  delete sanitized.verificationToken;\n  delete sanitized.__v;\n\n  // Ensure role is lowercase\n  if (sanitized.role) {\n    sanitized.role = sanitized.role.toLowerCase();\n  }\n  return sanitized;\n};\n\n/**\r\n * Sends security events to monitoring service\r\n */\nconst sendToSecurityLog = eventData => {\n  try {\n    // Store in localStorage for debugging (remove in production)\n    const existingEvents = JSON.parse(localStorage.getItem('security_events') || '[]');\n    const event = {\n      ...eventData,\n      timestamp: new Date().toISOString(),\n      userAgent: navigator.userAgent\n    };\n    existingEvents.push(event);\n\n    // Keep only last 50 events\n    if (existingEvents.length > 50) {\n      existingEvents.shift();\n    }\n    localStorage.setItem('security_events', JSON.stringify(existingEvents));\n\n    // Send to backend in production\n    if (process.env.NODE_ENV === 'production') {\n      api.post('/audit/security-event', event).catch(() => {});\n    }\n  } catch (e) {\n    // Silently fail if localStorage is not available\n  }\n};\n\n/**\r\n * AuthProvider Component\r\n * \r\n * @param {Object} props - Component properties\r\n * @param {ReactNode} props.children - Child components\r\n */\nexport const AuthProvider = ({\n  children\n}) => {\n  _s2();\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [sessionValid, setSessionValid] = useState(false);\n  const [sessionExpiresAt, setSessionExpiresAt] = useState(null);\n  const [authError, setAuthError] = useState(null);\n  const [authSuccess, setAuthSuccess] = useState(null);\n  const refreshTimeoutRef = useRef(null);\n  const sessionCheckIntervalRef = useRef(null);\n  const isRefreshingRef = useRef(false);\n  const refreshQueueRef = useRef([]);\n\n  /**\r\n   * Logs security events for monitoring\r\n   */\n  const logSecurityEvent = useCallback((eventType, data = {}) => {\n    const securityEvent = {\n      timestamp: new Date().toISOString(),\n      event: eventType,\n      userId: user === null || user === void 0 ? void 0 : user._id,\n      userRole: user === null || user === void 0 ? void 0 : user.role,\n      ...data,\n      userAgent: navigator.userAgent,\n      ip: 'client-ip'\n    };\n\n    // Log to console in development\n    if (process.env.NODE_ENV === 'development') {\n      console.log('ðŸ”’ Security Event:', securityEvent);\n    }\n\n    // Send to security monitoring service\n    sendToSecurityLog(securityEvent);\n  }, [user]);\n\n  /**\r\n   * Clears authentication errors\r\n   */\n  const clearError = useCallback(() => {\n    setAuthError(null);\n  }, []);\n  const clearSuccess = useCallback(() => {\n    setAuthSuccess(null);\n  }, []);\n\n  /**\r\n   * Sets authentication error\r\n   */\n  const setError = useCallback(message => {\n    setAuthError(message);\n    // Auto-clear error after 10 seconds\n    setTimeout(() => {\n      setAuthError(null);\n    }, 10000);\n  }, []);\n\n  /**\r\n   * Sets authentication success message\r\n   */\n  const setSuccess = useCallback(message => {\n    setAuthSuccess(message);\n    // Auto-clear success after 5 seconds\n    setTimeout(() => {\n      setAuthSuccess(null);\n    }, 5000);\n  }, []);\n\n  /**\r\n   * Refreshes authentication token\r\n   */\n  const refreshToken = useCallback(async () => {\n    // Prevent multiple concurrent refresh attempts\n    if (isRefreshingRef.current) {\n      return new Promise((resolve, reject) => {\n        refreshQueueRef.current.push({\n          resolve,\n          reject\n        });\n      });\n    }\n    try {\n      var _response$data$data, _response$data$data2;\n      isRefreshingRef.current = true;\n      const refreshToken = tokenService.getRefreshToken();\n      if (!refreshToken) {\n        throw new Error('No refresh token available');\n      }\n      const response = await api.post('/auth/refresh', {\n        refreshToken\n      });\n      if (!response.data.success || !((_response$data$data = response.data.data) !== null && _response$data$data !== void 0 && _response$data$data.accessToken) || !((_response$data$data2 = response.data.data) !== null && _response$data$data2 !== void 0 && _response$data$data2.user)) {\n        throw new Error('Invalid refresh response');\n      }\n\n      // Validate user data\n      if (!validateUserData(response.data.data.user)) {\n        throw new Error('Invalid user data in refresh response');\n      }\n      const sanitizedUser = sanitizeUserData(response.data.data.user);\n      const {\n        accessToken,\n        refreshToken: newRefreshToken\n      } = response.data.data;\n\n      // Update tokens in storage\n      tokenService.setTokens(accessToken, newRefreshToken);\n      tokenService.setUser(sanitizedUser);\n\n      // Update state\n      setUser(sanitizedUser);\n      setSessionValid(true);\n\n      // Set new session expiry (24 hours from now)\n      const expiryTime = Date.now() + 24 * 60 * 60 * 1000;\n      setSessionExpiresAt(expiryTime);\n      localStorage.setItem('sessionExpiry', expiryTime.toString());\n\n      // Schedule next refresh\n      scheduleTokenRefresh();\n\n      // Process queued requests\n      while (refreshQueueRef.current.length > 0) {\n        const queued = refreshQueueRef.current.shift();\n        queued.resolve();\n      }\n      logSecurityEvent('token_refresh_success');\n      return {\n        success: true,\n        data: response.data.data\n      };\n    } catch (error) {\n      console.error('Token refresh failed:', error);\n\n      // Process queued requests with error\n      while (refreshQueueRef.current.length > 0) {\n        const queued = refreshQueueRef.current.shift();\n        queued.reject(error);\n      }\n      logSecurityEvent('token_refresh_failed', {\n        error: error.message\n      });\n      throw error;\n    } finally {\n      isRefreshingRef.current = false;\n    }\n  }, [logSecurityEvent]);\n\n  /**\r\n   * Schedules token refresh before expiry\r\n   */\n  const scheduleTokenRefresh = useCallback(() => {\n    // Clear existing timeout\n    if (refreshTimeoutRef.current) {\n      clearTimeout(refreshTimeoutRef.current);\n    }\n\n    // Schedule refresh 5 minutes before expiry\n    const refreshTime = sessionExpiresAt ? sessionExpiresAt - 5 * 60 * 1000 - Date.now() : 55 * 60 * 1000; // Default: 55 minutes\n\n    if (refreshTime > 0) {\n      refreshTimeoutRef.current = setTimeout(async () => {\n        try {\n          await refreshToken();\n        } catch (error) {\n          console.error('Scheduled token refresh failed:', error);\n          // Don't logout immediately, let session monitoring handle it\n        }\n      }, refreshTime);\n    }\n  }, [sessionExpiresAt, refreshToken]);\n\n  /**\r\n   * Starts session monitoring\r\n   */\n  const startSessionMonitoring = useCallback(() => {\n    // Clear existing interval\n    if (sessionCheckIntervalRef.current) {\n      clearInterval(sessionCheckIntervalRef.current);\n    }\n\n    // Check session every minute\n    sessionCheckIntervalRef.current = setInterval(() => {\n      if (sessionExpiresAt && Date.now() > sessionExpiresAt) {\n        console.warn('Session expired during monitoring');\n        logout('session_expired');\n      }\n    }, 60 * 1000);\n  }, [sessionExpiresAt]);\n\n  /**\r\n   * Handles user logout\r\n   */\n  const logout = useCallback((reason = 'user_initiated') => {\n    // Clear state\n    setUser(null);\n    setSessionValid(false);\n    setSessionExpiresAt(null);\n    setAuthError(null);\n    setAuthSuccess(null);\n\n    // Clear timeouts and intervals\n    if (refreshTimeoutRef.current) {\n      clearTimeout(refreshTimeoutRef.current);\n      refreshTimeoutRef.current = null;\n    }\n    if (sessionCheckIntervalRef.current) {\n      clearInterval(sessionCheckIntervalRef.current);\n      sessionCheckIntervalRef.current = null;\n    }\n\n    // Clear storage\n    tokenService.clearTokens();\n    localStorage.removeItem('sessionExpiry');\n    localStorage.removeItem('rememberMe');\n    localStorage.removeItem('security_events');\n\n    // Call backend logout if possible\n    api.post('/auth/logout').catch(error => {\n      console.error('Backend logout failed:', error);\n    });\n\n    // Log logout event\n    logSecurityEvent('logout', {\n      reason\n    });\n\n    // Clear refresh queue\n    refreshQueueRef.current = [];\n    console.log('ðŸ‘‹ User logged out:', reason);\n  }, [logSecurityEvent]);\n\n  /**\r\n   * Handles user login\r\n   */\n  const login = useCallback(async (email, password, rememberMe = false) => {\n    try {\n      var _response$data$data3, _response$data$data4;\n      setAuthError(null);\n      setAuthSuccess(null);\n      setLoading(true);\n      console.log('ðŸ” Attempting login for:', email);\n      const response = await api.post('/auth/login', {\n        email: email.toLowerCase().trim(),\n        password: password.trim(),\n        rememberMe\n      });\n      console.log('ðŸ” Login response:', response.data);\n      if (!response.data.success) {\n        throw new Error(response.data.message || 'Login failed');\n      }\n      if (!((_response$data$data3 = response.data.data) !== null && _response$data$data3 !== void 0 && _response$data$data3.user) || !((_response$data$data4 = response.data.data) !== null && _response$data$data4 !== void 0 && _response$data$data4.accessToken)) {\n        throw new Error('Invalid login response format');\n      }\n\n      // Validate user data\n      if (!validateUserData(response.data.data.user)) {\n        throw new Error('Invalid user data received from server');\n      }\n      const sanitizedUser = sanitizeUserData(response.data.data.user);\n      const {\n        accessToken,\n        refreshToken\n      } = response.data.data;\n\n      // Store tokens\n      tokenService.setTokens(accessToken, refreshToken);\n      tokenService.setUser(sanitizedUser);\n\n      // Update state\n      setUser(sanitizedUser);\n      setSessionValid(true);\n\n      // Calculate session expiry\n      const expiryTime = Date.now() + 24 * 60 * 60 * 1000; // 24 hours\n      setSessionExpiresAt(expiryTime);\n      if (rememberMe) {\n        localStorage.setItem('sessionExpiry', expiryTime.toString());\n        localStorage.setItem('rememberMe', 'true');\n      }\n\n      // Schedule token refresh\n      scheduleTokenRefresh();\n\n      // Start session monitoring\n      startSessionMonitoring();\n\n      // Log successful login\n      logSecurityEvent('login_success', {\n        email,\n        role: sanitizedUser.role\n      });\n      console.log('âœ… Login successful:', sanitizedUser.email);\n      return {\n        success: true,\n        message: 'Login successful',\n        data: response.data.data\n      };\n    } catch (error) {\n      var _error$response, _error$response$data;\n      console.error('âŒ Login error:', error);\n\n      // Log failed login attempt\n      logSecurityEvent('login_failed', {\n        email,\n        error: error.message\n      });\n      const errorMessage = ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || error.message || 'Login failed. Please check your credentials.';\n      setError(errorMessage);\n      throw error;\n    } finally {\n      setLoading(false);\n    }\n  }, [scheduleTokenRefresh, startSessionMonitoring, setError, logSecurityEvent]);\n\n  /**\r\n   * Handles user registration\r\n   */\n  const register = useCallback(async userData => {\n    try {\n      var _response$data$data5, _response$data$data6, _response$data$data7;\n      setAuthError(null);\n      setAuthSuccess(null);\n      setLoading(true);\n      console.log('ðŸ“ Attempting registration for:', userData.email);\n      const response = await api.post('/auth/register', userData);\n      console.log('ðŸ“ Registration response:', response.data);\n      if (!response.data.success) {\n        throw new Error(response.data.message || 'Registration failed');\n      }\n\n      // Check if email verification is required\n      const requiresVerification = ((_response$data$data5 = response.data.data) === null || _response$data$data5 === void 0 ? void 0 : _response$data$data5.requiresEmailVerification) || false;\n      if (requiresVerification) {\n        // Don't log in automatically, just show success message\n        console.log('ðŸ“§ Email verification required');\n        setSuccess('Registration successful! Please check your email to verify your account.');\n\n        // Log successful registration (pending verification)\n        logSecurityEvent('registration_pending_verification', {\n          email: userData.email,\n          role: userData.role\n        });\n        return {\n          ...response.data,\n          requiresVerification: true,\n          message: 'Registration successful! Please check your email to verify your account.'\n        };\n      }\n\n      // If no verification required, proceed with auto-login\n      if (!((_response$data$data6 = response.data.data) !== null && _response$data$data6 !== void 0 && _response$data$data6.user) || !((_response$data$data7 = response.data.data) !== null && _response$data$data7 !== void 0 && _response$data$data7.accessToken)) {\n        throw new Error('Invalid registration response format');\n      }\n\n      // Validate user data\n      if (!validateUserData(response.data.data.user)) {\n        throw new Error('Invalid user data received from server');\n      }\n      const sanitizedUser = sanitizeUserData(response.data.data.user);\n      const {\n        accessToken,\n        refreshToken\n      } = response.data.data;\n\n      // Store tokens\n      tokenService.setTokens(accessToken, refreshToken);\n      tokenService.setUser(sanitizedUser);\n\n      // Update state\n      setUser(sanitizedUser);\n      setSessionValid(true);\n\n      // Calculate session expiry\n      const expiryTime = Date.now() + 24 * 60 * 60 * 1000; // 24 hours\n      setSessionExpiresAt(expiryTime);\n\n      // Store in localStorage\n      localStorage.setItem('sessionExpiry', expiryTime.toString());\n\n      // Schedule token refresh\n      scheduleTokenRefresh();\n\n      // Start session monitoring\n      startSessionMonitoring();\n\n      // Log successful registration\n      logSecurityEvent('registration_success', {\n        email: sanitizedUser.email,\n        role: sanitizedUser.role\n      });\n      console.log('âœ… Registration successful:', sanitizedUser.email);\n      return {\n        ...response.data,\n        requiresVerification: false,\n        message: 'Registration successful! You are now logged in.'\n      };\n    } catch (error) {\n      var _error$response2, _error$response2$data, _error$response3, _error$response3$data;\n      console.error('âŒ Registration error:', error);\n\n      // Log failed registration\n      logSecurityEvent('registration_failed', {\n        email: userData.email,\n        error: error.message,\n        role: userData.role\n      });\n      let errorMessage = 'Registration failed. Please try again.';\n      if ((_error$response2 = error.response) !== null && _error$response2 !== void 0 && (_error$response2$data = _error$response2.data) !== null && _error$response2$data !== void 0 && _error$response2$data.message) {\n        errorMessage = error.response.data.message;\n      } else if ((_error$response3 = error.response) !== null && _error$response3 !== void 0 && (_error$response3$data = _error$response3.data) !== null && _error$response3$data !== void 0 && _error$response3$data.errors) {\n        // Handle validation errors\n        const validationErrors = error.response.data.errors;\n        if (Array.isArray(validationErrors)) {\n          errorMessage = validationErrors.map(err => err.message || err.msg).join('. ');\n        } else if (typeof validationErrors === 'object') {\n          errorMessage = Object.values(validationErrors).join('. ');\n        }\n      }\n      setError(errorMessage);\n      throw new Error(errorMessage);\n    } finally {\n      setLoading(false);\n    }\n  }, [scheduleTokenRefresh, startSessionMonitoring, setError, setSuccess, logSecurityEvent]);\n\n  /**\r\n   * Initializes authentication state from storage\r\n   */\n  const initializeAuth = useCallback(async () => {\n    try {\n      setLoading(true);\n      setAuthError(null);\n      setAuthSuccess(null);\n      const token = tokenService.getToken();\n      const savedUser = tokenService.getUser();\n      const sessionExpiry = localStorage.getItem('sessionExpiry');\n      if (!token || !savedUser) {\n        setLoading(false);\n        return;\n      }\n\n      // Validate saved user\n      if (!validateUserData(savedUser)) {\n        console.warn('Invalid user data in storage, logging out');\n        logout('invalid_user_data');\n        return;\n      }\n\n      // Check session expiry\n      if (sessionExpiry) {\n        const expiryTime = parseInt(sessionExpiry, 10);\n        if (Date.now() > expiryTime) {\n          console.warn('Session expired, logging out');\n          logout('session_expired');\n          return;\n        }\n        setSessionExpiresAt(expiryTime);\n      }\n\n      // Verify token with backend\n      try {\n        var _response$data$data8;\n        const response = await api.get('/auth/me');\n        if (!response.data.success) {\n          throw new Error(response.data.message || 'Failed to get current user');\n        }\n        const userData = (_response$data$data8 = response.data.data) === null || _response$data$data8 === void 0 ? void 0 : _response$data$data8.user;\n        if (!validateUserData(userData)) {\n          throw new Error('Invalid user data received from server');\n        }\n        const sanitizedUser = sanitizeUserData(userData);\n        setUser(sanitizedUser);\n        setSessionValid(true);\n\n        // Update storage with fresh data\n        tokenService.setUser(sanitizedUser);\n\n        // Schedule token refresh\n        scheduleTokenRefresh();\n\n        // Start session monitoring\n        startSessionMonitoring();\n        console.log('âœ… Auth initialized successfully:', sanitizedUser.email);\n      } catch (error) {\n        console.error('Token verification failed:', error);\n\n        // Try to refresh token\n        try {\n          await refreshToken();\n        } catch (refreshError) {\n          console.error('Token refresh failed:', refreshError);\n          logout('session_verification_failed');\n        }\n      }\n    } catch (error) {\n      console.error('Auth initialization error:', error);\n      setError('Authentication initialization failed');\n    } finally {\n      setLoading(false);\n    }\n  }, [logout, refreshToken, scheduleTokenRefresh, startSessionMonitoring, setError]);\n\n  /**\r\n   * Checks if user has required role(s)\r\n   */\n  const hasRole = useCallback(roles => {\n    if (!user || !user.role) return false;\n    const rolesToCheck = Array.isArray(roles) ? roles : [roles];\n    return rolesToCheck.includes(user.role);\n  }, [user]);\n\n  /**\r\n   * Checks if user has required permission(s)\r\n   */\n  const hasPermission = useCallback(permissions => {\n    if (!user || !user.permissions) return false;\n    const permissionsToCheck = Array.isArray(permissions) ? permissions : [permissions];\n    return permissionsToCheck.every(permission => {\n      var _user$permissions;\n      return (_user$permissions = user.permissions) === null || _user$permissions === void 0 ? void 0 : _user$permissions.includes(permission);\n    });\n  }, [user]);\n\n  /**\r\n   * Checks if session is valid and active\r\n   */\n  const checkSession = useCallback(async () => {\n    if (!user) return false;\n    try {\n      await api.get('/auth/me');\n      return true;\n    } catch (error) {\n      return false;\n    }\n  }, [user]);\n\n  /**\r\n   * Updates user profile\r\n   */\n  const updateProfile = useCallback(async updates => {\n    try {\n      var _response$data$data9;\n      const response = await api.put('/users/profile', updates);\n      if (response.data.success && (_response$data$data9 = response.data.data) !== null && _response$data$data9 !== void 0 && _response$data$data9.user) {\n        const sanitizedUser = sanitizeUserData(response.data.data.user);\n        setUser(sanitizedUser);\n        tokenService.setUser(sanitizedUser);\n      }\n      return response.data;\n    } catch (error) {\n      console.error('Profile update error:', error);\n      throw error;\n    }\n  }, []);\n\n  /**\r\n   * Changes user password\r\n   */\n  const changePassword = useCallback(async (currentPassword, newPassword) => {\n    try {\n      const response = await api.put('/users/change-password', {\n        currentPassword,\n        newPassword\n      });\n      if (response.data.success) {\n        logSecurityEvent('password_changed');\n      }\n      return response.data;\n    } catch (error) {\n      console.error('Password change error:', error);\n      throw error;\n    }\n  }, [logSecurityEvent]);\n\n  /**\r\n   * Requests password reset\r\n   */\n  const forgotPassword = useCallback(async email => {\n    try {\n      const response = await api.post('/auth/forgot-password', {\n        email\n      });\n      return response.data;\n    } catch (error) {\n      console.error('Forgot password error:', error);\n      throw error;\n    }\n  }, []);\n\n  /**\r\n   * Resets password with token\r\n   */\n  const resetPassword = useCallback(async (token, newPassword) => {\n    try {\n      const response = await api.post('/auth/reset-password', {\n        token,\n        password: newPassword\n      });\n      return response.data;\n    } catch (error) {\n      console.error('Reset password error:', error);\n      throw error;\n    }\n  }, []);\n\n  /**\r\n   * Verifies email with token\r\n   */\n  const verifyEmail = useCallback(async token => {\n    try {\n      const response = await api.get(`/auth/verify-email/${token}`);\n      return response.data;\n    } catch (error) {\n      console.error('Email verification error:', error);\n      throw error;\n    }\n  }, []);\n\n  /**\r\n   * Checks if email is available\r\n   */\n  const checkEmail = useCallback(async email => {\n    try {\n      const response = await api.post('/auth/check-email', {\n        email\n      });\n      return response.data;\n    } catch (error) {\n      console.error('Check email error:', error);\n      throw error;\n    }\n  }, []);\n\n  /**\r\n   * Checks if username is available\r\n   */\n  const checkUsername = useCallback(async username => {\n    try {\n      const response = await api.post('/auth/check-username', {\n        username\n      });\n      return response.data;\n    } catch (error) {\n      console.error('Check username error:', error);\n      throw error;\n    }\n  }, []);\n\n  // Initialize authentication on mount\n  useEffect(() => {\n    initializeAuth();\n\n    // Cleanup on unmount\n    return () => {\n      if (refreshTimeoutRef.current) {\n        clearTimeout(refreshTimeoutRef.current);\n      }\n      if (sessionCheckIntervalRef.current) {\n        clearInterval(sessionCheckIntervalRef.current);\n      }\n    };\n  }, [initializeAuth]);\n\n  // Context value\n  const value = {\n    // State\n    user,\n    loading,\n    sessionValid,\n    sessionExpiresAt,\n    authError,\n    authSuccess,\n    // Authentication methods\n    login,\n    register,\n    logout,\n    refreshToken,\n    checkSession,\n    // User management\n    updateProfile,\n    changePassword,\n    forgotPassword,\n    resetPassword,\n    verifyEmail,\n    // Validation\n    checkEmail,\n    checkUsername,\n    // Access control\n    hasRole,\n    hasPermission,\n    // Security logging\n    logSecurityEvent,\n    // Utility\n    isAuthenticated: !!user && sessionValid,\n    clearError,\n    clearSuccess,\n    setError,\n    setSuccess\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 858,\n    columnNumber: 5\n  }, this);\n};\n\n// PropTypes\n_s2(AuthProvider, \"SH9EtrHzCC/+zbzg+UOl4Evkpms=\");\n_c = AuthProvider;\nAuthProvider.propTypes = {\n  children: PropTypes.node.isRequired\n};\n\n// Export both as named exports and default\nexport default AuthContext;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","useCallback","useRef","PropTypes","api","tokenService","jsxDEV","_jsxDEV","AuthContext","useAuth","_s","context","Error","validateUserData","userData","requiredFields","field","console","warn","validRoles","includes","role","emailRegex","test","email","sanitizeUserData","sanitized","password","tempPassword","resetToken","verificationToken","__v","toLowerCase","sendToSecurityLog","eventData","existingEvents","JSON","parse","localStorage","getItem","event","timestamp","Date","toISOString","userAgent","navigator","push","length","shift","setItem","stringify","process","env","NODE_ENV","post","catch","e","AuthProvider","children","_s2","user","setUser","loading","setLoading","sessionValid","setSessionValid","sessionExpiresAt","setSessionExpiresAt","authError","setAuthError","authSuccess","setAuthSuccess","refreshTimeoutRef","sessionCheckIntervalRef","isRefreshingRef","refreshQueueRef","logSecurityEvent","eventType","data","securityEvent","userId","_id","userRole","ip","log","clearError","clearSuccess","setError","message","setTimeout","setSuccess","refreshToken","current","Promise","resolve","reject","_response$data$data","_response$data$data2","getRefreshToken","response","success","accessToken","sanitizedUser","newRefreshToken","setTokens","expiryTime","now","toString","scheduleTokenRefresh","queued","error","clearTimeout","refreshTime","startSessionMonitoring","clearInterval","setInterval","logout","reason","clearTokens","removeItem","login","rememberMe","_response$data$data3","_response$data$data4","trim","_error$response","_error$response$data","errorMessage","register","_response$data$data5","_response$data$data6","_response$data$data7","requiresVerification","requiresEmailVerification","_error$response2","_error$response2$data","_error$response3","_error$response3$data","errors","validationErrors","Array","isArray","map","err","msg","join","Object","values","initializeAuth","token","getToken","savedUser","getUser","sessionExpiry","parseInt","_response$data$data8","get","refreshError","hasRole","roles","rolesToCheck","hasPermission","permissions","permissionsToCheck","every","permission","_user$permissions","checkSession","updateProfile","updates","_response$data$data9","put","changePassword","currentPassword","newPassword","forgotPassword","resetPassword","verifyEmail","checkEmail","checkUsername","username","value","isAuthenticated","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","propTypes","node","isRequired","$RefreshReg$"],"sources":["C:/Users/KADZ-TECH/Documents/dev/it-support-system/frontend/src/context/AuthContext.js"],"sourcesContent":["// frontend/src/context/AuthContext.js\r\nimport React, { createContext, useState, useContext, useEffect, useCallback, useRef } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport api, { tokenService } from '../services/api';\r\n\r\n/**\r\n * AuthContext - Enterprise Authentication System\r\n * \r\n * Features:\r\n * - JWT token management with auto-refresh\r\n * - Session validation and monitoring\r\n * - Role-based access control\r\n * - Activity logging\r\n * - Security event tracking\r\n * - Concurrent session prevention\r\n * - Token refresh queue\r\n * - Graceful error handling\r\n * \r\n * @version 4.2.1\r\n * @author IT Support Team\r\n */\r\n\r\nexport const AuthContext = createContext();\r\n\r\n/**\r\n * Custom hook to access authentication context\r\n * \r\n * @returns {Object} Authentication context\r\n * @throws {Error} If used outside AuthProvider\r\n */\r\nexport const useAuth = () => {\r\n  const context = useContext(AuthContext);\r\n  if (!context) {\r\n    throw new Error('useAuth must be used within an AuthProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\n/**\r\n * Validates user data structure\r\n * \r\n * @param {Object} userData - User data to validate\r\n * @returns {boolean} True if valid\r\n */\r\nconst validateUserData = (userData) => {\r\n  if (!userData || typeof userData !== 'object') {\r\n    return false;\r\n  }\r\n\r\n  // Required fields\r\n  const requiredFields = ['_id', 'email', 'role'];\r\n  for (const field of requiredFields) {\r\n    if (!userData[field]) {\r\n      console.warn(`Invalid user data: Missing ${field}`);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  // Validate role\r\n  const validRoles = ['admin', 'technician', 'staff', 'student'];\r\n  if (!validRoles.includes(userData.role)) {\r\n    console.warn(`Invalid user data: Invalid role \"${userData.role}\"`);\r\n    return false;\r\n  }\r\n\r\n  // Validate email format\r\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n  if (!emailRegex.test(userData.email)) {\r\n    console.warn(`Invalid user data: Invalid email \"${userData.email}\"`);\r\n    return false;\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\n/**\r\n * Sanitizes user data before storage\r\n * \r\n * @param {Object} userData - Raw user data\r\n * @returns {Object} Sanitized user data\r\n */\r\nconst sanitizeUserData = (userData) => {\r\n  if (!userData) return null;\r\n  \r\n  const sanitized = { ...userData };\r\n  \r\n  // Remove sensitive fields\r\n  delete sanitized.password;\r\n  delete sanitized.tempPassword;\r\n  delete sanitized.resetToken;\r\n  delete sanitized.verificationToken;\r\n  delete sanitized.__v;\r\n  \r\n  // Ensure role is lowercase\r\n  if (sanitized.role) {\r\n    sanitized.role = sanitized.role.toLowerCase();\r\n  }\r\n  \r\n  return sanitized;\r\n};\r\n\r\n/**\r\n * Sends security events to monitoring service\r\n */\r\nconst sendToSecurityLog = (eventData) => {\r\n  try {\r\n    // Store in localStorage for debugging (remove in production)\r\n    const existingEvents = JSON.parse(localStorage.getItem('security_events') || '[]');\r\n    const event = {\r\n      ...eventData,\r\n      timestamp: new Date().toISOString(),\r\n      userAgent: navigator.userAgent,\r\n    };\r\n    \r\n    existingEvents.push(event);\r\n    \r\n    // Keep only last 50 events\r\n    if (existingEvents.length > 50) {\r\n      existingEvents.shift();\r\n    }\r\n    \r\n    localStorage.setItem('security_events', JSON.stringify(existingEvents));\r\n    \r\n    // Send to backend in production\r\n    if (process.env.NODE_ENV === 'production') {\r\n      api.post('/audit/security-event', event).catch(() => {});\r\n    }\r\n  } catch (e) {\r\n    // Silently fail if localStorage is not available\r\n  }\r\n};\r\n\r\n/**\r\n * AuthProvider Component\r\n * \r\n * @param {Object} props - Component properties\r\n * @param {ReactNode} props.children - Child components\r\n */\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [sessionValid, setSessionValid] = useState(false);\r\n  const [sessionExpiresAt, setSessionExpiresAt] = useState(null);\r\n  const [authError, setAuthError] = useState(null);\r\n  const [authSuccess, setAuthSuccess] = useState(null);\r\n  \r\n  const refreshTimeoutRef = useRef(null);\r\n  const sessionCheckIntervalRef = useRef(null);\r\n  const isRefreshingRef = useRef(false);\r\n  const refreshQueueRef = useRef([]);\r\n\r\n  /**\r\n   * Logs security events for monitoring\r\n   */\r\n  const logSecurityEvent = useCallback((eventType, data = {}) => {\r\n    const securityEvent = {\r\n      timestamp: new Date().toISOString(),\r\n      event: eventType,\r\n      userId: user?._id,\r\n      userRole: user?.role,\r\n      ...data,\r\n      userAgent: navigator.userAgent,\r\n      ip: 'client-ip'\r\n    };\r\n\r\n    // Log to console in development\r\n    if (process.env.NODE_ENV === 'development') {\r\n      console.log('ðŸ”’ Security Event:', securityEvent);\r\n    }\r\n\r\n    // Send to security monitoring service\r\n    sendToSecurityLog(securityEvent);\r\n  }, [user]);\r\n\r\n  /**\r\n   * Clears authentication errors\r\n   */\r\n  const clearError = useCallback(() => {\r\n    setAuthError(null);\r\n  }, []);\r\n\r\n  const clearSuccess = useCallback(() => {\r\n    setAuthSuccess(null);\r\n  }, []);\r\n\r\n  /**\r\n   * Sets authentication error\r\n   */\r\n  const setError = useCallback((message) => {\r\n    setAuthError(message);\r\n    // Auto-clear error after 10 seconds\r\n    setTimeout(() => {\r\n      setAuthError(null);\r\n    }, 10000);\r\n  }, []);\r\n\r\n  /**\r\n   * Sets authentication success message\r\n   */\r\n  const setSuccess = useCallback((message) => {\r\n    setAuthSuccess(message);\r\n    // Auto-clear success after 5 seconds\r\n    setTimeout(() => {\r\n      setAuthSuccess(null);\r\n    }, 5000);\r\n  }, []);\r\n\r\n  /**\r\n   * Refreshes authentication token\r\n   */\r\n  const refreshToken = useCallback(async () => {\r\n    // Prevent multiple concurrent refresh attempts\r\n    if (isRefreshingRef.current) {\r\n      return new Promise((resolve, reject) => {\r\n        refreshQueueRef.current.push({ resolve, reject });\r\n      });\r\n    }\r\n\r\n    try {\r\n      isRefreshingRef.current = true;\r\n      \r\n      const refreshToken = tokenService.getRefreshToken();\r\n      if (!refreshToken) {\r\n        throw new Error('No refresh token available');\r\n      }\r\n\r\n      const response = await api.post('/auth/refresh', { refreshToken });\r\n      \r\n      if (!response.data.success || !response.data.data?.accessToken || !response.data.data?.user) {\r\n        throw new Error('Invalid refresh response');\r\n      }\r\n\r\n      // Validate user data\r\n      if (!validateUserData(response.data.data.user)) {\r\n        throw new Error('Invalid user data in refresh response');\r\n      }\r\n\r\n      const sanitizedUser = sanitizeUserData(response.data.data.user);\r\n      const { accessToken, refreshToken: newRefreshToken } = response.data.data;\r\n      \r\n      // Update tokens in storage\r\n      tokenService.setTokens(accessToken, newRefreshToken);\r\n      tokenService.setUser(sanitizedUser);\r\n      \r\n      // Update state\r\n      setUser(sanitizedUser);\r\n      setSessionValid(true);\r\n      \r\n      // Set new session expiry (24 hours from now)\r\n      const expiryTime = Date.now() + (24 * 60 * 60 * 1000);\r\n      setSessionExpiresAt(expiryTime);\r\n      localStorage.setItem('sessionExpiry', expiryTime.toString());\r\n      \r\n      // Schedule next refresh\r\n      scheduleTokenRefresh();\r\n      \r\n      // Process queued requests\r\n      while (refreshQueueRef.current.length > 0) {\r\n        const queued = refreshQueueRef.current.shift();\r\n        queued.resolve();\r\n      }\r\n      \r\n      logSecurityEvent('token_refresh_success');\r\n      return { success: true, data: response.data.data };\r\n    } catch (error) {\r\n      console.error('Token refresh failed:', error);\r\n      \r\n      // Process queued requests with error\r\n      while (refreshQueueRef.current.length > 0) {\r\n        const queued = refreshQueueRef.current.shift();\r\n        queued.reject(error);\r\n      }\r\n      \r\n      logSecurityEvent('token_refresh_failed', { error: error.message });\r\n      throw error;\r\n    } finally {\r\n      isRefreshingRef.current = false;\r\n    }\r\n  }, [logSecurityEvent]);\r\n\r\n  /**\r\n   * Schedules token refresh before expiry\r\n   */\r\n  const scheduleTokenRefresh = useCallback(() => {\r\n    // Clear existing timeout\r\n    if (refreshTimeoutRef.current) {\r\n      clearTimeout(refreshTimeoutRef.current);\r\n    }\r\n\r\n    // Schedule refresh 5 minutes before expiry\r\n    const refreshTime = sessionExpiresAt \r\n      ? sessionExpiresAt - (5 * 60 * 1000) - Date.now()\r\n      : 55 * 60 * 1000; // Default: 55 minutes\r\n\r\n    if (refreshTime > 0) {\r\n      refreshTimeoutRef.current = setTimeout(async () => {\r\n        try {\r\n          await refreshToken();\r\n        } catch (error) {\r\n          console.error('Scheduled token refresh failed:', error);\r\n          // Don't logout immediately, let session monitoring handle it\r\n        }\r\n      }, refreshTime);\r\n    }\r\n  }, [sessionExpiresAt, refreshToken]);\r\n\r\n  /**\r\n   * Starts session monitoring\r\n   */\r\n  const startSessionMonitoring = useCallback(() => {\r\n    // Clear existing interval\r\n    if (sessionCheckIntervalRef.current) {\r\n      clearInterval(sessionCheckIntervalRef.current);\r\n    }\r\n\r\n    // Check session every minute\r\n    sessionCheckIntervalRef.current = setInterval(() => {\r\n      if (sessionExpiresAt && Date.now() > sessionExpiresAt) {\r\n        console.warn('Session expired during monitoring');\r\n        logout('session_expired');\r\n      }\r\n    }, 60 * 1000);\r\n  }, [sessionExpiresAt]);\r\n\r\n  /**\r\n   * Handles user logout\r\n   */\r\n  const logout = useCallback((reason = 'user_initiated') => {\r\n    // Clear state\r\n    setUser(null);\r\n    setSessionValid(false);\r\n    setSessionExpiresAt(null);\r\n    setAuthError(null);\r\n    setAuthSuccess(null);\r\n    \r\n    // Clear timeouts and intervals\r\n    if (refreshTimeoutRef.current) {\r\n      clearTimeout(refreshTimeoutRef.current);\r\n      refreshTimeoutRef.current = null;\r\n    }\r\n    \r\n    if (sessionCheckIntervalRef.current) {\r\n      clearInterval(sessionCheckIntervalRef.current);\r\n      sessionCheckIntervalRef.current = null;\r\n    }\r\n    \r\n    // Clear storage\r\n    tokenService.clearTokens();\r\n    localStorage.removeItem('sessionExpiry');\r\n    localStorage.removeItem('rememberMe');\r\n    localStorage.removeItem('security_events');\r\n    \r\n    // Call backend logout if possible\r\n    api.post('/auth/logout').catch(error => {\r\n      console.error('Backend logout failed:', error);\r\n    });\r\n    \r\n    // Log logout event\r\n    logSecurityEvent('logout', { reason });\r\n    \r\n    // Clear refresh queue\r\n    refreshQueueRef.current = [];\r\n    \r\n    console.log('ðŸ‘‹ User logged out:', reason);\r\n  }, [logSecurityEvent]);\r\n\r\n  /**\r\n   * Handles user login\r\n   */\r\n  const login = useCallback(async (email, password, rememberMe = false) => {\r\n    try {\r\n      setAuthError(null);\r\n      setAuthSuccess(null);\r\n      setLoading(true);\r\n\r\n      console.log('ðŸ” Attempting login for:', email);\r\n      \r\n      const response = await api.post('/auth/login', {\r\n        email: email.toLowerCase().trim(),\r\n        password: password.trim(),\r\n        rememberMe\r\n      });\r\n      \r\n      console.log('ðŸ” Login response:', response.data);\r\n      \r\n      if (!response.data.success) {\r\n        throw new Error(response.data.message || 'Login failed');\r\n      }\r\n\r\n      if (!response.data.data?.user || !response.data.data?.accessToken) {\r\n        throw new Error('Invalid login response format');\r\n      }\r\n\r\n      // Validate user data\r\n      if (!validateUserData(response.data.data.user)) {\r\n        throw new Error('Invalid user data received from server');\r\n      }\r\n\r\n      const sanitizedUser = sanitizeUserData(response.data.data.user);\r\n      const { accessToken, refreshToken } = response.data.data;\r\n      \r\n      // Store tokens\r\n      tokenService.setTokens(accessToken, refreshToken);\r\n      tokenService.setUser(sanitizedUser);\r\n      \r\n      // Update state\r\n      setUser(sanitizedUser);\r\n      setSessionValid(true);\r\n      \r\n      // Calculate session expiry\r\n      const expiryTime = Date.now() + (24 * 60 * 60 * 1000); // 24 hours\r\n      setSessionExpiresAt(expiryTime);\r\n      \r\n      if (rememberMe) {\r\n        localStorage.setItem('sessionExpiry', expiryTime.toString());\r\n        localStorage.setItem('rememberMe', 'true');\r\n      }\r\n\r\n      // Schedule token refresh\r\n      scheduleTokenRefresh();\r\n      \r\n      // Start session monitoring\r\n      startSessionMonitoring();\r\n      \r\n      // Log successful login\r\n      logSecurityEvent('login_success', { email, role: sanitizedUser.role });\r\n      \r\n      console.log('âœ… Login successful:', sanitizedUser.email);\r\n      \r\n      return {\r\n        success: true,\r\n        message: 'Login successful',\r\n        data: response.data.data\r\n      };\r\n    } catch (error) {\r\n      console.error('âŒ Login error:', error);\r\n      \r\n      // Log failed login attempt\r\n      logSecurityEvent('login_failed', { email, error: error.message });\r\n      \r\n      const errorMessage = error.response?.data?.message || \r\n                          error.message || \r\n                          'Login failed. Please check your credentials.';\r\n      \r\n      setError(errorMessage);\r\n      throw error;\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [scheduleTokenRefresh, startSessionMonitoring, setError, logSecurityEvent]);\r\n\r\n  /**\r\n   * Handles user registration\r\n   */\r\n  const register = useCallback(async (userData) => {\r\n    try {\r\n      setAuthError(null);\r\n      setAuthSuccess(null);\r\n      setLoading(true);\r\n\r\n      console.log('ðŸ“ Attempting registration for:', userData.email);\r\n      \r\n      const response = await api.post('/auth/register', userData);\r\n      \r\n      console.log('ðŸ“ Registration response:', response.data);\r\n      \r\n      if (!response.data.success) {\r\n        throw new Error(response.data.message || 'Registration failed');\r\n      }\r\n\r\n      // Check if email verification is required\r\n      const requiresVerification = response.data.data?.requiresEmailVerification || false;\r\n      \r\n      if (requiresVerification) {\r\n        // Don't log in automatically, just show success message\r\n        console.log('ðŸ“§ Email verification required');\r\n        setSuccess('Registration successful! Please check your email to verify your account.');\r\n        \r\n        // Log successful registration (pending verification)\r\n        logSecurityEvent('registration_pending_verification', { \r\n          email: userData.email, \r\n          role: userData.role \r\n        });\r\n        \r\n        return {\r\n          ...response.data,\r\n          requiresVerification: true,\r\n          message: 'Registration successful! Please check your email to verify your account.'\r\n        };\r\n      }\r\n\r\n      // If no verification required, proceed with auto-login\r\n      if (!response.data.data?.user || !response.data.data?.accessToken) {\r\n        throw new Error('Invalid registration response format');\r\n      }\r\n\r\n      // Validate user data\r\n      if (!validateUserData(response.data.data.user)) {\r\n        throw new Error('Invalid user data received from server');\r\n      }\r\n\r\n      const sanitizedUser = sanitizeUserData(response.data.data.user);\r\n      const { accessToken, refreshToken } = response.data.data;\r\n      \r\n      // Store tokens\r\n      tokenService.setTokens(accessToken, refreshToken);\r\n      tokenService.setUser(sanitizedUser);\r\n      \r\n      // Update state\r\n      setUser(sanitizedUser);\r\n      setSessionValid(true);\r\n      \r\n      // Calculate session expiry\r\n      const expiryTime = Date.now() + (24 * 60 * 60 * 1000); // 24 hours\r\n      setSessionExpiresAt(expiryTime);\r\n      \r\n      // Store in localStorage\r\n      localStorage.setItem('sessionExpiry', expiryTime.toString());\r\n\r\n      // Schedule token refresh\r\n      scheduleTokenRefresh();\r\n      \r\n      // Start session monitoring\r\n      startSessionMonitoring();\r\n      \r\n      // Log successful registration\r\n      logSecurityEvent('registration_success', { \r\n        email: sanitizedUser.email, \r\n        role: sanitizedUser.role \r\n      });\r\n      \r\n      console.log('âœ… Registration successful:', sanitizedUser.email);\r\n      \r\n      return {\r\n        ...response.data,\r\n        requiresVerification: false,\r\n        message: 'Registration successful! You are now logged in.'\r\n      };\r\n    } catch (error) {\r\n      console.error('âŒ Registration error:', error);\r\n      \r\n      // Log failed registration\r\n      logSecurityEvent('registration_failed', { \r\n        email: userData.email, \r\n        error: error.message,\r\n        role: userData.role\r\n      });\r\n      \r\n      let errorMessage = 'Registration failed. Please try again.';\r\n      \r\n      if (error.response?.data?.message) {\r\n        errorMessage = error.response.data.message;\r\n      } else if (error.response?.data?.errors) {\r\n        // Handle validation errors\r\n        const validationErrors = error.response.data.errors;\r\n        if (Array.isArray(validationErrors)) {\r\n          errorMessage = validationErrors.map(err => err.message || err.msg).join('. ');\r\n        } else if (typeof validationErrors === 'object') {\r\n          errorMessage = Object.values(validationErrors).join('. ');\r\n        }\r\n      }\r\n      \r\n      setError(errorMessage);\r\n      throw new Error(errorMessage);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [scheduleTokenRefresh, startSessionMonitoring, setError, setSuccess, logSecurityEvent]);\r\n\r\n  /**\r\n   * Initializes authentication state from storage\r\n   */\r\n  const initializeAuth = useCallback(async () => {\r\n    try {\r\n      setLoading(true);\r\n      setAuthError(null);\r\n      setAuthSuccess(null);\r\n\r\n      const token = tokenService.getToken();\r\n      const savedUser = tokenService.getUser();\r\n      const sessionExpiry = localStorage.getItem('sessionExpiry');\r\n\r\n      if (!token || !savedUser) {\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      // Validate saved user\r\n      if (!validateUserData(savedUser)) {\r\n        console.warn('Invalid user data in storage, logging out');\r\n        logout('invalid_user_data');\r\n        return;\r\n      }\r\n\r\n      // Check session expiry\r\n      if (sessionExpiry) {\r\n        const expiryTime = parseInt(sessionExpiry, 10);\r\n        if (Date.now() > expiryTime) {\r\n          console.warn('Session expired, logging out');\r\n          logout('session_expired');\r\n          return;\r\n        }\r\n        setSessionExpiresAt(expiryTime);\r\n      }\r\n\r\n      // Verify token with backend\r\n      try {\r\n        const response = await api.get('/auth/me');\r\n        \r\n        if (!response.data.success) {\r\n          throw new Error(response.data.message || 'Failed to get current user');\r\n        }\r\n\r\n        const userData = response.data.data?.user;\r\n        \r\n        if (!validateUserData(userData)) {\r\n          throw new Error('Invalid user data received from server');\r\n        }\r\n\r\n        const sanitizedUser = sanitizeUserData(userData);\r\n        setUser(sanitizedUser);\r\n        setSessionValid(true);\r\n        \r\n        // Update storage with fresh data\r\n        tokenService.setUser(sanitizedUser);\r\n        \r\n        // Schedule token refresh\r\n        scheduleTokenRefresh();\r\n        \r\n        // Start session monitoring\r\n        startSessionMonitoring();\r\n        \r\n        console.log('âœ… Auth initialized successfully:', sanitizedUser.email);\r\n        \r\n      } catch (error) {\r\n        console.error('Token verification failed:', error);\r\n        \r\n        // Try to refresh token\r\n        try {\r\n          await refreshToken();\r\n        } catch (refreshError) {\r\n          console.error('Token refresh failed:', refreshError);\r\n          logout('session_verification_failed');\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Auth initialization error:', error);\r\n      setError('Authentication initialization failed');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [logout, refreshToken, scheduleTokenRefresh, startSessionMonitoring, setError]);\r\n\r\n  /**\r\n   * Checks if user has required role(s)\r\n   */\r\n  const hasRole = useCallback((roles) => {\r\n    if (!user || !user.role) return false;\r\n    \r\n    const rolesToCheck = Array.isArray(roles) ? roles : [roles];\r\n    return rolesToCheck.includes(user.role);\r\n  }, [user]);\r\n\r\n  /**\r\n   * Checks if user has required permission(s)\r\n   */\r\n  const hasPermission = useCallback((permissions) => {\r\n    if (!user || !user.permissions) return false;\r\n    \r\n    const permissionsToCheck = Array.isArray(permissions) ? permissions : [permissions];\r\n    return permissionsToCheck.every(permission => \r\n      user.permissions?.includes(permission)\r\n    );\r\n  }, [user]);\r\n\r\n  /**\r\n   * Checks if session is valid and active\r\n   */\r\n  const checkSession = useCallback(async () => {\r\n    if (!user) return false;\r\n    \r\n    try {\r\n      await api.get('/auth/me');\r\n      return true;\r\n    } catch (error) {\r\n      return false;\r\n    }\r\n  }, [user]);\r\n\r\n  /**\r\n   * Updates user profile\r\n   */\r\n  const updateProfile = useCallback(async (updates) => {\r\n    try {\r\n      const response = await api.put('/users/profile', updates);\r\n      \r\n      if (response.data.success && response.data.data?.user) {\r\n        const sanitizedUser = sanitizeUserData(response.data.data.user);\r\n        setUser(sanitizedUser);\r\n        tokenService.setUser(sanitizedUser);\r\n      }\r\n      \r\n      return response.data;\r\n    } catch (error) {\r\n      console.error('Profile update error:', error);\r\n      throw error;\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Changes user password\r\n   */\r\n  const changePassword = useCallback(async (currentPassword, newPassword) => {\r\n    try {\r\n      const response = await api.put('/users/change-password', {\r\n        currentPassword,\r\n        newPassword\r\n      });\r\n      \r\n      if (response.data.success) {\r\n        logSecurityEvent('password_changed');\r\n      }\r\n      \r\n      return response.data;\r\n    } catch (error) {\r\n      console.error('Password change error:', error);\r\n      throw error;\r\n    }\r\n  }, [logSecurityEvent]);\r\n\r\n  /**\r\n   * Requests password reset\r\n   */\r\n  const forgotPassword = useCallback(async (email) => {\r\n    try {\r\n      const response = await api.post('/auth/forgot-password', { email });\r\n      return response.data;\r\n    } catch (error) {\r\n      console.error('Forgot password error:', error);\r\n      throw error;\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Resets password with token\r\n   */\r\n  const resetPassword = useCallback(async (token, newPassword) => {\r\n    try {\r\n      const response = await api.post('/auth/reset-password', {\r\n        token,\r\n        password: newPassword\r\n      });\r\n      return response.data;\r\n    } catch (error) {\r\n      console.error('Reset password error:', error);\r\n      throw error;\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Verifies email with token\r\n   */\r\n  const verifyEmail = useCallback(async (token) => {\r\n    try {\r\n      const response = await api.get(`/auth/verify-email/${token}`);\r\n      return response.data;\r\n    } catch (error) {\r\n      console.error('Email verification error:', error);\r\n      throw error;\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Checks if email is available\r\n   */\r\n  const checkEmail = useCallback(async (email) => {\r\n    try {\r\n      const response = await api.post('/auth/check-email', { email });\r\n      return response.data;\r\n    } catch (error) {\r\n      console.error('Check email error:', error);\r\n      throw error;\r\n    }\r\n  }, []);\r\n\r\n  /**\r\n   * Checks if username is available\r\n   */\r\n  const checkUsername = useCallback(async (username) => {\r\n    try {\r\n      const response = await api.post('/auth/check-username', { username });\r\n      return response.data;\r\n    } catch (error) {\r\n      console.error('Check username error:', error);\r\n      throw error;\r\n    }\r\n  }, []);\r\n\r\n  // Initialize authentication on mount\r\n  useEffect(() => {\r\n    initializeAuth();\r\n\r\n    // Cleanup on unmount\r\n    return () => {\r\n      if (refreshTimeoutRef.current) {\r\n        clearTimeout(refreshTimeoutRef.current);\r\n      }\r\n      if (sessionCheckIntervalRef.current) {\r\n        clearInterval(sessionCheckIntervalRef.current);\r\n      }\r\n    };\r\n  }, [initializeAuth]);\r\n\r\n  // Context value\r\n  const value = {\r\n    // State\r\n    user,\r\n    loading,\r\n    sessionValid,\r\n    sessionExpiresAt,\r\n    authError,\r\n    authSuccess,\r\n    \r\n    // Authentication methods\r\n    login,\r\n    register,\r\n    logout,\r\n    refreshToken,\r\n    checkSession,\r\n    \r\n    // User management\r\n    updateProfile,\r\n    changePassword,\r\n    forgotPassword,\r\n    resetPassword,\r\n    verifyEmail,\r\n    \r\n    // Validation\r\n    checkEmail,\r\n    checkUsername,\r\n    \r\n    // Access control\r\n    hasRole,\r\n    hasPermission,\r\n    \r\n    // Security logging\r\n    logSecurityEvent,\r\n    \r\n    // Utility\r\n    isAuthenticated: !!user && sessionValid,\r\n    clearError,\r\n    clearSuccess,\r\n    setError,\r\n    setSuccess\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\n// PropTypes\r\nAuthProvider.propTypes = {\r\n  children: PropTypes.node.isRequired\r\n};\r\n\r\n// Export both as named exports and default\r\nexport default AuthContext;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}