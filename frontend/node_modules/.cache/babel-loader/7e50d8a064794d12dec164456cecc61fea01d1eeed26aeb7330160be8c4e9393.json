{"ast":null,"code":"/**\r\n * Email Service - Production Ready with Gmail\r\n * \r\n * Comprehensive email service with queue management, retry logic,\r\n * and fallback mechanisms for the Bugema University IT Support System.\r\n * \r\n * Features:\r\n * - Gmail SMTP integration with secure authentication\r\n * - Email queue with rate limiting\r\n * - Automatic retry on failure (3 attempts)\r\n * - Fallback to file logging in development\r\n * - Professional HTML email templates\r\n * - Text-only fallback versions\r\n * - Connection pooling for performance\r\n * - Email validation\r\n * - Status monitoring\r\n * \r\n * @version 3.0.0\r\n * @author Bugema University IT Support System\r\n */\n\nconst nodemailer = require('nodemailer');\nconst fs = require('fs');\nconst path = require('path');\nclass EmailService {\n  constructor() {\n    // Email transporter (SMTP connection)\n    this.transporter = null;\n\n    // Service state\n    this.isConfigured = false;\n    this.retryCount = 0;\n    this.maxRetries = 3;\n\n    // Email queue management\n    this.queue = [];\n    this.processingQueue = false;\n\n    // Initialize service\n    this.init();\n    this.startQueueProcessor();\n  }\n\n  // ==========================================================================\n  // INITIALIZATION\n  // ==========================================================================\n\n  /**\r\n   * Initialize email service with Gmail SMTP\r\n   */\n  init() {\n    try {\n      const emailConfig = this.getEmailConfig();\n\n      // Check if email is properly configured\n      if (!emailConfig.valid) {\n        console.warn('‚ö†Ô∏è  Email configuration incomplete:', emailConfig.missing);\n        this.setupFallbackLogging();\n        return;\n      }\n\n      // Create SMTP transporter\n      this.transporter = nodemailer.createTransport({\n        host: emailConfig.host,\n        port: emailConfig.port,\n        secure: emailConfig.secure,\n        // true for 465, false for 587\n        auth: {\n          user: emailConfig.username,\n          pass: emailConfig.password\n        },\n        tls: {\n          rejectUnauthorized: false // Allow self-signed certificates in dev\n        },\n        pool: true,\n        // Use connection pooling for better performance\n        maxConnections: 5,\n        // Maximum concurrent connections\n        maxMessages: 100 // Maximum messages per connection\n      });\n\n      // Verify connection\n      this.verifyConnection();\n      this.isConfigured = true;\n    } catch (error) {\n      console.error('‚ùå Email service initialization failed:', error.message);\n      this.setupFallbackLogging();\n    }\n  }\n\n  /**\r\n   * Get and validate email configuration from environment variables\r\n   * \r\n   * @returns {Object} Email configuration with validation status\r\n   */\n  getEmailConfig() {\n    // Required environment variables\n    const required = ['EMAIL_HOST', 'EMAIL_USERNAME', 'EMAIL_PASSWORD'];\n    const missing = required.filter(key => !process.env[key]);\n\n    // Return validation result\n    if (missing.length > 0) {\n      return {\n        valid: false,\n        missing\n      };\n    }\n    return {\n      valid: true,\n      host: process.env.EMAIL_HOST,\n      port: parseInt(process.env.EMAIL_PORT) || 587,\n      secure: process.env.EMAIL_SECURE === 'true',\n      username: process.env.EMAIL_USERNAME,\n      password: process.env.EMAIL_PASSWORD,\n      from: process.env.EMAIL_FROM || process.env.EMAIL_USERNAME,\n      fromName: process.env.EMAIL_FROM_NAME || 'Bugema IT Support'\n    };\n  }\n\n  /**\r\n   * Verify SMTP connection with retry logic\r\n   */\n  async verifyConnection() {\n    try {\n      await this.transporter.verify();\n      console.log('‚úÖ Email service connected to Gmail successfully');\n      this.retryCount = 0;\n    } catch (error) {\n      console.error('‚ùå Email connection failed:', error.message);\n\n      // Retry connection with exponential backoff\n      if (this.retryCount < this.maxRetries) {\n        this.retryCount++;\n        const delay = this.retryCount * 2;\n        console.log(`üîÑ Retrying connection in ${delay} seconds... (Attempt ${this.retryCount}/${this.maxRetries})`);\n        setTimeout(() => this.verifyConnection(), delay * 1000);\n      } else {\n        console.log('üìß Maximum retries reached. Falling back to logging mode');\n        this.setupFallbackLogging();\n      }\n    }\n  }\n\n  /**\r\n   * Setup fallback logging for development/testing\r\n   */\n  setupFallbackLogging() {\n    const logsDir = path.join(__dirname, '../../logs');\n    if (!fs.existsSync(logsDir)) {\n      fs.mkdirSync(logsDir, {\n        recursive: true\n      });\n    }\n    console.log('üìß Running in development mode - emails will be logged to logs/emails.log');\n  }\n\n  // ==========================================================================\n  // EMAIL SENDING\n  // ==========================================================================\n\n  /**\r\n   * Send email with automatic retry and queue management\r\n   * \r\n   * @param {Object} options - Email options\r\n   * @param {string} options.to - Recipient email address\r\n   * @param {string} options.subject - Email subject\r\n   * @param {string} options.template - Template name\r\n   * @param {Object} options.context - Template context data\r\n   * @returns {Promise<Object>} Send result\r\n   */\n  async sendEmail(options) {\n    // Validate email address\n    if (!this.validateEmail(options.to)) {\n      return this.handleError('Invalid email address', options);\n    }\n\n    // Add email to queue for processing\n    return new Promise(resolve => {\n      this.queue.push({\n        options,\n        resolve\n      });\n      this.processQueue();\n    });\n  }\n\n  /**\r\n   * Process email queue with rate limiting\r\n   */\n  async processQueue() {\n    // Prevent concurrent queue processing\n    if (this.processingQueue || this.queue.length === 0) return;\n    this.processingQueue = true;\n    while (this.queue.length > 0) {\n      const {\n        options,\n        resolve\n      } = this.queue.shift();\n      try {\n        const result = await this.sendEmailDirect(options);\n        resolve(result);\n      } catch (error) {\n        const errorResult = this.handleError(error.message, options);\n        resolve(errorResult);\n      }\n\n      // Rate limiting: 100ms delay between emails to prevent spam flags\n      await new Promise(resolve => setTimeout(resolve, 100));\n    }\n    this.processingQueue = false;\n  }\n\n  /**\r\n   * Start automatic queue processor (runs every second)\r\n   */\n  startQueueProcessor() {\n    setInterval(() => this.processQueue(), 1000);\n  }\n\n  /**\r\n   * Direct email sending with retry logic\r\n   * \r\n   * @param {Object} options - Email options\r\n   * @returns {Promise<Object>} Send result\r\n   */\n  async sendEmailDirect(options) {\n    const emailConfig = this.getEmailConfig();\n\n    // If not configured or in development, log to file\n    if (!this.isConfigured || process.env.NODE_ENV !== 'production') {\n      return this.logEmailToFile(options);\n    }\n\n    // Production sending with retry logic (3 attempts)\n    for (let attempt = 1; attempt <= 3; attempt++) {\n      try {\n        const mailOptions = {\n          from: `${emailConfig.fromName} <${emailConfig.from}>`,\n          to: options.to,\n          subject: options.subject,\n          html: this.getTemplate(options.template, options.context),\n          text: options.text || this.getTextVersion(options.template, options.context),\n          replyTo: process.env.EMAIL_REPLY_TO || emailConfig.from,\n          headers: {\n            'X-Priority': '1',\n            'X-Mailer': 'BugemaITSupport/3.0'\n          }\n        };\n        const info = await this.transporter.sendMail(mailOptions);\n        console.log('‚úÖ Email sent successfully:', {\n          to: options.to,\n          messageId: info.messageId,\n          subject: options.subject.substring(0, 50)\n        });\n        return {\n          success: true,\n          messageId: info.messageId,\n          timestamp: new Date().toISOString()\n        };\n      } catch (error) {\n        console.error(`‚ùå Email attempt ${attempt} failed:`, error.message);\n\n        // If this was the final attempt, log to file as fallback\n        if (attempt === 3) {\n          return this.logEmailToFile(options, error.message);\n        }\n\n        // Wait before retry (exponential backoff: 1s, 2s, 3s)\n        await new Promise(resolve => setTimeout(resolve, attempt * 1000));\n      }\n    }\n  }\n\n  /**\r\n   * Log email to file (fallback for development/failures)\r\n   * \r\n   * @param {Object} options - Email options\r\n   * @param {string} error - Error message (if any)\r\n   * @returns {Object} Log result\r\n   */\n  logEmailToFile(options, error = null) {\n    const logsDir = path.join(__dirname, '../../logs');\n    const emailLogFile = path.join(logsDir, 'emails.log');\n\n    // Ensure logs directory exists\n    if (!fs.existsSync(logsDir)) {\n      fs.mkdirSync(logsDir, {\n        recursive: true\n      });\n    }\n\n    // Create log entry\n    const logEntry = {\n      timestamp: new Date().toISOString(),\n      to: options.to,\n      subject: options.subject,\n      template: options.template,\n      context: options.context,\n      error: error,\n      mode: this.isConfigured ? 'production-fallback' : 'development'\n    };\n\n    // Append to log file\n    const logLine = JSON.stringify(logEntry) + '\\n';\n    fs.appendFileSync(emailLogFile, logLine, {\n      encoding: 'utf8'\n    });\n    console.log('üìß Email logged to file:', {\n      to: options.to,\n      subject: options.subject,\n      logFile: 'logs/emails.log'\n    });\n    return {\n      success: !error,\n      simulated: true,\n      logged: true,\n      error: error,\n      timestamp: new Date().toISOString()\n    };\n  }\n\n  // ==========================================================================\n  // EMAIL TEMPLATES\n  // ==========================================================================\n\n  /**\r\n   * Get HTML email template\r\n   * \r\n   * @param {string} template - Template name\r\n   * @param {Object} context - Template context data\r\n   * @returns {string} HTML email content\r\n   */\n  getTemplate(template, context = {}) {\n    const templates = {\n      // ========================================================================\n      // EMAIL VERIFICATION TEMPLATE\n      // ========================================================================\n      emailVerification: `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <meta charset=\"UTF-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <title>Verify Your Email - Bugema University</title>\n          <style>\n            body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; background: #f5f5f5; }\n            .container { max-width: 600px; margin: 20px auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.1); }\n            .header { background: linear-gradient(135deg, #1a56db 0%, #1e40af 100%); color: white; padding: 40px 20px; text-align: center; }\n            .content { padding: 40px; }\n            .button { display: inline-block; padding: 15px 30px; background: #1a56db; color: white; text-decoration: none; border-radius: 5px; font-weight: bold; font-size: 16px; margin: 25px 0; }\n            .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #6c757d; font-size: 12px; border-top: 1px solid #e9ecef; }\n            .university-logo { font-size: 28px; font-weight: bold; color: white; margin-bottom: 10px; }\n            .warning { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; padding: 15px; margin: 20px 0; color: #856404; }\n            .code { background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 14px; margin: 10px 0; word-break: break-all; }\n          </style>\n        </head>\n        <body>\n          <div class=\"container\">\n            <div class=\"header\">\n              <div class=\"university-logo\">BUGEMA UNIVERSITY</div>\n              <h1 style=\"margin: 10px 0; font-weight: 300;\">IT Support System</h1>\n            </div>\n            \n            <div class=\"content\">\n              <h2 style=\"color: #1a56db; margin-top: 0;\">Verify Your Email Address</h2>\n              \n              <p>Dear <strong>${context.name || 'Valued User'}</strong>,</p>\n              \n              <p>Welcome to the Bugema University IT Support System! To complete your registration and access all features, please verify your email address by clicking the button below:</p>\n              \n              <div style=\"text-align: center; margin: 30px 0;\">\n                <a href=\"${context.verificationUrl}\" class=\"button\" style=\"color: white; text-decoration: none;\">Verify Email Address</a>\n              </div>\n              \n              <div class=\"warning\">\n                <strong>‚ö†Ô∏è Important:</strong> This verification link will expire in <strong>24 hours</strong>.\n              </div>\n              \n              <p>If the button doesn't work, copy and paste this URL into your browser:</p>\n              <div class=\"code\">${context.verificationUrl}</div>\n              \n              <p>If you didn't create an account with Bugema University IT Support, please ignore this email or contact our support team immediately.</p>\n              \n              <p style=\"margin-top: 30px;\">\n                Best regards,<br>\n                <strong>IT Support Team</strong><br>\n                Bugema University<br>\n                <small style=\"color: #6c757d;\">Providing technical excellence since 1948</small>\n              </p>\n            </div>\n            \n            <div class=\"footer\">\n              <p>¬© ${new Date().getFullYear()} Bugema University. All rights reserved.</p>\n              <p>This is an automated message. Please do not reply to this email.</p>\n              <p>For assistance, contact: <a href=\"mailto:itsupport@bugema.ac.ug\">itsupport@bugema.ac.ug</a></p>\n            </div>\n          </div>\n        </body>\n        </html>\n      `,\n      // ========================================================================\n      // PASSWORD RESET REQUEST TEMPLATE\n      // ========================================================================\n      passwordReset: `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <meta charset=\"UTF-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <title>Password Reset - Bugema University</title>\n          <style>\n            body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; background: #f5f5f5; }\n            .container { max-width: 600px; margin: 20px auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.1); }\n            .header { background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white; padding: 40px 20px; text-align: center; }\n            .content { padding: 40px; }\n            .button { display: inline-block; padding: 15px 30px; background: #dc2626; color: white; text-decoration: none; border-radius: 5px; font-weight: bold; font-size: 16px; margin: 25px 0; }\n            .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #6c757d; font-size: 12px; border-top: 1px solid #e9ecef; }\n            .security-alert { background: #fee; border: 1px solid #fcc; border-radius: 5px; padding: 15px; margin: 20px 0; color: #c00; }\n            .code { background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 14px; margin: 10px 0; word-break: break-all; }\n          </style>\n        </head>\n        <body>\n          <div class=\"container\">\n            <div class=\"header\">\n              <h1 style=\"margin: 0; font-weight: 300;\">üîí Password Reset Request</h1>\n              <p style=\"margin: 10px 0 0; opacity: 0.9;\">Bugema University IT Support System</p>\n            </div>\n            \n            <div class=\"content\">\n              <h2 style=\"color: #dc2626; margin-top: 0;\">Reset Your Password</h2>\n              \n              <p>Hello <strong>${context.name || 'User'}</strong>,</p>\n              \n              <p>We received a request to reset your password for the Bugema University IT Support System. To reset your password, click the button below:</p>\n              \n              <div style=\"text-align: center; margin: 30px 0;\">\n                <a href=\"${context.resetUrl}\" class=\"button\" style=\"color: white; text-decoration: none;\">Reset Password</a>\n              </div>\n              \n              <div class=\"security-alert\">\n                <strong>üîê Security Notice:</strong>\n                <ul style=\"margin: 10px 0; padding-left: 20px;\">\n                  <li>This link expires in <strong>10 minutes</strong></li>\n                  <li>If you didn't request this reset, ignore this email</li>\n                  <li>Never share your password or this link with anyone</li>\n                  <li>Contact support immediately if suspicious</li>\n                </ul>\n              </div>\n              \n              <p>If the button doesn't work, use this link:</p>\n              <div class=\"code\">${context.resetUrl}</div>\n              \n              <p style=\"margin-top: 30px;\">\n                Best regards,<br>\n                <strong>IT Security Team</strong><br>\n                Bugema University\n              </p>\n            </div>\n            \n            <div class=\"footer\">\n              <p>¬© ${new Date().getFullYear()} Bugema University IT Security</p>\n              <p>This is an automated security message. Do not reply.</p>\n              <p>For security concerns: <a href=\"mailto:security@bugema.ac.ug\">security@bugema.ac.ug</a></p>\n            </div>\n          </div>\n        </body>\n        </html>\n      `,\n      // ========================================================================\n      // PASSWORD RESET SUCCESS TEMPLATE\n      // ========================================================================\n      passwordResetSuccess: `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <meta charset=\"UTF-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <title>Password Reset Successful - Bugema University</title>\n          <style>\n            body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; background: #f5f5f5; }\n            .container { max-width: 600px; margin: 20px auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.1); }\n            .header { background: linear-gradient(135deg, #059669 0%, #047857 100%); color: white; padding: 40px 20px; text-align: center; }\n            .content { padding: 40px; }\n            .button { display: inline-block; padding: 15px 30px; background: #059669; color: white; text-decoration: none; border-radius: 5px; font-weight: bold; font-size: 16px; margin: 25px 0; }\n            .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #6c757d; font-size: 12px; border-top: 1px solid #e9ecef; }\n            .success-icon { font-size: 48px; margin-bottom: 20px; }\n            .security-tips { background: #f0fdf4; border: 1px solid #86efac; border-radius: 5px; padding: 15px; margin: 20px 0; }\n          </style>\n        </head>\n        <body>\n          <div class=\"container\">\n            <div class=\"header\">\n              <div class=\"success-icon\">‚úÖ</div>\n              <h1 style=\"margin: 0; font-weight: 300;\">Password Reset Successful</h1>\n              <p style=\"margin: 10px 0 0; opacity: 0.9;\">Bugema University IT Support System</p>\n            </div>\n            \n            <div class=\"content\">\n              <h2 style=\"color: #059669; margin-top: 0;\">Your Password Has Been Changed</h2>\n              \n              <p>Hello <strong>${context.name || 'User'}</strong>,</p>\n              \n              <p>This email confirms that your password for the Bugema University IT Support System has been successfully reset and updated.</p>\n              \n              <div class=\"security-tips\">\n                <strong>üîê Security Tips:</strong>\n                <ul style=\"margin: 10px 0; padding-left: 20px;\">\n                  <li>Never share your password with anyone</li>\n                  <li>Use a unique password for each account</li>\n                  <li>Enable two-factor authentication when available</li>\n                  <li>Change your password regularly</li>\n                </ul>\n              </div>\n              \n              <p><strong>‚ö†Ô∏è Important:</strong> If you did NOT make this change, please contact our IT Security team immediately at <a href=\"mailto:security@bugema.ac.ug\">security@bugema.ac.ug</a></p>\n              \n              <div style=\"text-align: center; margin: 30px 0;\">\n                <a href=\"${process.env.CLIENT_URL || 'http://localhost:3000'}/login\" class=\"button\" style=\"color: white; text-decoration: none;\">Login to Your Account</a>\n              </div>\n              \n              <p style=\"margin-top: 30px;\">\n                Best regards,<br>\n                <strong>IT Security Team</strong><br>\n                Bugema University<br>\n                <small style=\"color: #6c757d;\">Keeping your account secure since 1948</small>\n              </p>\n            </div>\n            \n            <div class=\"footer\">\n              <p>¬© ${new Date().getFullYear()} Bugema University IT Security</p>\n              <p>This is an automated security notification. Please do not reply.</p>\n              <p>For security concerns: <a href=\"mailto:security@bugema.ac.ug\">security@bugema.ac.ug</a></p>\n            </div>\n          </div>\n        </body>\n        </html>\n      `,\n      // ========================================================================\n      // WELCOME EMAIL TEMPLATE\n      // ========================================================================\n      welcome: `\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <meta charset=\"UTF-8\">\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n          <title>Welcome to Bugema IT Support</title>\n          <style>\n            body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; background: #f5f5f5; }\n            .container { max-width: 600px; margin: 20px auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.1); }\n            .header { background: linear-gradient(135deg, #059669 0%, #047857 100%); color: white; padding: 40px 20px; text-align: center; }\n            .content { padding: 40px; }\n            .button { display: inline-block; padding: 15px 30px; background: #059669; color: white; text-decoration: none; border-radius: 5px; font-weight: bold; font-size: 16px; margin: 25px 0; }\n            .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #6c757d; font-size: 12px; border-top: 1px solid #e9ecef; }\n            .features { background: #f0fdf4; border-radius: 5px; padding: 20px; margin: 20px 0; }\n            .feature-item { margin: 10px 0; }\n          </style>\n        </head>\n        <body>\n          <div class=\"container\">\n            <div class=\"header\">\n              <h1 style=\"margin: 0; font-weight: 300;\">Welcome to Bugema IT Support! üëã</h1>\n            </div>\n            \n            <div class=\"content\">\n              <h2 style=\"color: #059669; margin-top: 0;\">Hello ${context.name}!</h2>\n              \n              <p>Your account is now fully activated and ready to use.</p>\n              \n              <div class=\"features\">\n                <h3 style=\"margin-top: 0; color: #059669;\">What You Can Do:</h3>\n                <div class=\"feature-item\">‚úì Submit IT support tickets</div>\n                <div class=\"feature-item\">‚úì Track ticket status in real-time</div>\n                <div class=\"feature-item\">‚úì Access knowledge base articles</div>\n                <div class=\"feature-item\">‚úì Receive priority support notifications</div>\n              </div>\n              \n              <div style=\"text-align: center; margin: 30px 0;\">\n                <a href=\"${process.env.CLIENT_URL || 'http://localhost:3000'}/dashboard\" class=\"button\" style=\"color: white; text-decoration: none;\">Go to Dashboard</a>\n              </div>\n              \n              <p>If you need any assistance, our support team is here to help!</p>\n              \n              <p style=\"margin-top: 30px;\">\n                Best regards,<br>\n                <strong>Bugema University IT Support Team</strong>\n              </p>\n            </div>\n            \n            <div class=\"footer\">\n              <p>¬© ${new Date().getFullYear()} Bugema University</p>\n              <p>For assistance: <a href=\"mailto:itsupport@bugema.ac.ug\">itsupport@bugema.ac.ug</a></p>\n            </div>\n          </div>\n        </body>\n        </html>\n      `\n    };\n    return templates[template] || `<p>${context.message || 'Notification from Bugema University IT Support'}</p>`;\n  }\n\n  /**\r\n   * Get plain text version of email (for email clients that don't support HTML)\r\n   * \r\n   * @param {string} template - Template name\r\n   * @param {Object} context - Template context data\r\n   * @returns {string} Plain text email content\r\n   */\n  getTextVersion(template, context = {}) {\n    const textVersions = {\n      emailVerification: `\nBUGEMA UNIVERSITY IT SUPPORT SYSTEM\n===================================\n\nEMAIL VERIFICATION REQUIRED\n\nDear ${context.name || 'User'},\n\nThank you for registering with Bugema University IT Support System.\n\nVERIFICATION LINK: ${context.verificationUrl}\n\nThis link expires in 24 hours.\n\nIf you didn't create this account, please ignore this email.\n\nBest regards,\nIT Support Team\nBugema University\n\n-----------------------------------\nThis is an automated message.\nContact: itsupport@bugema.ac.ug\n      `,\n      passwordReset: `\nBUGEMA UNIVERSITY IT SUPPORT SYSTEM\n===================================\n\nPASSWORD RESET REQUEST\n\nHello ${context.name || 'User'},\n\nReset your password using this link:\n${context.resetUrl}\n\n‚ö†Ô∏è SECURITY NOTICE:\n- Link expires in 10 minutes\n- If you didn't request this, ignore this email\n- Never share this link with anyone\n\nBest regards,\nIT Security Team\nBugema University\n\n-----------------------------------\nSecurity contact: security@bugema.ac.ug\n      `,\n      passwordResetSuccess: `\nBUGEMA UNIVERSITY IT SUPPORT SYSTEM\n===================================\n\n‚úÖ PASSWORD RESET SUCCESSFUL\n\nHello ${context.name || 'User'},\n\nYour password has been successfully reset and updated.\n\nüîê SECURITY TIPS:\n- Never share your password\n- Use unique passwords for each account\n- Enable 2FA when available\n- Change passwords regularly\n\n‚ö†Ô∏è IMPORTANT: If you didn't make this change, contact security immediately.\n\nLogin: ${process.env.CLIENT_URL || 'http://localhost:3000'}/login\n\nBest regards,\nIT Security Team\nBugema University\n\n-----------------------------------\nSecurity contact: security@bugema.ac.ug\n      `,\n      welcome: `\nBUGEMA UNIVERSITY IT SUPPORT SYSTEM\n===================================\n\nWELCOME! üëã\n\nHello ${context.name}!\n\nYour account is now fully activated.\n\nWHAT YOU CAN DO:\n‚úì Submit IT support tickets\n‚úì Track ticket status in real-time\n‚úì Access knowledge base articles\n‚úì Receive priority support notifications\n\nDashboard: ${process.env.CLIENT_URL || 'http://localhost:3000'}/dashboard\n\nBest regards,\nBugema University IT Support Team\n\n-----------------------------------\nContact: itsupport@bugema.ac.ug\n      `\n    };\n    return textVersions[template] || 'Notification from Bugema University IT Support System';\n  }\n\n  // ==========================================================================\n  // CONVENIENCE METHODS\n  // ==========================================================================\n\n  /**\r\n   * Send email verification email\r\n   * \r\n   * @param {string} to - Recipient email\r\n   * @param {string} name - User name\r\n   * @param {string} verificationUrl - Verification URL\r\n   * @returns {Promise<Object>} Send result\r\n   */\n  async sendVerificationEmail(to, name, verificationUrl) {\n    return this.sendEmail({\n      to,\n      subject: 'Verify Your Email - Bugema University IT Support',\n      template: 'emailVerification',\n      context: {\n        name,\n        verificationUrl\n      }\n    });\n  }\n\n  /**\r\n   * Send password reset email\r\n   * \r\n   * @param {string} to - Recipient email\r\n   * @param {string} name - User name\r\n   * @param {string} resetUrl - Password reset URL\r\n   * @returns {Promise<Object>} Send result\r\n   */\n  async sendPasswordResetEmail(to, name, resetUrl) {\n    return this.sendEmail({\n      to,\n      subject: 'Password Reset Request - Bugema University IT Support',\n      template: 'passwordReset',\n      context: {\n        name,\n        resetUrl\n      }\n    });\n  }\n\n  /**\r\n   * Send password reset success confirmation email\r\n   * \r\n   * @param {string} to - Recipient email\r\n   * @param {string} name - User name\r\n   * @returns {Promise<Object>} Send result\r\n   */\n  async sendPasswordResetSuccessEmail(to, name) {\n    return this.sendEmail({\n      to,\n      subject: 'Password Reset Successful - Bugema University IT Support',\n      template: 'passwordResetSuccess',\n      context: {\n        name\n      }\n    });\n  }\n\n  /**\r\n   * Send welcome email\r\n   * \r\n   * @param {string} to - Recipient email\r\n   * @param {string} name - User name\r\n   * @returns {Promise<Object>} Send result\r\n   */\n  async sendWelcomeEmail(to, name) {\n    return this.sendEmail({\n      to,\n      subject: 'Welcome to Bugema University IT Support!',\n      template: 'welcome',\n      context: {\n        name\n      }\n    });\n  }\n\n  /**\r\n   * Send ticket notification email\r\n   * \r\n   * @param {string} to - Recipient email\r\n   * @param {string} name - User name\r\n   * @param {Object} ticketData - Ticket information\r\n   * @returns {Promise<Object>} Send result\r\n   */\n  async sendTicketNotification(to, name, ticketData) {\n    return this.sendEmail({\n      to,\n      subject: `Ticket ${ticketData.action} - #${ticketData.ticketNumber}`,\n      template: ticketData.action === 'created' ? 'ticketCreated' : 'ticketUpdated',\n      context: {\n        name,\n        ...ticketData\n      }\n    });\n  }\n\n  // ==========================================================================\n  // UTILITY METHODS\n  // ==========================================================================\n\n  /**\r\n   * Validate email address format\r\n   * \r\n   * @param {string} email - Email address to validate\r\n   * @returns {boolean} True if valid, false otherwise\r\n   */\n  validateEmail(email) {\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    return emailRegex.test(email);\n  }\n\n  /**\r\n   * Handle email errors\r\n   * \r\n   * @param {string} message - Error message\r\n   * @param {Object} options - Email options\r\n   * @returns {Object} Error result\r\n   */\n  handleError(message, options) {\n    console.error('‚ùå Email error:', message, options.to);\n    return {\n      success: false,\n      error: message,\n      timestamp: new Date().toISOString(),\n      to: options.to\n    };\n  }\n\n  // ==========================================================================\n  // MONITORING AND MANAGEMENT\n  // ==========================================================================\n\n  /**\r\n   * Get email service status\r\n   * \r\n   * @returns {Object} Service status information\r\n   */\n  getStatus() {\n    const config = this.getEmailConfig();\n    return {\n      configured: this.isConfigured,\n      mode: this.isConfigured ? 'Production' : 'Development',\n      service: config.valid ? 'Gmail SMTP' : 'Not configured',\n      queueLength: this.queue.length,\n      processingQueue: this.processingQueue,\n      retryCount: this.retryCount,\n      host: config.host || 'N/A',\n      port: config.port || 'N/A',\n      from: config.from || 'N/A'\n    };\n  }\n\n  /**\r\n   * Clear email queue\r\n   */\n  clearQueue() {\n    this.queue = [];\n    console.log('üìß Email queue cleared');\n  }\n\n  /**\r\n   * Get queue statistics\r\n   * \r\n   * @returns {Object} Queue statistics\r\n   */\n  getQueueStats() {\n    return {\n      pending: this.queue.length,\n      processing: this.processingQueue,\n      totalInQueue: this.queue.length\n    };\n  }\n\n  /**\r\n   * Test email configuration by sending a test email\r\n   * \r\n   * @param {string} testEmail - Email address to send test to\r\n   * @returns {Promise<Object>} Test result\r\n   */\n  async testConnection(testEmail = 'test@example.com') {\n    try {\n      console.log('üîß Testing email configuration...');\n      const result = await this.sendEmail({\n        to: testEmail,\n        subject: 'Email Service Test - Bugema IT Support',\n        template: 'welcome',\n        context: {\n          name: 'Test User'\n        }\n      });\n      console.log('‚úÖ Test email sent successfully');\n      return result;\n    } catch (error) {\n      console.error('‚ùå Test email failed:', error.message);\n      return {\n        success: false,\n        error: error.message\n      };\n    }\n  }\n}\n\n// ==========================================================================\n// INITIALIZATION\n// ==========================================================================\n\n// Ensure logs directory exists\nconst logsDir = path.join(__dirname, '../../logs');\nif (!fs.existsSync(logsDir)) {\n  fs.mkdirSync(logsDir, {\n    recursive: true\n  });\n}\n\n// Export singleton instance\nmodule.exports = new EmailService();","map":{"version":3,"names":["nodemailer","require","fs","path","EmailService","constructor","transporter","isConfigured","retryCount","maxRetries","queue","processingQueue","init","startQueueProcessor","emailConfig","getEmailConfig","valid","console","warn","missing","setupFallbackLogging","createTransport","host","port","secure","auth","user","username","pass","password","tls","rejectUnauthorized","pool","maxConnections","maxMessages","verifyConnection","error","message","required","filter","key","process","env","length","EMAIL_HOST","parseInt","EMAIL_PORT","EMAIL_SECURE","EMAIL_USERNAME","EMAIL_PASSWORD","from","EMAIL_FROM","fromName","EMAIL_FROM_NAME","verify","log","delay","setTimeout","logsDir","join","__dirname","existsSync","mkdirSync","recursive","sendEmail","options","validateEmail","to","handleError","Promise","resolve","push","processQueue","shift","result","sendEmailDirect","errorResult","setInterval","NODE_ENV","logEmailToFile","attempt","mailOptions","subject","html","getTemplate","template","context","text","getTextVersion","replyTo","EMAIL_REPLY_TO","headers","info","sendMail","messageId","substring","success","timestamp","Date","toISOString","emailLogFile","logEntry","mode","logLine","JSON","stringify","appendFileSync","encoding","logFile","simulated","logged","templates","emailVerification","name","verificationUrl","getFullYear","passwordReset","resetUrl","passwordResetSuccess","CLIENT_URL","welcome","textVersions","sendVerificationEmail","sendPasswordResetEmail","sendPasswordResetSuccessEmail","sendWelcomeEmail","sendTicketNotification","ticketData","action","ticketNumber","email","emailRegex","test","getStatus","config","configured","service","queueLength","clearQueue","getQueueStats","pending","processing","totalInQueue","testConnection","testEmail","module","exports"],"sources":["C:/Users/KADZ-TECH/Documents/dev/it-support-system/frontend/src/services/authService.js"],"sourcesContent":["/**\r\n * Email Service - Production Ready with Gmail\r\n * \r\n * Comprehensive email service with queue management, retry logic,\r\n * and fallback mechanisms for the Bugema University IT Support System.\r\n * \r\n * Features:\r\n * - Gmail SMTP integration with secure authentication\r\n * - Email queue with rate limiting\r\n * - Automatic retry on failure (3 attempts)\r\n * - Fallback to file logging in development\r\n * - Professional HTML email templates\r\n * - Text-only fallback versions\r\n * - Connection pooling for performance\r\n * - Email validation\r\n * - Status monitoring\r\n * \r\n * @version 3.0.0\r\n * @author Bugema University IT Support System\r\n */\r\n\r\nconst nodemailer = require('nodemailer');\r\nconst fs = require('fs');\r\nconst path = require('path');\r\n\r\nclass EmailService {\r\n  constructor() {\r\n    // Email transporter (SMTP connection)\r\n    this.transporter = null;\r\n    \r\n    // Service state\r\n    this.isConfigured = false;\r\n    this.retryCount = 0;\r\n    this.maxRetries = 3;\r\n    \r\n    // Email queue management\r\n    this.queue = [];\r\n    this.processingQueue = false;\r\n    \r\n    // Initialize service\r\n    this.init();\r\n    this.startQueueProcessor();\r\n  }\r\n\r\n  // ==========================================================================\r\n  // INITIALIZATION\r\n  // ==========================================================================\r\n\r\n  /**\r\n   * Initialize email service with Gmail SMTP\r\n   */\r\n  init() {\r\n    try {\r\n      const emailConfig = this.getEmailConfig();\r\n      \r\n      // Check if email is properly configured\r\n      if (!emailConfig.valid) {\r\n        console.warn('‚ö†Ô∏è  Email configuration incomplete:', emailConfig.missing);\r\n        this.setupFallbackLogging();\r\n        return;\r\n      }\r\n\r\n      // Create SMTP transporter\r\n      this.transporter = nodemailer.createTransport({\r\n        host: emailConfig.host,\r\n        port: emailConfig.port,\r\n        secure: emailConfig.secure, // true for 465, false for 587\r\n        auth: {\r\n          user: emailConfig.username,\r\n          pass: emailConfig.password\r\n        },\r\n        tls: {\r\n          rejectUnauthorized: false // Allow self-signed certificates in dev\r\n        },\r\n        pool: true, // Use connection pooling for better performance\r\n        maxConnections: 5, // Maximum concurrent connections\r\n        maxMessages: 100 // Maximum messages per connection\r\n      });\r\n\r\n      // Verify connection\r\n      this.verifyConnection();\r\n      this.isConfigured = true;\r\n      \r\n    } catch (error) {\r\n      console.error('‚ùå Email service initialization failed:', error.message);\r\n      this.setupFallbackLogging();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get and validate email configuration from environment variables\r\n   * \r\n   * @returns {Object} Email configuration with validation status\r\n   */\r\n  getEmailConfig() {\r\n    // Required environment variables\r\n    const required = ['EMAIL_HOST', 'EMAIL_USERNAME', 'EMAIL_PASSWORD'];\r\n    const missing = required.filter(key => !process.env[key]);\r\n    \r\n    // Return validation result\r\n    if (missing.length > 0) {\r\n      return { valid: false, missing };\r\n    }\r\n\r\n    return {\r\n      valid: true,\r\n      host: process.env.EMAIL_HOST,\r\n      port: parseInt(process.env.EMAIL_PORT) || 587,\r\n      secure: process.env.EMAIL_SECURE === 'true',\r\n      username: process.env.EMAIL_USERNAME,\r\n      password: process.env.EMAIL_PASSWORD,\r\n      from: process.env.EMAIL_FROM || process.env.EMAIL_USERNAME,\r\n      fromName: process.env.EMAIL_FROM_NAME || 'Bugema IT Support'\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Verify SMTP connection with retry logic\r\n   */\r\n  async verifyConnection() {\r\n    try {\r\n      await this.transporter.verify();\r\n      console.log('‚úÖ Email service connected to Gmail successfully');\r\n      this.retryCount = 0;\r\n    } catch (error) {\r\n      console.error('‚ùå Email connection failed:', error.message);\r\n      \r\n      // Retry connection with exponential backoff\r\n      if (this.retryCount < this.maxRetries) {\r\n        this.retryCount++;\r\n        const delay = this.retryCount * 2;\r\n        console.log(`üîÑ Retrying connection in ${delay} seconds... (Attempt ${this.retryCount}/${this.maxRetries})`);\r\n        setTimeout(() => this.verifyConnection(), delay * 1000);\r\n      } else {\r\n        console.log('üìß Maximum retries reached. Falling back to logging mode');\r\n        this.setupFallbackLogging();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Setup fallback logging for development/testing\r\n   */\r\n  setupFallbackLogging() {\r\n    const logsDir = path.join(__dirname, '../../logs');\r\n    if (!fs.existsSync(logsDir)) {\r\n      fs.mkdirSync(logsDir, { recursive: true });\r\n    }\r\n    console.log('üìß Running in development mode - emails will be logged to logs/emails.log');\r\n  }\r\n\r\n  // ==========================================================================\r\n  // EMAIL SENDING\r\n  // ==========================================================================\r\n\r\n  /**\r\n   * Send email with automatic retry and queue management\r\n   * \r\n   * @param {Object} options - Email options\r\n   * @param {string} options.to - Recipient email address\r\n   * @param {string} options.subject - Email subject\r\n   * @param {string} options.template - Template name\r\n   * @param {Object} options.context - Template context data\r\n   * @returns {Promise<Object>} Send result\r\n   */\r\n  async sendEmail(options) {\r\n    // Validate email address\r\n    if (!this.validateEmail(options.to)) {\r\n      return this.handleError('Invalid email address', options);\r\n    }\r\n\r\n    // Add email to queue for processing\r\n    return new Promise((resolve) => {\r\n      this.queue.push({ options, resolve });\r\n      this.processQueue();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Process email queue with rate limiting\r\n   */\r\n  async processQueue() {\r\n    // Prevent concurrent queue processing\r\n    if (this.processingQueue || this.queue.length === 0) return;\r\n    \r\n    this.processingQueue = true;\r\n    \r\n    while (this.queue.length > 0) {\r\n      const { options, resolve } = this.queue.shift();\r\n      \r\n      try {\r\n        const result = await this.sendEmailDirect(options);\r\n        resolve(result);\r\n      } catch (error) {\r\n        const errorResult = this.handleError(error.message, options);\r\n        resolve(errorResult);\r\n      }\r\n      \r\n      // Rate limiting: 100ms delay between emails to prevent spam flags\r\n      await new Promise(resolve => setTimeout(resolve, 100));\r\n    }\r\n    \r\n    this.processingQueue = false;\r\n  }\r\n\r\n  /**\r\n   * Start automatic queue processor (runs every second)\r\n   */\r\n  startQueueProcessor() {\r\n    setInterval(() => this.processQueue(), 1000);\r\n  }\r\n\r\n  /**\r\n   * Direct email sending with retry logic\r\n   * \r\n   * @param {Object} options - Email options\r\n   * @returns {Promise<Object>} Send result\r\n   */\r\n  async sendEmailDirect(options) {\r\n    const emailConfig = this.getEmailConfig();\r\n    \r\n    // If not configured or in development, log to file\r\n    if (!this.isConfigured || process.env.NODE_ENV !== 'production') {\r\n      return this.logEmailToFile(options);\r\n    }\r\n\r\n    // Production sending with retry logic (3 attempts)\r\n    for (let attempt = 1; attempt <= 3; attempt++) {\r\n      try {\r\n        const mailOptions = {\r\n          from: `${emailConfig.fromName} <${emailConfig.from}>`,\r\n          to: options.to,\r\n          subject: options.subject,\r\n          html: this.getTemplate(options.template, options.context),\r\n          text: options.text || this.getTextVersion(options.template, options.context),\r\n          replyTo: process.env.EMAIL_REPLY_TO || emailConfig.from,\r\n          headers: {\r\n            'X-Priority': '1',\r\n            'X-Mailer': 'BugemaITSupport/3.0'\r\n          }\r\n        };\r\n\r\n        const info = await this.transporter.sendMail(mailOptions);\r\n        \r\n        console.log('‚úÖ Email sent successfully:', {\r\n          to: options.to,\r\n          messageId: info.messageId,\r\n          subject: options.subject.substring(0, 50)\r\n        });\r\n\r\n        return {\r\n          success: true,\r\n          messageId: info.messageId,\r\n          timestamp: new Date().toISOString()\r\n        };\r\n\r\n      } catch (error) {\r\n        console.error(`‚ùå Email attempt ${attempt} failed:`, error.message);\r\n        \r\n        // If this was the final attempt, log to file as fallback\r\n        if (attempt === 3) {\r\n          return this.logEmailToFile(options, error.message);\r\n        }\r\n        \r\n        // Wait before retry (exponential backoff: 1s, 2s, 3s)\r\n        await new Promise(resolve => setTimeout(resolve, attempt * 1000));\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Log email to file (fallback for development/failures)\r\n   * \r\n   * @param {Object} options - Email options\r\n   * @param {string} error - Error message (if any)\r\n   * @returns {Object} Log result\r\n   */\r\n  logEmailToFile(options, error = null) {\r\n    const logsDir = path.join(__dirname, '../../logs');\r\n    const emailLogFile = path.join(logsDir, 'emails.log');\r\n    \r\n    // Ensure logs directory exists\r\n    if (!fs.existsSync(logsDir)) {\r\n      fs.mkdirSync(logsDir, { recursive: true });\r\n    }\r\n    \r\n    // Create log entry\r\n    const logEntry = {\r\n      timestamp: new Date().toISOString(),\r\n      to: options.to,\r\n      subject: options.subject,\r\n      template: options.template,\r\n      context: options.context,\r\n      error: error,\r\n      mode: this.isConfigured ? 'production-fallback' : 'development'\r\n    };\r\n    \r\n    // Append to log file\r\n    const logLine = JSON.stringify(logEntry) + '\\n';\r\n    fs.appendFileSync(emailLogFile, logLine, { encoding: 'utf8' });\r\n    \r\n    console.log('üìß Email logged to file:', {\r\n      to: options.to,\r\n      subject: options.subject,\r\n      logFile: 'logs/emails.log'\r\n    });\r\n    \r\n    return {\r\n      success: !error,\r\n      simulated: true,\r\n      logged: true,\r\n      error: error,\r\n      timestamp: new Date().toISOString()\r\n    };\r\n  }\r\n\r\n  // ==========================================================================\r\n  // EMAIL TEMPLATES\r\n  // ==========================================================================\r\n\r\n  /**\r\n   * Get HTML email template\r\n   * \r\n   * @param {string} template - Template name\r\n   * @param {Object} context - Template context data\r\n   * @returns {string} HTML email content\r\n   */\r\n  getTemplate(template, context = {}) {\r\n    const templates = {\r\n      // ========================================================================\r\n      // EMAIL VERIFICATION TEMPLATE\r\n      // ========================================================================\r\n      emailVerification: `\r\n        <!DOCTYPE html>\r\n        <html>\r\n        <head>\r\n          <meta charset=\"UTF-8\">\r\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n          <title>Verify Your Email - Bugema University</title>\r\n          <style>\r\n            body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; background: #f5f5f5; }\r\n            .container { max-width: 600px; margin: 20px auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.1); }\r\n            .header { background: linear-gradient(135deg, #1a56db 0%, #1e40af 100%); color: white; padding: 40px 20px; text-align: center; }\r\n            .content { padding: 40px; }\r\n            .button { display: inline-block; padding: 15px 30px; background: #1a56db; color: white; text-decoration: none; border-radius: 5px; font-weight: bold; font-size: 16px; margin: 25px 0; }\r\n            .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #6c757d; font-size: 12px; border-top: 1px solid #e9ecef; }\r\n            .university-logo { font-size: 28px; font-weight: bold; color: white; margin-bottom: 10px; }\r\n            .warning { background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; padding: 15px; margin: 20px 0; color: #856404; }\r\n            .code { background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 14px; margin: 10px 0; word-break: break-all; }\r\n          </style>\r\n        </head>\r\n        <body>\r\n          <div class=\"container\">\r\n            <div class=\"header\">\r\n              <div class=\"university-logo\">BUGEMA UNIVERSITY</div>\r\n              <h1 style=\"margin: 10px 0; font-weight: 300;\">IT Support System</h1>\r\n            </div>\r\n            \r\n            <div class=\"content\">\r\n              <h2 style=\"color: #1a56db; margin-top: 0;\">Verify Your Email Address</h2>\r\n              \r\n              <p>Dear <strong>${context.name || 'Valued User'}</strong>,</p>\r\n              \r\n              <p>Welcome to the Bugema University IT Support System! To complete your registration and access all features, please verify your email address by clicking the button below:</p>\r\n              \r\n              <div style=\"text-align: center; margin: 30px 0;\">\r\n                <a href=\"${context.verificationUrl}\" class=\"button\" style=\"color: white; text-decoration: none;\">Verify Email Address</a>\r\n              </div>\r\n              \r\n              <div class=\"warning\">\r\n                <strong>‚ö†Ô∏è Important:</strong> This verification link will expire in <strong>24 hours</strong>.\r\n              </div>\r\n              \r\n              <p>If the button doesn't work, copy and paste this URL into your browser:</p>\r\n              <div class=\"code\">${context.verificationUrl}</div>\r\n              \r\n              <p>If you didn't create an account with Bugema University IT Support, please ignore this email or contact our support team immediately.</p>\r\n              \r\n              <p style=\"margin-top: 30px;\">\r\n                Best regards,<br>\r\n                <strong>IT Support Team</strong><br>\r\n                Bugema University<br>\r\n                <small style=\"color: #6c757d;\">Providing technical excellence since 1948</small>\r\n              </p>\r\n            </div>\r\n            \r\n            <div class=\"footer\">\r\n              <p>¬© ${new Date().getFullYear()} Bugema University. All rights reserved.</p>\r\n              <p>This is an automated message. Please do not reply to this email.</p>\r\n              <p>For assistance, contact: <a href=\"mailto:itsupport@bugema.ac.ug\">itsupport@bugema.ac.ug</a></p>\r\n            </div>\r\n          </div>\r\n        </body>\r\n        </html>\r\n      `,\r\n\r\n      // ========================================================================\r\n      // PASSWORD RESET REQUEST TEMPLATE\r\n      // ========================================================================\r\n      passwordReset: `\r\n        <!DOCTYPE html>\r\n        <html>\r\n        <head>\r\n          <meta charset=\"UTF-8\">\r\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n          <title>Password Reset - Bugema University</title>\r\n          <style>\r\n            body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; background: #f5f5f5; }\r\n            .container { max-width: 600px; margin: 20px auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.1); }\r\n            .header { background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%); color: white; padding: 40px 20px; text-align: center; }\r\n            .content { padding: 40px; }\r\n            .button { display: inline-block; padding: 15px 30px; background: #dc2626; color: white; text-decoration: none; border-radius: 5px; font-weight: bold; font-size: 16px; margin: 25px 0; }\r\n            .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #6c757d; font-size: 12px; border-top: 1px solid #e9ecef; }\r\n            .security-alert { background: #fee; border: 1px solid #fcc; border-radius: 5px; padding: 15px; margin: 20px 0; color: #c00; }\r\n            .code { background: #f8f9fa; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 14px; margin: 10px 0; word-break: break-all; }\r\n          </style>\r\n        </head>\r\n        <body>\r\n          <div class=\"container\">\r\n            <div class=\"header\">\r\n              <h1 style=\"margin: 0; font-weight: 300;\">üîí Password Reset Request</h1>\r\n              <p style=\"margin: 10px 0 0; opacity: 0.9;\">Bugema University IT Support System</p>\r\n            </div>\r\n            \r\n            <div class=\"content\">\r\n              <h2 style=\"color: #dc2626; margin-top: 0;\">Reset Your Password</h2>\r\n              \r\n              <p>Hello <strong>${context.name || 'User'}</strong>,</p>\r\n              \r\n              <p>We received a request to reset your password for the Bugema University IT Support System. To reset your password, click the button below:</p>\r\n              \r\n              <div style=\"text-align: center; margin: 30px 0;\">\r\n                <a href=\"${context.resetUrl}\" class=\"button\" style=\"color: white; text-decoration: none;\">Reset Password</a>\r\n              </div>\r\n              \r\n              <div class=\"security-alert\">\r\n                <strong>üîê Security Notice:</strong>\r\n                <ul style=\"margin: 10px 0; padding-left: 20px;\">\r\n                  <li>This link expires in <strong>10 minutes</strong></li>\r\n                  <li>If you didn't request this reset, ignore this email</li>\r\n                  <li>Never share your password or this link with anyone</li>\r\n                  <li>Contact support immediately if suspicious</li>\r\n                </ul>\r\n              </div>\r\n              \r\n              <p>If the button doesn't work, use this link:</p>\r\n              <div class=\"code\">${context.resetUrl}</div>\r\n              \r\n              <p style=\"margin-top: 30px;\">\r\n                Best regards,<br>\r\n                <strong>IT Security Team</strong><br>\r\n                Bugema University\r\n              </p>\r\n            </div>\r\n            \r\n            <div class=\"footer\">\r\n              <p>¬© ${new Date().getFullYear()} Bugema University IT Security</p>\r\n              <p>This is an automated security message. Do not reply.</p>\r\n              <p>For security concerns: <a href=\"mailto:security@bugema.ac.ug\">security@bugema.ac.ug</a></p>\r\n            </div>\r\n          </div>\r\n        </body>\r\n        </html>\r\n      `,\r\n\r\n      // ========================================================================\r\n      // PASSWORD RESET SUCCESS TEMPLATE\r\n      // ========================================================================\r\n      passwordResetSuccess: `\r\n        <!DOCTYPE html>\r\n        <html>\r\n        <head>\r\n          <meta charset=\"UTF-8\">\r\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n          <title>Password Reset Successful - Bugema University</title>\r\n          <style>\r\n            body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; background: #f5f5f5; }\r\n            .container { max-width: 600px; margin: 20px auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.1); }\r\n            .header { background: linear-gradient(135deg, #059669 0%, #047857 100%); color: white; padding: 40px 20px; text-align: center; }\r\n            .content { padding: 40px; }\r\n            .button { display: inline-block; padding: 15px 30px; background: #059669; color: white; text-decoration: none; border-radius: 5px; font-weight: bold; font-size: 16px; margin: 25px 0; }\r\n            .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #6c757d; font-size: 12px; border-top: 1px solid #e9ecef; }\r\n            .success-icon { font-size: 48px; margin-bottom: 20px; }\r\n            .security-tips { background: #f0fdf4; border: 1px solid #86efac; border-radius: 5px; padding: 15px; margin: 20px 0; }\r\n          </style>\r\n        </head>\r\n        <body>\r\n          <div class=\"container\">\r\n            <div class=\"header\">\r\n              <div class=\"success-icon\">‚úÖ</div>\r\n              <h1 style=\"margin: 0; font-weight: 300;\">Password Reset Successful</h1>\r\n              <p style=\"margin: 10px 0 0; opacity: 0.9;\">Bugema University IT Support System</p>\r\n            </div>\r\n            \r\n            <div class=\"content\">\r\n              <h2 style=\"color: #059669; margin-top: 0;\">Your Password Has Been Changed</h2>\r\n              \r\n              <p>Hello <strong>${context.name || 'User'}</strong>,</p>\r\n              \r\n              <p>This email confirms that your password for the Bugema University IT Support System has been successfully reset and updated.</p>\r\n              \r\n              <div class=\"security-tips\">\r\n                <strong>üîê Security Tips:</strong>\r\n                <ul style=\"margin: 10px 0; padding-left: 20px;\">\r\n                  <li>Never share your password with anyone</li>\r\n                  <li>Use a unique password for each account</li>\r\n                  <li>Enable two-factor authentication when available</li>\r\n                  <li>Change your password regularly</li>\r\n                </ul>\r\n              </div>\r\n              \r\n              <p><strong>‚ö†Ô∏è Important:</strong> If you did NOT make this change, please contact our IT Security team immediately at <a href=\"mailto:security@bugema.ac.ug\">security@bugema.ac.ug</a></p>\r\n              \r\n              <div style=\"text-align: center; margin: 30px 0;\">\r\n                <a href=\"${process.env.CLIENT_URL || 'http://localhost:3000'}/login\" class=\"button\" style=\"color: white; text-decoration: none;\">Login to Your Account</a>\r\n              </div>\r\n              \r\n              <p style=\"margin-top: 30px;\">\r\n                Best regards,<br>\r\n                <strong>IT Security Team</strong><br>\r\n                Bugema University<br>\r\n                <small style=\"color: #6c757d;\">Keeping your account secure since 1948</small>\r\n              </p>\r\n            </div>\r\n            \r\n            <div class=\"footer\">\r\n              <p>¬© ${new Date().getFullYear()} Bugema University IT Security</p>\r\n              <p>This is an automated security notification. Please do not reply.</p>\r\n              <p>For security concerns: <a href=\"mailto:security@bugema.ac.ug\">security@bugema.ac.ug</a></p>\r\n            </div>\r\n          </div>\r\n        </body>\r\n        </html>\r\n      `,\r\n\r\n      // ========================================================================\r\n      // WELCOME EMAIL TEMPLATE\r\n      // ========================================================================\r\n      welcome: `\r\n        <!DOCTYPE html>\r\n        <html>\r\n        <head>\r\n          <meta charset=\"UTF-8\">\r\n          <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n          <title>Welcome to Bugema IT Support</title>\r\n          <style>\r\n            body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; line-height: 1.6; color: #333; margin: 0; padding: 0; background: #f5f5f5; }\r\n            .container { max-width: 600px; margin: 20px auto; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.1); }\r\n            .header { background: linear-gradient(135deg, #059669 0%, #047857 100%); color: white; padding: 40px 20px; text-align: center; }\r\n            .content { padding: 40px; }\r\n            .button { display: inline-block; padding: 15px 30px; background: #059669; color: white; text-decoration: none; border-radius: 5px; font-weight: bold; font-size: 16px; margin: 25px 0; }\r\n            .footer { background: #f8f9fa; padding: 20px; text-align: center; color: #6c757d; font-size: 12px; border-top: 1px solid #e9ecef; }\r\n            .features { background: #f0fdf4; border-radius: 5px; padding: 20px; margin: 20px 0; }\r\n            .feature-item { margin: 10px 0; }\r\n          </style>\r\n        </head>\r\n        <body>\r\n          <div class=\"container\">\r\n            <div class=\"header\">\r\n              <h1 style=\"margin: 0; font-weight: 300;\">Welcome to Bugema IT Support! üëã</h1>\r\n            </div>\r\n            \r\n            <div class=\"content\">\r\n              <h2 style=\"color: #059669; margin-top: 0;\">Hello ${context.name}!</h2>\r\n              \r\n              <p>Your account is now fully activated and ready to use.</p>\r\n              \r\n              <div class=\"features\">\r\n                <h3 style=\"margin-top: 0; color: #059669;\">What You Can Do:</h3>\r\n                <div class=\"feature-item\">‚úì Submit IT support tickets</div>\r\n                <div class=\"feature-item\">‚úì Track ticket status in real-time</div>\r\n                <div class=\"feature-item\">‚úì Access knowledge base articles</div>\r\n                <div class=\"feature-item\">‚úì Receive priority support notifications</div>\r\n              </div>\r\n              \r\n              <div style=\"text-align: center; margin: 30px 0;\">\r\n                <a href=\"${process.env.CLIENT_URL || 'http://localhost:3000'}/dashboard\" class=\"button\" style=\"color: white; text-decoration: none;\">Go to Dashboard</a>\r\n              </div>\r\n              \r\n              <p>If you need any assistance, our support team is here to help!</p>\r\n              \r\n              <p style=\"margin-top: 30px;\">\r\n                Best regards,<br>\r\n                <strong>Bugema University IT Support Team</strong>\r\n              </p>\r\n            </div>\r\n            \r\n            <div class=\"footer\">\r\n              <p>¬© ${new Date().getFullYear()} Bugema University</p>\r\n              <p>For assistance: <a href=\"mailto:itsupport@bugema.ac.ug\">itsupport@bugema.ac.ug</a></p>\r\n            </div>\r\n          </div>\r\n        </body>\r\n        </html>\r\n      `\r\n    };\r\n\r\n    return templates[template] || `<p>${context.message || 'Notification from Bugema University IT Support'}</p>`;\r\n  }\r\n\r\n  /**\r\n   * Get plain text version of email (for email clients that don't support HTML)\r\n   * \r\n   * @param {string} template - Template name\r\n   * @param {Object} context - Template context data\r\n   * @returns {string} Plain text email content\r\n   */\r\n  getTextVersion(template, context = {}) {\r\n    const textVersions = {\r\n      emailVerification: `\r\nBUGEMA UNIVERSITY IT SUPPORT SYSTEM\r\n===================================\r\n\r\nEMAIL VERIFICATION REQUIRED\r\n\r\nDear ${context.name || 'User'},\r\n\r\nThank you for registering with Bugema University IT Support System.\r\n\r\nVERIFICATION LINK: ${context.verificationUrl}\r\n\r\nThis link expires in 24 hours.\r\n\r\nIf you didn't create this account, please ignore this email.\r\n\r\nBest regards,\r\nIT Support Team\r\nBugema University\r\n\r\n-----------------------------------\r\nThis is an automated message.\r\nContact: itsupport@bugema.ac.ug\r\n      `,\r\n\r\n      passwordReset: `\r\nBUGEMA UNIVERSITY IT SUPPORT SYSTEM\r\n===================================\r\n\r\nPASSWORD RESET REQUEST\r\n\r\nHello ${context.name || 'User'},\r\n\r\nReset your password using this link:\r\n${context.resetUrl}\r\n\r\n‚ö†Ô∏è SECURITY NOTICE:\r\n- Link expires in 10 minutes\r\n- If you didn't request this, ignore this email\r\n- Never share this link with anyone\r\n\r\nBest regards,\r\nIT Security Team\r\nBugema University\r\n\r\n-----------------------------------\r\nSecurity contact: security@bugema.ac.ug\r\n      `,\r\n\r\n      passwordResetSuccess: `\r\nBUGEMA UNIVERSITY IT SUPPORT SYSTEM\r\n===================================\r\n\r\n‚úÖ PASSWORD RESET SUCCESSFUL\r\n\r\nHello ${context.name || 'User'},\r\n\r\nYour password has been successfully reset and updated.\r\n\r\nüîê SECURITY TIPS:\r\n- Never share your password\r\n- Use unique passwords for each account\r\n- Enable 2FA when available\r\n- Change passwords regularly\r\n\r\n‚ö†Ô∏è IMPORTANT: If you didn't make this change, contact security immediately.\r\n\r\nLogin: ${process.env.CLIENT_URL || 'http://localhost:3000'}/login\r\n\r\nBest regards,\r\nIT Security Team\r\nBugema University\r\n\r\n-----------------------------------\r\nSecurity contact: security@bugema.ac.ug\r\n      `,\r\n\r\n      welcome: `\r\nBUGEMA UNIVERSITY IT SUPPORT SYSTEM\r\n===================================\r\n\r\nWELCOME! üëã\r\n\r\nHello ${context.name}!\r\n\r\nYour account is now fully activated.\r\n\r\nWHAT YOU CAN DO:\r\n‚úì Submit IT support tickets\r\n‚úì Track ticket status in real-time\r\n‚úì Access knowledge base articles\r\n‚úì Receive priority support notifications\r\n\r\nDashboard: ${process.env.CLIENT_URL || 'http://localhost:3000'}/dashboard\r\n\r\nBest regards,\r\nBugema University IT Support Team\r\n\r\n-----------------------------------\r\nContact: itsupport@bugema.ac.ug\r\n      `\r\n    };\r\n\r\n    return textVersions[template] || 'Notification from Bugema University IT Support System';\r\n  }\r\n\r\n  // ==========================================================================\r\n  // CONVENIENCE METHODS\r\n  // ==========================================================================\r\n\r\n  /**\r\n   * Send email verification email\r\n   * \r\n   * @param {string} to - Recipient email\r\n   * @param {string} name - User name\r\n   * @param {string} verificationUrl - Verification URL\r\n   * @returns {Promise<Object>} Send result\r\n   */\r\n  async sendVerificationEmail(to, name, verificationUrl) {\r\n    return this.sendEmail({\r\n      to,\r\n      subject: 'Verify Your Email - Bugema University IT Support',\r\n      template: 'emailVerification',\r\n      context: { name, verificationUrl }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Send password reset email\r\n   * \r\n   * @param {string} to - Recipient email\r\n   * @param {string} name - User name\r\n   * @param {string} resetUrl - Password reset URL\r\n   * @returns {Promise<Object>} Send result\r\n   */\r\n  async sendPasswordResetEmail(to, name, resetUrl) {\r\n    return this.sendEmail({\r\n      to,\r\n      subject: 'Password Reset Request - Bugema University IT Support',\r\n      template: 'passwordReset',\r\n      context: { name, resetUrl }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Send password reset success confirmation email\r\n   * \r\n   * @param {string} to - Recipient email\r\n   * @param {string} name - User name\r\n   * @returns {Promise<Object>} Send result\r\n   */\r\n  async sendPasswordResetSuccessEmail(to, name) {\r\n    return this.sendEmail({\r\n      to,\r\n      subject: 'Password Reset Successful - Bugema University IT Support',\r\n      template: 'passwordResetSuccess',\r\n      context: { name }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Send welcome email\r\n   * \r\n   * @param {string} to - Recipient email\r\n   * @param {string} name - User name\r\n   * @returns {Promise<Object>} Send result\r\n   */\r\n  async sendWelcomeEmail(to, name) {\r\n    return this.sendEmail({\r\n      to,\r\n      subject: 'Welcome to Bugema University IT Support!',\r\n      template: 'welcome',\r\n      context: { name }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Send ticket notification email\r\n   * \r\n   * @param {string} to - Recipient email\r\n   * @param {string} name - User name\r\n   * @param {Object} ticketData - Ticket information\r\n   * @returns {Promise<Object>} Send result\r\n   */\r\n  async sendTicketNotification(to, name, ticketData) {\r\n    return this.sendEmail({\r\n      to,\r\n      subject: `Ticket ${ticketData.action} - #${ticketData.ticketNumber}`,\r\n      template: ticketData.action === 'created' ? 'ticketCreated' : 'ticketUpdated',\r\n      context: { name, ...ticketData }\r\n    });\r\n  }\r\n\r\n  // ==========================================================================\r\n  // UTILITY METHODS\r\n  // ==========================================================================\r\n\r\n  /**\r\n   * Validate email address format\r\n   * \r\n   * @param {string} email - Email address to validate\r\n   * @returns {boolean} True if valid, false otherwise\r\n   */\r\n  validateEmail(email) {\r\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\r\n    return emailRegex.test(email);\r\n  }\r\n\r\n  /**\r\n   * Handle email errors\r\n   * \r\n   * @param {string} message - Error message\r\n   * @param {Object} options - Email options\r\n   * @returns {Object} Error result\r\n   */\r\n  handleError(message, options) {\r\n    console.error('‚ùå Email error:', message, options.to);\r\n    \r\n    return {\r\n      success: false,\r\n      error: message,\r\n      timestamp: new Date().toISOString(),\r\n      to: options.to\r\n    };\r\n  }\r\n\r\n  // ==========================================================================\r\n  // MONITORING AND MANAGEMENT\r\n  // ==========================================================================\r\n\r\n  /**\r\n   * Get email service status\r\n   * \r\n   * @returns {Object} Service status information\r\n   */\r\n  getStatus() {\r\n    const config = this.getEmailConfig();\r\n    return {\r\n      configured: this.isConfigured,\r\n      mode: this.isConfigured ? 'Production' : 'Development',\r\n      service: config.valid ? 'Gmail SMTP' : 'Not configured',\r\n      queueLength: this.queue.length,\r\n      processingQueue: this.processingQueue,\r\n      retryCount: this.retryCount,\r\n      host: config.host || 'N/A',\r\n      port: config.port || 'N/A',\r\n      from: config.from || 'N/A'\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Clear email queue\r\n   */\r\n  clearQueue() {\r\n    this.queue = [];\r\n    console.log('üìß Email queue cleared');\r\n  }\r\n\r\n  /**\r\n   * Get queue statistics\r\n   * \r\n   * @returns {Object} Queue statistics\r\n   */\r\n  getQueueStats() {\r\n    return {\r\n      pending: this.queue.length,\r\n      processing: this.processingQueue,\r\n      totalInQueue: this.queue.length\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Test email configuration by sending a test email\r\n   * \r\n   * @param {string} testEmail - Email address to send test to\r\n   * @returns {Promise<Object>} Test result\r\n   */\r\n  async testConnection(testEmail = 'test@example.com') {\r\n    try {\r\n      console.log('üîß Testing email configuration...');\r\n      \r\n      const result = await this.sendEmail({\r\n        to: testEmail,\r\n        subject: 'Email Service Test - Bugema IT Support',\r\n        template: 'welcome',\r\n        context: { \r\n          name: 'Test User'\r\n        }\r\n      });\r\n\r\n      console.log('‚úÖ Test email sent successfully');\r\n      return result;\r\n    } catch (error) {\r\n      console.error('‚ùå Test email failed:', error.message);\r\n      return {\r\n        success: false,\r\n        error: error.message\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\n// ==========================================================================\r\n// INITIALIZATION\r\n// ==========================================================================\r\n\r\n// Ensure logs directory exists\r\nconst logsDir = path.join(__dirname, '../../logs');\r\nif (!fs.existsSync(logsDir)) {\r\n  fs.mkdirSync(logsDir, { recursive: true });\r\n}\r\n\r\n// Export singleton instance\r\nmodule.exports = new EmailService();"],"mappings":"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ACA;MACAC,iBAAiB,EAAE;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC1B,OAAO,CAAC2B,IAAI,IAAI,aAAa;AAC7D;AACA;AACA;AACA;AACA,2BAA2B3B,OAAO,CAAC4B,eAAe;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC5B,OAAO,CAAC4B,eAAe;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,IAAIhB,IAAI,CAAC,CAAC,CAACiB,WAAW,CAAC,CAAC;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;MAED;MACA;MACA;MACAC,aAAa,EAAE;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC9B,OAAO,CAAC2B,IAAI,IAAI,MAAM;AACvD;AACA;AACA;AACA;AACA,2BAA2B3B,OAAO,CAAC+B,QAAQ;AAC3C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC/B,OAAO,CAAC+B,QAAQ;AAClD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,IAAInB,IAAI,CAAC,CAAC,CAACiB,WAAW,CAAC,CAAC;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;MAED;MACA;MACA;MACAG,oBAAoB,EAAE;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiChC,OAAO,CAAC2B,IAAI,IAAI,MAAM;AACvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2BxE,OAAO,CAACC,GAAG,CAAC6E,UAAU,IAAI,uBAAuB;AAC5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,IAAIrB,IAAI,CAAC,CAAC,CAACiB,WAAW,CAAC,CAAC;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;MAED;MACA;MACA;MACAK,OAAO,EAAE;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAiElC,OAAO,CAAC2B,IAAI;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2BxE,OAAO,CAACC,GAAG,CAAC6E,UAAU,IAAI,uBAAuB;AAC5E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,IAAIrB,IAAI,CAAC,CAAC,CAACiB,WAAW,CAAC,CAAC;AAC7C;AACA;AACA;AACA;AACA;AACA;IACI,CAAC;IAED,OAAOJ,SAAS,CAAC1B,QAAQ,CAAC,IAAI,MAAMC,OAAO,CAACjD,OAAO,IAAI,gDAAgD,MAAM;EAC/G;;EAEA;AACF;AACA;AACA;AACA;AACA;AACA;EACEmD,cAAcA,CAACH,QAAQ,EAAEC,OAAO,GAAG,CAAC,CAAC,EAAE;IACrC,MAAMmC,YAAY,GAAG;MACnBT,iBAAiB,EAAE;AACzB;AACA;AACA;AACA;AACA;AACA,OAAO1B,OAAO,CAAC2B,IAAI,IAAI,MAAM;AAC7B;AACA;AACA;AACA,qBAAqB3B,OAAO,CAAC4B,eAAe;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;MAEDE,aAAa,EAAE;AACrB;AACA;AACA;AACA;AACA;AACA,QAAQ9B,OAAO,CAAC2B,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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}